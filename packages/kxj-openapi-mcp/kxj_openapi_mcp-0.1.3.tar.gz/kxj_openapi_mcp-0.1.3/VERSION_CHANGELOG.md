# MCP OpenAPI Generator 版本更新日志

## v1.3.1 (2025-01-18) - 新用户安装兼容性修复

### 🛡️ 关键修复：Requirements.txt 兼容性保证

#### 依赖版本回退修复
- **FastMCP版本**: 从 `>=2.7.0,<3.0.0` 回退到 `>=1.0.0,<2.0.0`
- **兼容性原因**: 当前代码基于FastMCP 1.0 API，FastMCP 2.x有重大变更
- **Python版本**: 要求从Python 3.10+降低到Python 3.8+，支持更广泛用户群体

#### 新用户安装保证
- **零配置冲突**: 确保 `pip install -r requirements.txt` 无版本冲突
- **立即可用**: 新用户安装后可立即使用所有功能
- **向后兼容**: 与现有项目代码100%兼容
- **稳定性优先**: 使用已验证的稳定版本而非未测试的最新版本

#### 依赖优化策略
```yaml
优化原则:
  ✅ 稳定性优先于新特性
  ✅ 向后兼容性保证
  ✅ 严格版本约束防止破坏性更新
  ✅ 降低安装门槛，支持更多Python版本
  ✅ 经过完整测试验证的依赖组合
```

#### 验证覆盖
- ✅ Python 3.8+ 版本兼容性测试
- ✅ FastMCP 1.0 API兼容性验证
- ✅ 所有依赖无冲突验证
- ✅ 核心功能（SAPI/DAPI）正常工作
- ✅ MCP服务启动和工具调用测试
- ✅ 新用户安装流程完整验证

### 🎯 解决的问题
- **新用户困扰**: 避免安装时的版本冲突和兼容性问题
- **门槛降低**: 支持更广泛的Python版本（3.8+而非3.10+）
- **稳定性提升**: 使用经过验证的依赖版本组合
- **文档一致性**: 确保文档中的环境变量和参数语法统一

---

## v1.3.0 (2024-12-18) - 质量保证增强版

### 🛡️ 重要改进：文档质量保证机制

#### AI生成阶段增强
- **完整性要求**: AI必须生成包含所有必需节点的完整OpenAPI文档
- **标准模板提供**: 新增标准响应组件模板，确保一致性
- **引用规范**: 明确要求所有$ref引用都要有对应定义
- **示例完整性**: 强制要求每个响应包含完整schema和example

#### 上传验证机制
- **YAML语法验证**: 严格检查文档格式正确性
- **OpenAPI结构验证**: 确保符合OpenAPI 3.0.0规范
- **引用完整性检查**: 验证所有引用都有对应定义
- **响应结构验证**: 检查每个接口的响应定义完整性

#### 验证结果处理
- **错误阻断**: 严重错误阻止上传，确保质量
- **警告提示**: 非致命问题以警告形式提示
- **详细反馈**: 提供具体错误位置和修复建议

### 🎯 解决的核心问题
- **文档无法预览**: 确保生成的文档可在Swagger Editor中正常显示
- **引用缺失**: 彻底解决$ref引用未定义的问题
- **结构不完整**: 保证文档包含所有必需的OpenAPI节点

### 📊 质量标准
```yaml
验证覆盖:
  ✅ YAML语法正确性
  ✅ OpenAPI 3.0.0结构完整性  
  ✅ 必需节点存在性
  ✅ $ref引用完整性
  ✅ 响应schema定义完整性
  ✅ 示例数据一致性
  ✅ Swagger Editor预览兼容性
```

### 🛠️ 技术实现
- 新增 `validate_openapi_document()` 函数进行多层验证
- 改进AI提示词模板，增加详细的文档规范要求
- 增强 `upload_openapi_doc_tool` 工具的验证能力
- 提供标准components模板供AI参考

## v1.1.1 (2025-01-XX)

### 🔧 兼容性修复
- **Python版本兼容性**: 修复Cursor MCP环境中的类型注解问题
  - 替换 `int | None` 为 `Optional[int]` 以支持Python 3.9及更早版本
  - 解决Cursor中"pid不合规"错误，保持终端环境正常工作
  - 新增 `test_compatibility.py` 兼容性测试脚本

### 📚 文档更新
- 新增 `CURSOR_COMPATIBILITY_FIX.md` 详细修复文档
- 说明Cursor环境与终端环境的差异原因
- 提供完整的故障排除指南和最佳实践
- 更新代码规范建议

### 🛠️ 技术改进
- 改进类型注解兼容性 (`typing.Optional` vs `|` 语法)
- 增强错误处理和类型检查
- 提升代码在不同Python版本间的稳定性

---

## v1.1.0 (2024-12-13)

### 🎉 新功能
- **DAPI 文档下载功能**: 新增 `dapi` 命令支持下载接口文档
  - `dapi pid:5` - 下载项目文档  
  - `dapi eid:19` - 下载特定接口文档
  - 支持AI分析下载的文档内容
  - 完善的错误处理和参数验证

### 🔧 改进
- 增强错误提示信息
- 完善参数验证逻辑
- 优化返回数据结构
- 添加详细的使用文档

### 📚 文档更新
- 新增 `DAPI_USAGE.md` 详细使用指南
- 更新 `README.md` 功能说明
- 更新 `QUICK_START.md` 快速入门
- 新增测试脚本 `test_dapi.py`

### 🧪 测试
- 添加DAPI功能测试脚本
- 参数验证测试
- 错误处理测试

---

## v1.0.0 (2024-12-12)

### 🎉 初始版本
- **SAPI 分析生成功能**: 支持分析Yii2控制器生成OpenAPI文档
  - 智能路径转换 (RegisterController → /register/*)
  - 支持单个方法或整个控制器分析
  - 自动上传到指定服务器
- **MCP集成**: 完整的MCP服务器实现
- **测试工具**: 包含连接测试和诊断工具
- **文档**: 完整的使用说明和快速入门指南

### 🛠️ 技术特性
- 基于 FastMCP 框架
- 支持 httpx 异步HTTP请求
- YAML格式验证
- 完善的错误处理
- 环境变量配置

---

## 📋 当前功能特性

### ✅ 已实现功能

1. **SAPI (分析生成)**
   - ✅ Yii2控制器分析
   - ✅ OpenAPI 3.0文档生成
   - ✅ 自动上传到服务器
   - ✅ 路径智能转换
   - ✅ 单方法/全控制器分析

2. **DAPI (文档下载)**
   - ✅ 项目文档下载 (`dapi pid:5`)
   - ✅ 接口文档下载 (`dapi eid:19`)
   - ✅ AI分析支持
   - ✅ 错误处理和验证

3. **工具功能**
   - ✅ 连接测试 (`test_connection`)
   - ✅ 上传工具 (`upload_openapi_doc_tool`)
   - ✅ 诊断工具 (`diagnose_mcp.py`)

### 🚀 使用统计

| 功能 | 命令格式 | 状态 |
|------|----------|------|
| 分析生成 | `sapi pid:5 @Controller.php [action]` | ✅ 可用 |
| 下载项目 | `dapi pid:5` | ✅ 可用 |
| 下载接口 | `dapi eid:19` | ✅ 可用 |
| 连接测试 | `test_connection` | ✅ 可用 |

### 📊 测试覆盖

- ✅ SAPI功能测试 (`test_mcp.py`)
- ✅ DAPI功能测试 (`test_dapi.py`) 
- ✅ 连接诊断测试 (`diagnose_mcp.py`)
- ✅ 参数验证测试
- ✅ 错误处理测试

---

## 🛣️ 未来规划

### v1.2.0 计划功能
- [ ] 批量文档下载
- [ ] 文档格式转换 (JSON ↔ YAML)
- [ ] 本地文档缓存
- [ ] 文档版本管理

### v1.3.0 计划功能  
- [ ] 可视化文档预览
- [ ] 团队协作功能
- [ ] API测试工具集成
- [ ] 自动化CI/CD集成

---

## 🔧 维护信息

**当前维护者**: MCP OpenAPI Generator Team  
**最后更新**: 2024-12-13  
**支持版本**: v1.1.0+  
**兼容性**: Python 3.7+, Yii2 2.0+ 