[tox]
envlist = py38,py39,py310,py311,py312,lint,type,security,docs
isolated_build = True

[testenv]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    pyyaml>=6.0
commands = 
    pytest {posargs}

[testenv:lint]
deps = 
    black>=23.0.0
    isort>=5.12.0
    flake8>=6.0.0
    flake8-docstrings
commands = 
    black --check src/runly tests
    isort --check-only src/runly tests
    flake8 src/runly tests

[testenv:format]
deps = 
    black>=23.0.0
    isort>=5.12.0
commands = 
    black src/runly tests
    isort src/runly tests

[testenv:type]
deps = 
    mypy>=1.0.0
    types-PyYAML
commands = 
    mypy src/runly

[testenv:security]
deps = 
    bandit>=1.7.0
    safety>=2.0.0
commands = 
    bandit -r src/runly
    safety check

[testenv:coverage]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    coverage[toml]>=7.0.0
commands = 
    pytest --cov=src/runly --cov-report=html --cov-report=xml --cov-report=term-missing
    coverage report --fail-under=80

[testenv:docs]
deps = 
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    myst-parser>=1.0.0
commands = 
    sphinx-build -b html docs docs/_build/html

[testenv:clean]
deps = 
commands = 
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.tox', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"
