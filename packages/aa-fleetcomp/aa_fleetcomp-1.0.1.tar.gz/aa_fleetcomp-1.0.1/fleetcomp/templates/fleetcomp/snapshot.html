{% extends "fleetcomp/base.html" %}
{% load i18n %}
{% load evelinks %}
{% load fleetcomp %}
{% block content %}
    <div class="grid p-3">
        <div class="row">
            <ul class="list-group col-lg-3 px-2">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Fleet commander" %}:
                    <span>{{ snapshot.commander }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Main count" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_mains }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Character count" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_members }}</span>
                </li>
                {% if snapshot.count_orphans %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {% translate "Orphan count" %}:
                        <span class="badge bg-primary rounded-pill">{{ snapshot.count_orphans }}</span>
                    </li>
                {% endif %}
            </ul>
            <ul class="list-group col-lg-3 px-2">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Main ship" %}:
                    <span>
                        {{ main_ship_type }}
                        <span class="badge bg-primary rounded-pill">{{ main_ship_type_count }}</span>
                    </span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Logistics" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_logistics }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "HICs" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_hics }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Command Ships" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_command_ships }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Cynoes" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_cynoes }}</span>
                </li>
                {% for custom_grouping in custom_groupings %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ custom_grouping.display_name }}
                        <span class="badge bg-primary rounded-pill">{% custom_grouping_counter_snapshot snapshot custom_grouping %}</span>
                    {% endfor %}
                </li>
            </ul>
            <ul class="list-group col-lg-3 px-2">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "Dreadnoughts" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_dreads }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {% translate "FAXes" %}:
                    <span class="badge bg-primary rounded-pill">{{ snapshot.count_faxes }}</span>
                </li>
            </ul>
        </div>
    </div>
    <table class="table table-striped table-hover" id="memberTable">
        <thead>
            <tr>
                <th>{% translate "Main character" %}</th>
                <th>{% translate "Character count" %}</th>
                <th>{% translate "Main line" %}</th>
                <th>{% translate "Logistics" %}</th>
                <th>{% translate "Hics" %}</th>
                <th>{% translate "Cynoes" %}</th>
                <th>{% translate "Dreads" %}</th>
                <th>{% translate "Faxes" %}</th>
                {% for custom_grouping in custom_groupings %}<th>{{ custom_grouping.display_name }}</th>{% endfor %}
                <th>{% translate "Other" %}</th>
                <th>{% translate "Details" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for report in snapshot.generate_report %}
                <tr>
                    <th>
                        {% if report.main_character %}
                            <span class="d-block" style="min-width: 120px;">
                                <img src="{{ report.main_character|character_portrait_url:32 }}" </span>
                                {{ report.main_character }}
                            {% else %}
                                {% translate "Orphan characters" %}
                            {% endif %}
                        </th>
                        <th>{{ report.character_count }}</th>
                        <th>{{ report.main_line }}</th>
                        <th>{{ report.logistics }}</th>
                        <th>{{ report.hics }}</th>
                        <th>{{ report.cynoes }}</th>
                        <th>{{ report.dreads }}</th>
                        <th>{{ report.faxes }}</th>
                        {% for custom_grouping in custom_groupings %}
                            <th>{% custom_grouping_counter_user snapshot report.user custom_grouping %}</th>
                        {% endfor %}
                        <th>{{ report.others }}</th>
                        <th>
                            <button type="button"
                                    class="btn btn-primary btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#member-details-modal"
                                    {% if report.main_character %}
                                    data-ajax_url="{% url "fleetcomp:user_details" snapshot.id report.main_character.character_ownership.user.id %}">
                            {% else %}
                                data-ajax_url="{% url "fleetcomp:user_details_orphans" snapshot.id %}">
                            {% endif %}
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </th>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Modals -->
    {% include "fleetcomp/modals/base.html" with modal_id="member-details-modal" modal_content_id="member-details-modal-content" %}
{% endblock %}
{% block extra_javascript %}
    {% include "bundles/datatables-js-bs5.html" %}
    {% include "fleetcomp/partials/handle_modals.html" %}
    {% include 'bundles/datatables-css-bs5.html' %}
    {% get_datatables_language_static LANGUAGE_CODE as DT_LANG_PATH %}
    <script>
        $(document).ready(() => {
            $('#memberTable').dataTable({
                language: {
                    url: '{{ DT_LANG_PATH }}'
                },
                order: [[ 0, "asc" ]],
                searching: false,
            })
        })
        handle_modal_events("member-details-modal", "member-details-modal-content");
    </script>
{% endblock %}
