import"./Bg9kRutz.mjs";import{i as fe}from"./DTpo0kgr.mjs";import{p as ce,b2 as mt,P as ee,b as V,c as N,d as ie,i as q,aN as X,f as te,g as e,h as ne,V as Z,r as J,al as H,b4 as Ne,s as u,n as Se,t as $e,m as I,Z as Kt,e as Je,l as ve,a as Le,b6 as rt,T as Ue,ao as Be,aq as zt,b7 as ct,b5 as it}from"./DvQPdglG.mjs";import{c as de,o as vt,e as E,s as ue}from"./DWmaQdPb.mjs";import{p as T,i as Te}from"./jy7gnWqU.mjs";import{r as Ut,av as Vt,u as we,q as pt,t as re,bH as Jt,bI as Zt,bJ as Gt,bK as Qt,T as bt}from"./CPHkA83Z.mjs";import{p as Xt,e as _t,i as Yt}from"./BlEmpLWb.mjs";import{b as yt}from"./CVnLI7kJ.mjs";import{r as en,p as ye,d as tn,e as nn,S as We,g as je,o as an,b as St,f as sn,s as on,h as ut,a as ln,i as rn}from"./DIzcoqFm.mjs";import{s as Pe,b as ft,a as ke}from"./B2Ge_TJA.mjs";import{s as pe,x as cn}from"./DMM0C4aT.mjs";import{d as un,w as Tt}from"./CAXUivPC.mjs";import{k as fn}from"./CGNlSiuz.mjs";import{b as L,I as wt,a as qe,t as dn,k as gn,l as hn,q as mn}from"./D8lmpAjW.mjs";import{a as Ze,W as kt,P as Ct,D as Fe}from"./CZh2Ebg6.mjs";import{c as vn}from"./Hy6HsZIe.mjs";import{b as Ge}from"./Bc5MJCE7.mjs";import{B as pn}from"./C2DEpp3z.mjs";import{W as bn}from"./DDHAe4hk.mjs";function $t(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function _n(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const Sa=Symbol("direction"),Qe=Symbol("tagActionsShortcuts");function yn(a,t,f){document.execCommand(a,t,f)}function At(a,t,f){if(!a.parentNode||a===t)return f;{const i=a.parentNode,w=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...f];return At(i,t,w)}}function dt(a,t){return At(a,t,[])}function Xe(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[f,...i]=t;return Xe(a.childNodes[f],i)}else return null}var Ye=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Ye||{});function Sn(a,t){const f=Math.min(a.coordinates.length,t.coordinates.length);for(let i=0;i<=f;i++){if(a.coordinates.length===i)return t.coordinates.length===i?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===i)return 1;if(a.coordinates[i]<t.coordinates[i])return-1;if(a.coordinates[i]>t.coordinates[i])return 1}throw new Error("compareLocations: Should never happen")}function Tn(a){const t=$t(a),f=_n(t);if(!f)return null;const i=f.collapsed,g={coordinates:dt(t.anchorNode,a),offset:t.anchorOffset};if(i)return{anchor:g,collapsed:i};const r={coordinates:dt(t.focusNode,a),offset:t.focusOffset},m=Sn(g,r)===Ye.After?"backward":"forward";return{anchor:g,focus:r,collapsed:i,direction:m}}function wn(a){a.empty()}function kn(a,t,f,i){const w=i.focus,g=w.offset,o=Xe(a,w.coordinates);i.direction==="forward"?(f.setEnd(o,g),t.addRange(f)):(t.addRange(f),t.extend(o,g))}function Cn(a){return Tn(a)}function $n(a,t){const f=$t(a);wn(f);const i=new Range,w=Xe(a,t.anchor.coordinates);i.setStart(w,t.anchor.offset),t.collapsed?(i.collapse(!0),f.addRange(i)):kn(a,f,i,t)}Ut("anki/location",{Position:Ye,restoreSelection:$n,saveSelection:Cn});const se="âˆ·";function Ve(a){return a.replace(/::/g,se)}function Me(a){return a.replace(/\u2237/gu,"::")}function gt(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(se);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(se);)t=t.slice(0,-1).trimEnd();return t}function Ke(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function An(a){return a.name}const Ae=Tt(null);un(Ae,a=>()=>a==null?void 0:a.blur());var Nn=q('<input type="text" tabindex="-1" size="1">');function Pn(a,t){ce(t,!1);const f=Pe(),i=()=>ke(Ae,"$currentTagInput",f);let w=T(t,"id",8,void 0),g=T(t,"class",8,""),o=T(t,"name",12),r=T(t,"input",12),h=T(t,"disabled",8);const m=de();function _(){return r().selectionStart===r().selectionEnd}function C(){return r().selectionStart===0&&r().selectionEnd===0}function v(){return r().selectionStart===r().value.length&&r().selectionEnd===r().value.length}function s(l){r().setSelectionRange(l,l)}function D(){return o().length===0}async function k(l){const S=r().value.length;m("tagjoinprevious"),await X(),s(r().value.length-S),l.preventDefault()}async function F(l,S){if(S>o().length)return;o().slice(0,S).endsWith(se)&&(o(o().slice(0,S-1)+o().slice(S,o().length)),await X(),l.preventDefault(),s(S-1),m("taginput"))}function R(l){C()?k(l):F(l,r().selectionStart)}async function W(l){const S=r().value.length;m("tagjoinnext"),await X(),s(S),l.preventDefault()}function j(l){v()?W(l):F(l,r().selectionStart+2)}function d(){o(gt(o())),o().length===0&&m("tagdelete"),m("tagaccept")}function O(l){m("tagsplit",{start:r().selectionStart,end:r().selectionEnd}),l.preventDefault()}async function P(l,S=!1){const A=r().selectionStart,Q=r().selectionEnd,B=o().slice(0,A),oe=o().slice(Q,o().length);if(B.endsWith(se)){l.preventDefault(),l.stopPropagation();return}else if(B.endsWith(":")){l.preventDefault(),o(`${B.slice(0,-1)}${se}${o().slice(Q,o().length)}`),await X(),s(A),m("taginput");return}else if(oe.startsWith(":"))l.preventDefault(),o(`${B}${se}${o().slice(Q+1,o().length)}`);else{if(S)return;l.preventDefault(),o(`${B}${se}${oe}`)}await X(),s(A+1),m("taginput")}function p(l){switch(l.code){case"Enter":O(l);break;case"Backspace":_()&&R(l);break;case"Delete":_()&&j(l);break}tn(l)?D()?k(l):C()&&(m("tagmoveprevious"),l.preventDefault()):nn(l)?D()?W(l):v()&&(m("tagmovenext"),l.preventDefault()):l.key===" "?P(l,!1):l.key===":"&&P(l,!0)}function $(l){const S=document.getSelection();l.clipboardData.setData("text/plain",Me(S.toString()))}async function M(l){$(l);const S=r().selectionStart,A=r().selectionEnd;o(o().slice(0,S)+o().slice(A)),await X(),s(S),m("taginput")}function K(l){if(!l.clipboardData)return;const A=(o()+l.clipboardData.getData("text/plain")).split(/\s+/).map(gt).filter(B=>B.length>0).map(Ve);if(A.length===0)return;const Q=A.pop();for(const B of A.reverse())o(B),m("tagadd");o(Q)}function G(l){o().length===0&&(l.preventDefault(),l.stopPropagation(),m("tagselectall"))}const{selectAllShortcut:ae}=mt(Qe);vt(()=>{en(G,ae,{target:r()}),r().focus()});function x(l){return ft(Ae,l),{destroy(){i()===l&&ft(Ae,null)}}}fe();var y=Nn();Vt(y),Ge(y,l=>r(l),()=>r()),ee(()=>vn(y,o)),ee(()=>E("focus",y,function(l){L.call(this,t,l)})),ee(()=>E("blur",y,ye(d))),ee(()=>E("keydown",y,p)),ee(()=>E("keydown",y,function(l){L.call(this,t,l)})),ee(()=>E("keyup",y,function(l){L.call(this,t,l)})),ee(()=>E("input",y,()=>m("taginput"))),ee(()=>E("copy",y,ye($))),ee(()=>E("cut",y,ye(M))),ee(()=>E("paste",y,ye(K))),Ze(y,l=>x==null?void 0:x(l)),V(()=>{var l;we(y,"id",w()),pt(y,`tag-input ${(l=g())!=null?l:""} svelte-1nk8ij0`),re(y,"disabled",h())}),N(a,y),ie()}var Dn=q("<!> <!>",1),En=q('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function xn(a,t){ce(t,!1);const f=Pe(),i=()=>ke(Ae,"$currentTagInput",f);let w=T(t,"keyCombination",8);const g=de();function o(){g("tagappend")}fe();var r=En(),h=te(r);const m=H(()=>{var k;return(k=Jt())!=null?k:""}),_=H(()=>{var k;return(k=je(w()))!=null?k:""});V(()=>we(h,"title",`${e(m)} (${e(_)})`));var C=ne(h);wt(C,{children:(k,F)=>{var R=Dn(),W=te(R);qe(W,{icon:dn});var j=Z(W,2);qe(j,{icon:gn}),N(k,R)},$$slots:{default:!0}});var v=Z(C,2),s=ne(v);pe(s,t,"default",{}),J(v),J(h);var D=Z(h,2);We(D,{get keyCombination(){return w()},$$events:{action:()=>g("tagappend")}}),V(()=>we(h,"tabindex",i()?-1:0)),E("click",h,o),E("focus",h,o),N(a,r),ie()}var In=q('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Rn=q("<!> <!> <!>",1);function Wn(a,t){ce(t,!1);const f=de();let i=I(!1);const{selectAllShortcut:w,copyShortcut:g,removeShortcut:o}=mt(Qe);fe(),kt(a,{get show(){return e(i)},preferredPlacement:"top",portalTarget:document.body,shift:0,children:Ne,$$slots:{default:(r,h)=>{const m=H(()=>h.asReference);var _=In(),C=Kt(()=>an(()=>u(i,!e(i)))),v=ne(_);wt(v,{children:(s,D)=>{qe(s,{icon:hn})},$$slots:{default:!0}}),J(_),Ze(_,s=>{var D;return(D=e(m))==null?void 0:D(s)}),ee(()=>E("click",_,()=>u(i,!e(i)))),ee(()=>E("keydown",_,function(...s){var D;(D=e(C))==null||D.apply(this,s)})),N(r,_)},floating:(r,h)=>{Ct(r,{slot:"floating",children:(m,_)=>{var C=Rn(),v=te(C);Fe(v,{$$events:{click:()=>f("tagselectall")},children:(k,F)=>{Se();var R=$e();const W=H(()=>{var d;return(d=Zt())!=null?d:""}),j=H(()=>{var d;return(d=je(w))!=null?d:""});V(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}});var s=Z(v,2);Fe(s,{$$events:{click:()=>f("tagcopy")},children:(k,F)=>{Se();var R=$e();const W=H(()=>{var d;return(d=Gt())!=null?d:""}),j=H(()=>{var d;return(d=je(g))!=null?d:""});V(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}});var D=Z(s,2);Fe(D,{$$events:{click:()=>f("tagdelete")},children:(k,F)=>{Se();var R=$e();const W=H(()=>{var d;return(d=Qt())!=null?d:""}),j=H(()=>{var d;return(d=je(o))!=null?d:""});V(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}}),N(m,C)},$$slots:{default:!0}})}}}),ie()}var jn=q('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function Mn(a,t){let f=T(t,"badgeHeight",12),i=T(t,"tagsSelected",8),w=T(t,"keyCombination",8);var g=jn(),o=ne(g);fn(o,i,r=>{var h=Je(),m=te(h);{var _=v=>{Wn(v,{$$events:{tagselectall(s){L.call(this,t,s)},tagcopy(s){L.call(this,t,s)},tagdelete(s){L.call(this,t,s)}}})},C=v=>{xn(v,{get keyCombination(){return w()},$$events:{tagappend(s){L.call(this,t,s)}}})};Te(m,v=>{i()?v(_):v(C,!1)})}N(r,h)}),J(g),St(g,"offsetHeight",f),E("mousedown",g,ye(function(r){L.call(this,t,r)})),N(a,g)}function Bn(a,t){let f=T(t,"class",8,"");pn(a,{get class(){var i;return`d-flex align-items-center ms-1 ${(i=f())!=null?i:""}`},iconSize:80,$$events:{click(i){L.call(this,t,i)}},children:(i,w)=>{qe(i,{icon:mn})},$$slots:{default:!0}})}var qn=q('<button tabindex="-1"><!></button>');function ze(a,t){ce(t,!1);let f=T(t,"class",8,""),i=T(t,"tagName",8),w=T(t,"tooltip",8,void 0),g=T(t,"selected",8,!1);const o=de();let r=I(!1);function h(){u(r,!0),setTimeout(()=>u(r,!1),300)}let m=I();vt(()=>o("mount",{button:e(m)})),fe();var _=qn(),C=ne(_);return pe(C,t,"default",{}),J(_),Ge(_,v=>u(m,v),()=>e(m)),V(()=>{var v;pt(_,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(v=f())!=null?v:""} svelte-1ywoj88`),we(_,"title",w()),we(_,"data-addon-tag",i()),re(_,"selected",g()),re(_,"flashing",e(r))}),E("mousemove",_,function(v){L.call(this,t,v)}),E("click",_,function(v){L.call(this,t,v)}),N(a,_),yt(t,"flash",h),ie({flash:h})}var Ln=q(" <!>",1),On=q("<span> </span> <!>",1),Hn=q("<span> </span> <!>",1),Fn=q('<div class="svelte-11ejbji"><!></div>');function Kn(a,t){ce(t,!1);const f=Pe(),i=()=>ke(Xt,"$pageTheme",f),w=I();let g=T(t,"name",8),o=T(t,"class",8,""),r=T(t,"tooltip",8),h=T(t,"selected",12),m=T(t,"active",8),_=T(t,"shorten",8),C=T(t,"flash",12);const v=de();let s=I(!1),D=I(!1);function k($){u(s,sn($)),u(D,on($))}function F(){e(D)?v("tagrange"):e(s)?v("tagselect"):v("tagclick")}function R($){const M=$.split(se);return M.length===1?$:`â€¦${se}`+M[M.length-1]}function W($){return $.split(se).length>1}const j="tag-icon-hover";ve(()=>(e(s),e(D)),()=>{u(w,e(s)||e(D))}),Le(),fe();var d=Fn();E("keydown",rt.body,k),E("keyup",rt.body,k);var O=ne(d);{var P=$=>{ze($,{get class(){return o()},get tagName(){return g()},$$events:{mousemove:k,click:F},children:(M,K)=>{Se();var G=Ln(),ae=te(G),x=Z(ae);pe(x,t,"default",{get selectMode(){return e(w)},hoverClass:j}),V(()=>{var y;return ue(ae,`${(y=g())!=null?y:""} `)}),N(M,G)},$$slots:{default:!0}})},p=$=>{var M=Je(),K=te(M);{var G=x=>{bn(x,{get tooltip(){return r()},trigger:"hover",placement:"top",children:Ne,$$slots:{default:(y,l)=>{const S=H(()=>l.createTooltip);ze(y,{get class(){return o()},get tagName(){return g()},get flash(){return C()},set flash(A){C(A)},get selected(){return h()},set selected(A){h(A)},$$events:{mousemove:k,click:F,mount:A=>e(S)(A.detail.button)},children:(A,Q)=>{var B=On(),oe=te(B),z=ne(oe,!0);V(()=>ue(z,R(g()))),J(oe);var Y=Z(oe,2);pe(Y,t,"default",{get selectMode(){return e(w)},hoverClass:j}),N(A,B)},$$slots:{default:!0},$$legacy:!0})}}})},ae=x=>{ze(x,{get class(){return o()},get tagName(){return g()},get flash(){return C()},set flash(y){C(y)},get selected(){return h()},set selected(y){h(y)},$$events:{mousemove:k,click:F},children:(y,l)=>{var S=Hn(),A=te(S),Q=ne(A,!0);J(A);var B=Z(A,2);pe(B,t,"default",{get selectMode(){return e(w)},hoverClass:j}),V(()=>ue(Q,g())),N(y,S)},$$slots:{default:!0},$$legacy:!0})};Te(K,x=>{_()&&W(g())?x(G):x(ae,!1)},!0)}N($,M)};Te(O,$=>{m()?$(P):$(p,!1)})}J(d),V(()=>{re(d,"select-mode",e(w)),re(d,"night-mode",i().isDark),re(d,"empty",g()==="")}),N(a,d),ie()}function zn(a,t){ce(t,!1);let f=T(t,"name",8),i=T(t,"class",8,""),w=T(t,"tooltip",8),g=T(t,"selected",8),o=T(t,"active",8),r=T(t,"shorten",8),h=T(t,"flash",8);const m=de();function _(){m("tagdelete")}fe(),Kn(a,{get name(){return f()},get class(){return i()},get tooltip(){return w()},get selected(){return g()},get active(){return o()},get shorten(){return r()},get flash(){return h()},$$events:{tagrange(C){L.call(this,t,C)},tagselect(C){L.call(this,t,C)},tagclick:()=>m("tagedit")},children:Ne,$$slots:{default:(C,v)=>{const s=H(()=>v.selectMode),D=H(()=>v.hoverClass);Bn(C,{get class(){return e(D)},$$events:{click:k=>{e(s)||(_(),k.stopPropagation())}}})}}}),ie()}var Un=q('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function Vn(a,t){var f=Un();E("click",f,function(i){L.call(this,t,i)}),N(a,f)}var Jn=q('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function ht(a,t){ce(t,!1);let f=T(t,"selected",8,!1),i=T(t,"active",8,!1),w=T(t,"suggestion",8),g=I();ve(()=>(Ue(f()),e(g)),()=>{f()&&e(g)&&e(g).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),Le();var o=Jn(),r=ne(o);pe(r,t,"default",{}),J(o),Ge(o,h=>u(g,h),()=>e(g)),V(()=>{we(o,"data-addon-suggestion",w()),re(o,"selected",f()),re(o,"active",i())}),E("mousedown",o,ye(function(h){L.call(this,t,h)})),E("mouseup",o,function(h){L.call(this,t,h)}),E("mouseenter",o,function(h){L.call(this,t,h)}),E("mouseleave",o,function(h){L.call(this,t,h)}),N(a,o),ie()}var Zn=q('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),Gn=q('<div class="autocomplete-menu svelte-1bkz961"></div>'),Qn=q('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Xn(a,t){ce(t,!1);const f=Pe(),i=()=>ke(g(),"$show",f);let w=T(t,"suggestionsPromise",8),g=T(t,"show",8),o=I([]),r=I(null),h=I(!1);const m=de();function _(){e(r)===null?u(r,0):e(r)>=e(o).length-1?u(r,null):Be(r)}function C(){e(r)===null?u(r,e(o).length-1):e(r)===0?u(r,null):Be(r,-1)}async function v(){var p;m("select",{selected:e(o)[(p=e(r))!=null?p:-1]})}async function s(){_(),await v()}async function D(){C(),await v()}async function k(){var p;e(o).length&&(u(h,!0),m("choose",{chosen:e(o)[(p=e(r))!=null?p:-1]}),await X(),g().set(!1))}async function F(){await X(),m("update")}function R(){return e(r)!==null}function W(){return{selectPrevious:D,selectNext:s,chooseSelected:k,update:F,hasSelected:R}}function j(p){u(r,p),u(h,!0)}function d(p){j(p)}async function O(p){u(h,!1),m("select",{selected:e(o)[p]})}function P(p,$){p.buttons===1&&j($)}ve(()=>(Ue(w()),Ue(g()),ut),()=>{w().then(p=>{g().set(p.length>0),ut()&&navigator.userAgent.match(/Chrome\/77/)&&(p=p.slice(0,10)),u(o,p)})}),Le(),fe(),kt(a,{keepOnKeyup:!0,get show(){return i()},preferredPlacement:"top",portalTarget:document.body,$$events:{close:()=>g().set(!1)},children:Ne,$$slots:{default:(p,$)=>{const M=H(()=>$.asReference);var K=Zn(),G=ne(K);pe(G,t,"default",{createAutocomplete:W}),J(K),Ze(K,ae=>{var x;return(x=e(M))==null?void 0:x(ae)}),N(p,K)},floating:(p,$)=>{var M=Qn(),K=te(M);bt(K,()=>({"--popover-padding-inline":"0"})),Ct(K.lastChild,{slot:"floating",children:(G,ae)=>{var x=Gn();_t(x,5,()=>e(o),Yt,(y,l,S)=>{var A=Je(),Q=te(A);{var B=z=>{ht(z,{selected:!0,get active(){return e(h)},get suggestion(){return e(l)},$$events:{mousedown:()=>d(S),mouseup:()=>{O(S),k()},mouseenter:Y=>P(Y,S),mouseleave:()=>u(h,!1)},children:(Y,De)=>{Se();var ge=$e();V(()=>ue(ge,e(l))),N(Y,ge)},$$slots:{default:!0}})},oe=z=>{ht(z,{get suggestion(){return e(l)},$$events:{mousedown:()=>d(S),mouseup:()=>{O(S),k()},mouseenter:Y=>P(Y,S)},children:(Y,De)=>{Se();var ge=$e();V(()=>ue(ge,e(l))),N(Y,ge)},$$slots:{default:!0}})};Te(Q,z=>{S===e(r)?z(B):z(oe,!1)})}N(y,A)}),J(x),N(G,x)},$$slots:{default:!0}}),J(K),N(p,M)}}}),ie()}var Yn=q("<!> <!> <!>",1),ea=q('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),ta=q('<!> <div class="tag-editor svelte-1tsu84n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!> <!></div>',1);function Ta(a,t){ce(t,!1);const f=Pe(),i=()=>ke(h(),"$tags",f),w=()=>ke(k,"$show",f),g=I(),o=I(),r=I();let h=T(t,"tags",8),m=T(t,"keyCombination",8,"Control+Shift+T");const _="Control+A",C="Control+C",v="Backspace";zt(Qe,{selectAllShortcut:_,copyShortcut:C,removeShortcut:v});let s=I();function D(n){u(s,n.map(c=>Ke(Ve(c))))}const k=Tt(!1),F=de(),R=Promise.resolve([]);let W=I(R);function j(){const n=e(s).map(c=>c.name).map(Me);F("tagsupdate",{tags:n}),u(W,R)}let d=I(null),O=null,P=I(""),p=I(),$=I(),M=I(!1);async function K(n){const{tags:c}=await cn({input:n,matchLimit:500});return c}const G=/^:?([^:].*?[^:]):?$/;function ae(){const c=e(s)[e(d)].name;if(u(M,c.length===0),e(M))u(W,R);else{const b=Me(c),U=G.test(b)?b.replace(G,"$1"):b;u(W,K(U).then(le=>(u(M,le.length===0),le.map(Ve))))}}function x(n){const c=e(s)[e(d)];u(P,n!=null?n:c.name);const b=e(p).value.length;e(p).setSelectionRange(b,b)}async function y(n){n.name=e(P),u(s,e(s)),await X(),e(p)&&e($).update()}function l(n){O===null&&(O=n)}function S(){be();const n=e(s)[e(s).length-1];(!n||n.name.length>0)&&A(e(s).length-1,"");const c=e(d)===null;u(d,null),c&&et()}function A(n,c){e(s).splice(n+1,0,Ke(c)),u(s,e(s)),l(n+1)}function Q(n){const c=e(s).map(An);c.splice(n,1);const b=c.indexOf(e(P));return b>=0?(e(s)[b>=n?b+1:b].flash(),!1):!0}async function B(n,c,b){const U=e(P).slice(0,c),le=e(P).slice(b);u(P,U),await X(),A(n,le),u(d,null),await X(),n!==e(d)&&e(p).setSelectionRange(0,0)}function oe(n){Q(n)&&(e(s).splice(n,0,Ke(e(P))),Be(d),u(s,e(s)))}function z(n){const c=e(s).splice(n,1)[0];return u(s,e(s)),O!==null&&O>n&&O--,c}function Y(n){return n===0}function De(n){return n===e(s).length-1}function ge(n){if(Y(n))return;const c=z(n-1);u(P,c.name+e(P)),Be(d,-1),y(e(s)[e(d)])}function Nt(n){if(De(n))return;const c=z(n+1);u(P,e(P)+c.name),y(e(s)[e(d)])}function Pt(n){Y(n)||(O=n-1,u(d,null),e(p).blur())}async function Dt(n){if(De(n)){e(P).length!==0&&(A(n,""),u(d,null));return}O=n+1,u(d,null),e(p).blur(),await X(),e(p).setSelectionRange(0,0)}function Et(n,c){e(s).includes(n)&&(Q(c)||z(c))}function et(){u(d,O),O=null}function xt(n){if(ln(n)){e($).selectPrevious(),n.preventDefault();return}else if(rn(n)){e($).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(w())n.shiftKey?e($).selectPrevious():e($).selectNext();else break;n.preventDefault();break;case"Enter":e($).chooseSelected(),n.preventDefault();break}}let Ce=null,Ee=null;function tt(n){it(s,e(s)[n].selected=!e(s)[n].selected),u(s,e(s)),Ce=n}function It(n){if(Ce===null){tt(n);return}Ee=n;const c=Math.min(Ce,Ee),b=Math.max(Ce,Ee);for(let U=c;U<=b;U++)it(s,e(s)[U].selected=!0);u(s,e(s))}function be(){u(s,e(s).map(n=>({...n,selected:!1}))),Ce=null,Ee=null}function Rt(n){const c=n.currentTarget;(n.relatedTarget===null||!c.contains(n.relatedTarget))&&be()}function Wt(n){const c=document.createElement("textarea");c.value=n,c.setAttribute("readonly",""),c.style.position="absolute",c.style.left="-9999px",document.body.appendChild(c),c.select(),yn("copy"),document.body.removeChild(c)}function Oe(){for(const n of e(s))n.selected=!0;u(s,e(s))}function nt(){const n=e(s).filter(c=>c.selected).map(c=>Me(c.name)).join(`
`);Wt(n),be()}function at(){e(s).map((n,c)=>[n.selected,c]).filter(([n])=>n).reverse().forEach(([,n])=>z(n)),be(),j()}let He=I(),xe=I();ve(()=>i(),()=>{D(i())}),ve(()=>(e(He),e(xe)),()=>{u(g,Math.floor(e(He)/e(xe)))}),ve(()=>(e(o),e(g)),()=>{u(o,e(o)||e(g)>2)}),ve(()=>e(s),()=>{u(r,e(s).some(n=>n.selected))}),Le(),fe();var st=ta(),ot=te(st);{var jt=n=>{var c=Yn(),b=te(c);We(b,{keyCombination:_,$$events:{action:Oe}});var U=Z(b,2);We(U,{keyCombination:C,$$events:{action:nt}});var le=Z(U,2);We(le,{keyCombination:v,$$events:{action:at}}),N(n,c)};Te(ot,n=>{e(r)&&n(jt)})}var Ie=Z(ot,2),Re=ne(Ie);bt(Re,()=>({"--icon-align":"baseline"})),Mn(Re.lastChild,{get tagsSelected(){return e(r)},get keyCombination(){return m()},get badgeHeight(){return e(xe)},set badgeHeight(n){u(xe,n)},$$events:{tagselectall:Oe,tagcopy:nt,tagdelete:at,tagappend:S},$$legacy:!0}),J(Re);var lt=Z(Re,2);_t(lt,3,()=>e(s),n=>n.id,(n,c,b)=>{var U=ea(),le=ne(U),Bt=H(()=>e(b)===e(d)?e(P):e(c).name),qt=H(()=>e(b)===e(d));zn(le,{class:"ms-0",get name(){return e(Bt)},get tooltip(){return e(c).name},get active(){return e(qt)},get shorten(){return e(o)},get flash(){return e(c).flash},set flash(he){e(c).flash=he,ct(()=>e(s))},get selected(){return e(c).selected},set selected(he){e(c).selected=he,ct(()=>e(s))},$$events:{tagedit:()=>{u(d,e(b)),be()},tagselect:()=>tt(e(b)),tagrange:()=>It(e(b)),tagdelete:()=>{be(),z(e(b)),j()}},$$legacy:!0});var Lt=Z(le,2);{var Ot=he=>{Xn(he,{get suggestionsPromise(){return e(W)},show:k,$$events:{update:ae,select:({detail:me})=>x(me.selected),choose:({detail:me})=>{x(me.chosen),B(e(b),me.chosen.length,me.chosen.length)}},children:Ne,$$slots:{default:(me,Ht)=>{const Ft=H(()=>Ht.createAutocomplete);Pn(me,{get id(){return e(c).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(M)},get name(){return e(P)},set name(_e){u(P,_e)},get input(){return e(p)},set input(_e){u(p,_e)},$$events:{focus:()=>{F("tagsFocused"),u(P,e(c).name),u($,e(Ft)())},keydown:xt,keyup:()=>{e(P).length===0&&(k==null||k.set(!1))},taginput:()=>y(e(c)),tagsplit:({detail:_e})=>B(e(b),_e.start,_e.end),tagadd:()=>oe(e(b)),tagdelete:()=>z(e(b)),tagselectall:async()=>{e(s).length<=1||(e(p).blur(),await X(),Oe())},tagjoinprevious:()=>ge(e(b)),tagjoinnext:()=>Nt(e(b)),tagmoveprevious:()=>Pt(e(b)),tagmovenext:()=>Dt(e(b)),tagaccept:()=>{Et(e(c),e(b)),e(c)&&y(e(c)),j(),et()}},$$legacy:!0})}}})};Te(Lt,he=>{e(b)===e(d)&&he(Ot)})}J(U),V(()=>re(U,"hide-tag",e(b)===e(d))),N(n,U)});var Mt=Z(lt,2);return Vn(Mt,{$$events:{click:S}}),J(Ie),E("focusout",Ie,Rt),St(Ie,"offsetHeight",n=>u(He,n)),N(a,st),yt(t,"appendEmptyTag",S),ie({appendEmptyTag:S})}export{Ta as T,Sa as d,yn as e};
