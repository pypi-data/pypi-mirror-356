import{j as N,n as C,c as s,o as a,a as u,F as q,x as T,t as d,b,w as p,d as h,k as S,r as w,l as D,m as z,v as R,s as G,q as j,A as I,z as L}from"./DenydyMN.js";import{u as M,r as J}from"./hPHynIdq.js";import{P as H,i as K,h as A,g as F,r as x}from"./Ch47lW9D.js";const Q={class:"table usa-table usa-table--borderless"},Z=u("thead",null,[u("tr",null,[u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Name"),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},[h(" Permissions "),u("br"),h(" (Resource Type - Resource ID - Method) ")]),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Actions")])],-1),W={class:"inline-input-left",style:{"max-width":"50ch"}},X={key:0},Y={key:1},O=N({__name:"group-list",props:{modelValue:{type:Array,required:!0}},emits:["addGroup","editGroup","deleteGroup"],setup(f,{emit:v}){const c=v,i=f;return(k,g)=>{const m=C("UsaButton");return a(),s("table",Q,[Z,(a(!0),s(q,null,T(i.modelValue,(o,_)=>(a(),s("tr",{key:_},[u("td",null,d(o.name),1),u("td",null,[(a(!0),s(q,null,T(o.permissions,(l,V)=>(a(),s("div",{key:V},[u("div",W,[l.resource_id===null?(a(),s("span",X,d(l.resource_type)+" - (All) - "+d(l.method),1)):(a(),s("span",Y,d(l.resource_type)+" - "+d(l.resource_id)+" - "+d(l.method),1))])]))),128))]),u("td",null,[b(m,{class:"secondary-button",onClick:l=>c("editGroup",o)},{default:p(()=>[h(" Edit ")]),_:2},1032,["onClick"]),b(m,{class:"usa-button usa-button--secondary",onClick:l=>c("deleteGroup",o.name)},{default:p(()=>[h(" Delete ")]),_:2},1032,["onClick"])])]))),128))])}}}),ee={key:0},te={class:"section-header"},oe={key:1},ae=u("label",{class:"usa-label"},"Permissions",-1),re={class:"multi-line-checkbox-div"},se={key:0},ne={key:1},ue={class:"submit-footer"},le=N({__name:"group-edit",props:{modelValue:{type:Object,required:!0},newGroupFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit"],async setup(f,{emit:v}){let c,i;const k=z(),g=S("token"),m=v,o=f,_=w({name:!1}),l=w([]),{data:V}=([c,i]=D(()=>M(k.public.apiPath+"/groups/permissions/details",{method:"GET",headers:{Authorization:"Bearer "+g.value}},"$peQZjwKbdh")),c=await c,i(),c);V.value&&V.value.forEach(r=>{l.value.push(new H(r.resource_type,r.resource_id,r.method,!1))}),l.value.forEach(r=>{o.modelValue.permissions.find(e=>e.resource_type===r.resource_type&&e.resource_id===r.resource_id&&e.method===r.method)&&(r.selected=!0)});function B(r,e){if(r)o.modelValue.permissions.push(new K(e.resource_type,e.resource_id,e.method));else{const t=o.modelValue.permissions.find(y=>y.resource_type===e.resource_type&&y.resource_id===e.resource_id&&y.method===e.method);if(t){const y=o.modelValue.permissions.indexOf(t);o.modelValue.permissions.splice(y,1)}}}function U(){_.value=J(_.value);let r=!1;o.newGroupFlag&&o.modelValue.name.trim()===""&&(_.value.name=!0,r=!0),!r&&m("submit",o.modelValue)}return(r,e)=>{const t=C("UsaTextInput"),y=C("UsaCheckbox"),$=C("UsaButton");return a(),s("div",null,[f.newGroupFlag?R("",!0):(a(),s("div",ee,[u("h2",te,d(f.modelValue.name),1)])),f.newGroupFlag?(a(),s("div",oe,[b(t,{modelValue:f.modelValue.name,"onUpdate:modelValue":e[0]||(e[0]=n=>f.modelValue.name=n),error:G(_).name},{label:p(()=>[h(" Group Name ")]),"error-message":p(()=>[h(" Group name is required ")]),_:1},8,["modelValue","error"])])):R("",!0),ae,u("div",re,[(a(!0),s(q,null,T(G(l),(n,P)=>(a(),s("span",{key:P,class:"multiple-per-line-checkbox"},[b(y,{modelValue:n.selected,"onUpdate:modelValue":[E=>n.selected=E,E=>B(n.selected,n)]},{default:p(()=>[n.resource_id===null?(a(),s("span",se,d(n.resource_type)+" - (All) - "+d(n.method),1)):(a(),s("span",ne,d(n.resource_type)+" - "+d(n.resource_id)+" - "+d(n.method),1))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),u("div",ue,[b($,{class:"primary-button",onClick:e[1]||(e[1]=n=>m("cancel"))},{default:p(()=>[h(" Cancel ")]),_:1}),b($,{class:"primary-button",onClick:U},{default:p(()=>[h(" Save ")]),_:1})])])}}}),ce=u("title",null,"Manage Groups",-1),de={key:0},ie={key:1},he=N({__name:"manage-groups",setup(f){const v=z(),c=S("token"),i=w(!1),k=w(!1),g=w([]),m=w(new F);o();async function o(){await $fetch(v.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+c.value},onRequestError(){x()},onResponse({response:e}){e.ok&&e._data.forEach(t=>{g.value.push(new F(t.name,t.permissions))})},onResponseError({response:e}){A(e.status,e._data.error_description)}})}function _(){m.value=new F}function l(){_(),i.value=!0,k.value=!0}function V(e){m.value=e,i.value=!0,k.value=!1}async function B(e){confirm("Are you sure you want to delete the group: "+e+"?")&&await $fetch(v.public.apiPath+"/group/"+e,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+c.value},onRequestError(){x()},onResponse({response:t}){t.ok&&o()},onResponseError({response:t}){A(t.status,t._data.error_description)}})}function U(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(i.value=!1,_())}async function r(e){try{k.value?await $fetch(v.public.apiPath+"/group",{retry:0,method:"POST",headers:{Authorization:"Bearer "+c.value},body:JSON.stringify(e),onRequestError(){x()},onResponse({response:t}){t.ok&&o()},onResponseError({response:t}){A(t.status,t._data.error_description)}}):await $fetch(v.public.apiPath+"/group",{retry:0,method:"PUT",headers:{Authorization:"Bearer "+c.value},body:JSON.stringify(e),onRequestError(){x()},onResponse({response:t}){t.ok&&o()},onResponseError({response:t}){A(t.status,t._data.error_description)}})}catch(t){console.log("Error in submit."),console.log(t);return}alert("Group has been saved successfully."),_(),i.value=!1}return(e,t)=>{const y=C("UsaButton"),$=O,n=le,P=I;return a(),j(P,{name:"base-layout"},{"page-title":p(()=>[h("Manage Groups")]),default:p(()=>[ce,G(i)?R("",!0):(a(),s("div",de,[b(y,{class:"secondary-button sub-header-float-button",onClick:l},{default:p(()=>[h(" Add Group ")]),_:1}),b($,{modelValue:G(g),"onUpdate:modelValue":t[0]||(t[0]=E=>L(g)?g.value=E:null),onEditGroup:V,onDeleteGroup:B},null,8,["modelValue"])])),G(i)?(a(),s("div",ie,[b(n,{modelValue:G(m),"onUpdate:modelValue":t[1]||(t[1]=E=>L(m)?m.value=E:null),"new-group-flag":G(k),onCancel:U,onSubmit:r},null,8,["modelValue","new-group-flag"])])):R("",!0)]),_:1})}}});export{he as default};
