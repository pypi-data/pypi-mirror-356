import{j as T,n as x,c as U,o as p,a as n,F as M,x as I,t as $,b as c,w as r,d as t,k as L,r as _,l as K,m as J,v as k,q as z,s as m,z as G,A as O}from"./DenydyMN.js";import{u as Q,r as W}from"./hPHynIdq.js";import{f as X,g as Y,h as q,r as N,U as j}from"./Ch47lW9D.js";import{i as Z}from"./0wQYiv8f.js";import"./Ch7Mx1Yh.js";const ee={class:"table usa-table usa-table--borderless"},ae=n("thead",null,[n("tr",null,[n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Username"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Email"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Full Name"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Disabled"),n("th",{scope:"col",role:"columnheader"},"Actions")])],-1),oe={class:"centered-container",style:{"margin-bottom":"1.5em"}},le=T({__name:"user-list",props:{modelValue:{type:Array,required:!0}},emits:["addUser","editUser","deleteUser"],setup(s,{emit:g}){const V=g,P=s;return(v,C)=>{const w=x("UsaCheckbox"),a=x("UsaButton");return p(),U("table",ee,[ae,n("tbody",null,[(p(!0),U(M,null,I(P.modelValue,(u,h)=>(p(),U("tr",{key:h},[n("td",null,$(u.username),1),n("td",null,$(u.email),1),n("td",null,$(u.full_name),1),n("td",null,[n("div",oe,[c(w,{modelValue:u.disabled,"onUpdate:modelValue":E=>u.disabled=E,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),n("td",null,[c(a,{class:"secondary-button",onClick:E=>V("editUser",u)},{default:r(()=>[t(" Edit ")]),_:2},1032,["onClick"]),c(a,{class:"usa-button usa-button--secondary",onClick:E=>V("deleteUser",u.username)},{default:r(()=>[t(" Delete ")]),_:2},1032,["onClick"])])]))),128))])])}}}),te={key:0},se={class:"section-header",style:{display:"inline"}},re={key:2},ne={key:1},ue={class:"multi-line-checkbox-div"},de=n("label",{class:"usa-label"},"Groups",-1),ie={key:0},me=n("b",null,"create-model",-1),ce={class:"submit-footer"},fe=T({__name:"user-edit",props:{modelValue:{type:Object,required:!0},newUserFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(s,{emit:g}){let V,P;const v=J(),C=L("token"),w=g,a=s,u=_(!1),h=_(""),E=_([{value:"admin",text:"admin"},{value:"regular",text:"regular"}]),f=_({username:!1,role:!1,password:!1,confirmPassword:!1}),R=_([]),{data:B}=([V,P]=K(()=>Q(v.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+C.value}},"$nP0SpmB8gV")),V=await V,P(),V);B.value&&B.value.forEach(i=>{R.value.push(new X(i.name,i.permissions,!1))}),R.value.forEach(i=>{a.modelValue.groups.find(e=>e.name===i.name)&&(i.selected=!0)}),a.newUserFlag&&(a.modelValue.role="regular");function F(){u.value=!0,a.modelValue.password=""}function S(){u.value=!1,delete a.modelValue.password}function d(i,e){if(i)a.modelValue.groups.push(new Y(e.name,e.permissions));else{const y=a.modelValue.groups.find(b=>b.name===e.name);if(y){const b=a.modelValue.groups.indexOf(y);a.modelValue.groups.splice(b,1)}}}async function l(){f.value=W(f.value);let i=!1;if(a.newUserFlag&&(a.modelValue.username.trim()===""&&(f.value.username=!0,i=!0),a.modelValue.password&&a.modelValue.password.trim()===""&&(f.value.password=!0,i=!0)),u.value&&(a.modelValue.password&&a.modelValue.password.trim()===""&&(f.value.password=!0,i=!0),a.modelValue.password!==h.value&&(f.value.confirmPassword=!0,i=!0)),a.modelValue.role.trim()===""&&(f.value.role=!0,i=!0),i){Z();return}w("submit",a.modelValue)}return(i,e)=>{const y=x("UsaButton"),b=x("UsaTextInput"),A=x("UsaCheckbox"),H=x("UsaSelect");return p(),U("div",null,[s.newUserFlag?k("",!0):(p(),U("div",te,[n("h2",se,$(s.modelValue.username),1),m(u)?k("",!0):(p(),z(y,{key:0,class:"secondary-button sub-header-float-button",onClick:F},{default:r(()=>[t(" Change Password ")]),_:1})),m(u)?(p(),z(y,{key:1,class:"secondary-button sub-header-float-button",onClick:S},{default:r(()=>[t(" Cancel Change ")]),_:1})):k("",!0),m(u)?(p(),U("div",re,[c(b,{modelValue:s.modelValue.password,"onUpdate:modelValue":e[0]||(e[0]=o=>s.modelValue.password=o),error:m(f).password,type:"password"},{label:r(()=>[t(" New Password ")]),"error-message":r(()=>[t(" Password is required ")]),_:1},8,["modelValue","error"]),c(b,{modelValue:m(h),"onUpdate:modelValue":e[1]||(e[1]=o=>G(h)?h.value=o:null),error:m(f).confirmPassword,type:"password"},{label:r(()=>[t(" Confirm New Password ")]),"error-message":r(()=>[t(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):k("",!0)])),s.newUserFlag?(p(),U("div",ne,[c(b,{modelValue:s.modelValue.username,"onUpdate:modelValue":e[2]||(e[2]=o=>s.modelValue.username=o),error:m(f).username},{label:r(()=>[t(" Username ")]),"error-message":r(()=>[t(" Username is required ")]),_:1},8,["modelValue","error"]),c(b,{modelValue:s.modelValue.password,"onUpdate:modelValue":e[3]||(e[3]=o=>s.modelValue.password=o),error:m(f).password,type:"password"},{label:r(()=>[t(" Password ")]),"error-message":r(()=>[t(" Password is required ")]),_:1},8,["modelValue","error"])])):k("",!0),c(b,{modelValue:s.modelValue.email,"onUpdate:modelValue":e[4]||(e[4]=o=>s.modelValue.email=o)},{label:r(()=>[t(" Email ")]),_:1},8,["modelValue"]),c(b,{modelValue:s.modelValue.full_name,"onUpdate:modelValue":e[5]||(e[5]=o=>s.modelValue.full_name=o)},{label:r(()=>[t(" Full Name ")]),_:1},8,["modelValue"]),c(A,{modelValue:s.modelValue.disabled,"onUpdate:modelValue":e[6]||(e[6]=o=>s.modelValue.disabled=o),label:"Disabled"},null,8,["modelValue"]),c(H,{modelValue:s.modelValue.role,"onUpdate:modelValue":e[7]||(e[7]=o=>s.modelValue.role=o),options:m(E),error:m(f).role,onChange:e[8]||(e[8]=o=>m(f).role=!1)},{label:r(()=>[t(" Role ")]),"error-message":r(()=>[t(" A role must be selected ")]),_:1},8,["modelValue","options","error"]),n("div",ue,[de,s.newUserFlag?(p(),U("div",ie,[t(" User will automatically be added to the "),me,t(" group upon submission. ")])):k("",!0),(p(!0),U(M,null,I(m(R),o=>(p(),U("span",{key:o.name,class:"multiple-per-line-checkbox"},[c(A,{modelValue:o.selected,"onUpdate:modelValue":[D=>o.selected=D,D=>d(o.selected,o)]},{default:r(()=>[t($(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),n("div",ce,[c(y,{class:"primary-button",onClick:e[9]||(e[9]=o=>w("cancel"))},{default:r(()=>[t(" Cancel ")]),_:1}),c(y,{class:"primary-button",onClick:l},{default:r(()=>[t(" Save ")]),_:1})])])}}}),pe=n("title",null,"Manage Users",-1),Ve={key:0},be={key:1},_e=T({__name:"manage-users",setup(s){const g=J(),V=L("token"),P=L("user"),v=_(!1),C=_(!1),w=_([]),a=_(new j);u(),h();async function u(){await $fetch(g.public.apiPath+"/users/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+V.value},onRequestError(){N()},onResponse({response:d}){d.ok&&(w.value=d._data)},onResponseError({response:d}){q(d.status,d._data.error_description)}})}function h(){a.value=new j}function E(){h(),v.value=!0,C.value=!0}function f(d){a.value=d,v.value=!0,C.value=!1}async function R(d){if(P.value===d){alert("Cannot delete the active user.");return}confirm("Are you sure you want to delete user, "+d+"?")&&await $fetch(g.public.apiPath+"/user/"+d,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+V.value},onRequestError(){N()},onResponse({response:l}){l.ok&&u()},onResponseError({response:l}){q(l.status,l._data.error_description)}})}function B(){v.value&&F()}function F(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(v.value=!1,h())}async function S(d){try{C.value?await $fetch(g.public.apiPath+"/user",{retry:0,method:"POST",headers:{Authorization:"Bearer "+V.value},body:JSON.stringify(d),onRequestError(){N()},onResponse({response:l}){l.ok&&u()},onResponseError({response:l}){q(l.status,l._data.error_description)}}):await $fetch(g.public.apiPath+"/user",{retry:0,method:"PUT",body:JSON.stringify(d),headers:{Authorization:"Bearer "+V.value},onRequestError(){N()},onResponse({response:l}){l.ok&&u()},onResponseError({response:l}){q(l.status,l._data.error_description)}})}catch(l){console.log("Error in submit."),console.log(l);return}alert("User has been saved successfully."),h(),v.value=!1}return(d,l)=>{const i=x("UsaButton"),e=le,y=fe,b=O;return p(),z(b,{name:"base-layout",onManageUsers:B},{"page-title":r(()=>[t("Manage Users")]),default:r(()=>[pe,m(v)?k("",!0):(p(),U("div",Ve,[c(i,{class:"secondary-button sub-header-float-button",onClick:E},{default:r(()=>[t(" Add User ")]),_:1}),c(e,{modelValue:m(w),"onUpdate:modelValue":l[0]||(l[0]=A=>G(w)?w.value=A:null),onEditUser:f,onDeleteUser:R},null,8,["modelValue"])])),m(v)?(p(),U("div",be,[c(y,{modelValue:m(a),"onUpdate:modelValue":l[1]||(l[1]=A=>G(a)?a.value=A:null),"new-user-flag":m(C),onCancel:F,onSubmit:S},null,8,["modelValue","new-user-flag"])])):k("",!0)]),_:1})}}});export{_e as default};
