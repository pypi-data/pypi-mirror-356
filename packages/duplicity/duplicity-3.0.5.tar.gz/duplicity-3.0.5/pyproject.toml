[project]
name = "duplicity"
version = "3.0.5"
dynamic = ["dependencies", "optional-dependencies"]
description = "Encrypted backup using rsync algorithm"
authors = [
    { name = "Kenneth Loafman", email = "kenneth@loafman.com" },
]
maintainers = [
    { name = "Edgar Soldin" },
    { name = "Thomas Laubrock" },
]
readme = { file = "README.md", content-type = "text/markdown" }
requires-python = ">= 3.8, < 3.14"
# TODO: switch to PEP 639 string after dropping 3.8 support
license = { text = "GPL-2.0-or-later" }
classifiers = [
    "Development Status :: 6 - Mature",
    "Environment :: Console",
    "Operating System :: MacOS",
    "Operating System :: POSIX",
    "Programming Language :: C",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: System :: Archiving :: Backup",
]


[build-system]
requires = ["setuptools>=68.1.0"]
build-backend = "setuptools.build_meta"


[project.scripts]
duplicity = "duplicity.__main__:dup_run"


[project.urls]
Homepage = "http://duplicity.us"
Download = "https://gitlab.com/duplicity/duplicity/-/releases"
Issues = "https://gitlab.com/duplicity/duplicity/-/issues"
Contact = "https://lists.nongnu.org/mailman/listinfo/duplicity-talk"
Documentation = "http://duplicity.us"
Repository = "https://gitlab.com/duplicity/duplicity"
Changelog = "https://gitlab.com/duplicity/duplicity/-/blob/main/CHANGELOG.md"


[tool.setuptools.dynamic]
dependencies = { file = "requirements.txt" }
optional-dependencies.dev = { file = "requirements.dev" }


[tool.setuptools.packages.find]
include = ["duplicity*"]


[tool.black]
line-length = 120
required-version="24"
target-version = [
    "py39",
    "py310",
    "py311",
    "py312",
    "py313",
]


[tool.pytest.ini_options]
filterwarnings = [
    "ignore:.*use of fork\\(\\).*:DeprecationWarning",
    "ignore:.*ssl.PROTOCOL_TLS is deprecated.*:DeprecationWarning",
    "ignore:.*pkg_resources.*:DeprecationWarning",
]
addopts = [
    "--capture=fd",
    "--failed-first",
    "--showlocals",
    "--verbose",
    "-p no:hypothesis",
    "-p no:randomly",
    "-p no:xdist",
]
markers = [
    "slow: test runs >= 10 secs",
]
testpaths = [
    "testing/test_code.py",
    "testing/unit",
    "testing/functional",
]


[tool.cibuildwheel]
archs = [
    "x86_64",
]
build = [
    "cp{38,39,310,311,312,313}-manylinux_x86_64",
]
before-build = [
    # WARNING: wheel builds are Centos based, not Debian.
    "yum install -y gcc gcc-c++ make git intltool lftp librsync-devel",
    "yum install -y libffi-devel openssl-devel openssl par2cmdline rdiff-backup tzdata",
    "python -m pip install -r requirements.txt",
    "python ./setup.py build_ext",
]


[tool.pylint]
jobs = 8
errors-only = "yes"
ignore = "_librsync.so"
msg-template = '{path}:{line}: [{msg_id}({symbol}), {obj}] {msg}'
disable = [
        "C",
        "R",
        "invalid-name",
        "line-too-long",
        "missing-function-docstring",
        "missing-module-docstring",
        "no-member",
        "no-name-in-module",
        "not-callable",
        "possibly-used-before-assignment",
        "raise-missing-from",
        "unexpected-keyword-arg",
        "undefined-variable",
        "wrong-import-order",
        "wrong-import-position",
]
enable = [
        "unused-argument",
        "access-member-before-definition",
        "unused-wildcard-import",
        "redefined-builtin",
        "bad-indentation",
        "mixed-indentation",
        "unreachable",
]
