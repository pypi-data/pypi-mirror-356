---
description: 
globs: 
alwaysApply: false
---
# Dungeon Master CLI Command Reference

This document provides a comprehensive reference for all Dungeon Master CLI commands, their options, and example outputs.

## Core Commands Overview

Dungeon Master provides these primary commands:

1. **`dm init`** - Initialize the Dungeon Master environment
2. **`dm validate`** - Core pre-commit hook functionality
3. **`dm review`** - Display documentation status
4. **`dm create_lore`** - Create missing documentation files
5. **`dm map`** - Generate visual repository structure

## Command Details

### 1. `dm init`

Initializes the Dungeon Master environment in your repository.

**Usage:**
```bash
dm init
```

**Actions:**
- Creates `.lore/` directory if it doesn't exist
- Generates `cursor.rules` file
- Creates empty `dmconfig.json` and `dmcache.json` files
- Updates `.gitignore` to exclude `dmcache.json`
- Sets up pre-commit hook

**Example Output:**
```
âœ¨ [bold green]Initializing Dungeon Master[/bold green] âœ¨

ğŸ“ Creating directory structure...
  âœ… Created [cyan].lore/[/cyan] directory
  
ğŸ“ Creating configuration files...
  âœ… Created [cyan]dmconfig.json[/cyan]
  âœ… Created [cyan]dmcache.json[/cyan]
  
ğŸ”® Setting up gitignore...
  âœ… Updated [cyan].gitignore[/cyan] to exclude [cyan]dmcache.json[/cyan]
  
ğŸ§™ Creating Cursor rules...
  âœ… Generated [cyan]cursor.rules[/cyan]
  
[bold green]Initialization complete! Your project is now protected by Dungeon Master.[/bold green]
```

### 2. `dm validate`

Core pre-commit hook functionality that verifies documentation is up-to-date.

**Usage:**
```bash
dm validate
```

**Actions:**
- Verifies each tracked file has corresponding lore file
- Checks that changed tracked files have updated lore
- Ensures lore files contain more than just template content
- Detects placeholder text in required sections
- Validates professional diagrams are included when required
- Blocks commits when validation fails

**Example Output:**
```
ğŸ”’ [bold green]Validating Documentation[/bold green] ğŸ”’

ğŸ” Checking git staged changes...
  Found 4 changed files with track_lore decorators

ğŸ“ Checking documentation status...
  âœ“ [cyan]src/models/user.py[/cyan] â†’ [cyan].lore/users.md[/cyan] [bold green]UPDATED[/bold green]
  âœ“ [cyan]src/api/payouts.py[/cyan] â†’ [cyan].lore/payments-platform/payouts.md[/cyan] [bold green]UPDATED[/bold green]
  âœ— [cyan]src/api/payment.py[/cyan] â†’ [cyan].lore/payments.md[/cyan] [bold red]NOT UPDATED[/bold red]
  âœ— [cyan]src/auth/login.py[/cyan] â†’ [cyan].lore/auth/login.md[/cyan] [bold yellow]TEMPLATE ONLY[/bold yellow]

âŒ [bold red]VALIDATION FAILED[/bold red]

[bold yellow]REQUIRED ACTIONS:[/bold yellow]
  1. UPDATE [cyan].lore/payments.md[/cyan] TO REFLECT CHANGES IN [cyan]src/api/payment.py[/cyan]
     REVIEW ALL FILES TRACKED BY THIS LORE FILE:
     - src/api/payment.py
     - src/api/payment_processor.py
     
  2. COMPLETE [cyan].lore/auth/login.md[/cyan] TEMPLATE WITH ACTUAL DOCUMENTATION
     REVIEW ALL FILES TRACKED BY THIS LORE FILE:
     - src/auth/login.py
     
     MISSING REQUIRED SECTIONS: Overview, Key Functions/Components, Diagrams

ğŸ›‘ [bold red]COMMIT BLOCKED: UPDATE DOCUMENTATION BEFORE PROCEEDING[/bold red]
```

### 3. `dm review`

Displays documentation status using rich formatting.

**Usage:**
```bash
dm review [options]
```

**Options:**
```
--mark-reviewed <file>  Mark a file as reviewed (use with EXTREME caution)
```

**Actions:**
- Shows table with lore file paths
- Lists all files associated with each lore document
- Highlights lore files requiring updates based on changed source files
- Identifies lore files that still contain template placeholders
- Provides clear visualization of documentation needs

**Example Output:**
```
ğŸ” [bold green]Documentation Review[/bold green] ğŸ”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ [bold]Lore File[/bold]                      â”ƒ [bold]Tracked Files[/bold]                              â”ƒ [bold]Status[/bold]              â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ .lore/payments.md              â”‚ src/api/payment.py [bold yellow][changed][/bold yellow]               â”‚ [bold red]NEEDS UPDATE[/bold red]         â”‚
â”‚                               â”‚ src/api/payment_processor.py                  â”‚                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .lore/payments-platform/      â”‚ src/api/payouts.py                            â”‚ [bold green]UP TO DATE[/bold green]         â”‚
â”‚ payouts.md                    â”‚                                                â”‚                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .lore/users.md                â”‚ src/models/user.py                             â”‚ [bold green]UP TO DATE[/bold green]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .lore/auth/login.md           â”‚ src/auth/login.py                              â”‚ [bold yellow]TEMPLATE ONLY[/bold yellow]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â— [bold yellow]REQUIRED ACTIONS:[/bold yellow]
  â†’ UPDATE [cyan].lore/payments.md[/cyan] TO REFLECT CHANGES IN [cyan]src/api/payment.py[/cyan]
    REVIEW THESE FILES TO UNDERSTAND THE ENTIRE SYSTEM:
    - src/api/payment.py
    - src/api/payment_processor.py
    
  â†’ COMPLETE [cyan].lore/auth/login.md[/cyan] TEMPLATE WITH ACTUAL DOCUMENTATION
    REVIEW THESE FILES TO UNDERSTAND THE ENTIRE SYSTEM:
    - src/auth/login.py
```

#### The `--mark-reviewed` Option

**CRITICAL WARNING: RESTRICTED USE ONLY**

The `--mark-reviewed` option exists as an emergency override for extremely specific cases. It should be used with extreme caution and only after thorough evaluation.

**Usage:**
```bash
dm review --mark-reviewed <file>
```

**When to use:**
- ONLY when file changes are so minor they have absolutely NO impact on documentation accuracy
- ONLY after thoroughly reviewing both the code changes and existing documentation
- ONLY when you can confidently confirm the documentation remains accurate

**Example (proper use):**
```bash
# A file with only formatting changes or typo fixes
dm review --mark-reviewed src/api/payment.py
```

**WARNING: NEVER use for:**
- Changes that affect behavior documented in the lore file
- Changes that add or remove functionality
- Changes that modify interfaces or APIs
- When rushing to meet deadlines
- When you're uncertain about documentation impact

**Accountability:**
All uses of this override are logged and should be justified in commit messages.

### 4. `dm create_lore`

Creates missing documentation files based on track_lore decorators.

**Usage:**
```bash
dm create_lore [lore_file]
```

**Parameters:**
- `lore_file` (optional) - Specific lore file to create

**Actions:**
- Scans all decorators in codebase
- Creates empty lore files that don't exist yet
- Creates any necessary subdirectories within `.lore/`
- Populates new files with the standard documentation template

**Example Output:**
```
ğŸ”® [bold green]Creating Lore Files[/bold green] ğŸ”®

ğŸ” Scanning for track_lore decorators...
  Found 5 unique lore files referenced in code

ğŸ“ Checking documentation status...
  âœ… [cyan].lore/payments.md[/cyan] (exists)
  âœ… [cyan].lore/payments-platform/payouts.md[/cyan] (exists)
  âœ… [cyan].lore/users.md[/cyan] (exists)
  âŒ [cyan].lore/config.md[/cyan] (missing)
  âŒ [cyan].lore/auth/login.md[/cyan] (missing)
  
ğŸ“ Creating necessary directories...
  âœ… Created [cyan].lore/auth/[/cyan] directory
  
ğŸ“‘ Creating missing lore files with templates...
  âœ… Created [cyan].lore/config.md[/cyan] with documentation template
  âœ… Created [cyan].lore/auth/login.md[/cyan] with documentation template

âœ¨ [bold green]Complete![/bold green] All lore files are now created.
âš ï¸ [bold yellow]WARNING:[/bold yellow] FILL OUT ALL TEMPLATES WITH ACTUAL DOCUMENTATION BEFORE COMMITTING.
```

### 5. `dm map`

Generates a visual representation of repository structure.

**Usage:**
```bash
dm map
```

**Actions:**
- Creates a file tree map of all tracked files
- Shows relationships between source files and documentation
- Saves output as `map.md` in `.lore/` directory

**Example Output:**
```
ğŸ“Š [bold green]Generating Repository Map[/bold green] ğŸ“Š

ğŸ” Scanning repository structure...

ğŸ“‚ [bold]Project Tree:[/bold]
â”œâ”€â”€ ğŸ“ src/
â”‚  â”œâ”€â”€ ğŸ“„ api/
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ payment.py [italic yellow](mdc:tracked by .lore/payments.md)[/italic yellow]
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ payment_processor.py [italic yellow](mdc:tracked by .lore/payments.md)[/italic yellow]
â”‚  â”‚  â””â”€â”€ ğŸ“„ payouts.py [italic yellow](mdc:tracked by .lore/payments-platform/payouts.md)[/italic yellow]
â”‚  â”œâ”€â”€ ğŸ“„ models/
â”‚  â”‚  â””â”€â”€ ğŸ“„ user.py [italic yellow](mdc:tracked by .lore/users.md)[/italic yellow]
â”‚  â”œâ”€â”€ ğŸ“„ auth/
â”‚  â”‚  â””â”€â”€ ğŸ“„ login.py [italic yellow](mdc:tracked by .lore/auth/login.md)[/italic yellow]
â”‚  â””â”€â”€ ğŸ“„ main.py [italic yellow](mdc:tracked by .lore/app.md)[/italic yellow]
â”œâ”€â”€ ğŸ“ tests/
â”‚  â””â”€â”€ ğŸ“„ test_payment.py
â””â”€â”€ ğŸ“ .lore/
   â”œâ”€â”€ ğŸ“„ payments.md
   â”œâ”€â”€ ğŸ“ payments-platform/
   â”‚  â””â”€â”€ ğŸ“„ payouts.md
   â”œâ”€â”€ ğŸ“„ users.md
   â”œâ”€â”€ ğŸ“ auth/
   â”‚  â””â”€â”€ ğŸ“„ login.md
   â””â”€â”€ ğŸ“„ app.md

âœ… Map generated and saved to [cyan].lore/map.md[/cyan]
```

## Command Combinations

### Common Workflows

#### Initial Setup
```bash
dm init
# Add track_lore decorators to files
dm create_lore
# Fill out documentation templates
```

#### Check Documentation Status
```bash
dm review
```

#### Prepare for Commit
```bash
dm validate
# Address any issues
git add .
git commit -m "Your commit message"
```

#### Force Documentation Creation
```bash
dm create_lore
```

## Error Handling

### Common Errors

#### Missing Configuration
```
âŒ Error: Dungeon Master not initialized in this repository.
Run `dm init` to set up Dungeon Master.
```

#### Invalid Decorator Format
```
âš ï¸ Warning: Invalid track_lore format in src/api/payment.py:
# track_lore(payments.md)
Should be: # track_lore("payments.md")
```

#### Pre-commit Hook Failure
```
âŒ Pre-commit hook failed: Documentation validation failed.
Run `dm validate` for details.
```

## Environment Variables

### Configuration Options
- `DM_CONFIG_PATH` - Custom path to config file
- `DM_LORE_DIR` - Custom documentation directory
- `DM_DISABLE_COLORS` - Disable colored output
- `DM_LOG_LEVEL` - Set logging level (debug, info, warning, error)
