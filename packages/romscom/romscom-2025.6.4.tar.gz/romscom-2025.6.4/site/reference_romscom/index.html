
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../bio_toy_example/">
      
      
        <link rel="next" href="../reference_rcutils/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>romscom - ROMS Communication Toolbox (romscom)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#romscom.romscom" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ROMS Communication Toolbox (romscom)" class="md-header__button md-logo" aria-label="ROMS Communication Toolbox (romscom)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ROMS Communication Toolbox (romscom)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              romscom
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ROMS Communication Toolbox (romscom)" class="md-nav__button md-logo" aria-label="ROMS Communication Toolbox (romscom)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ROMS Communication Toolbox (romscom)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Information
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bio_toy_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A bio_toy sensitivity study
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    romscom
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    romscom
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom" class="md-nav__link">
    <span class="md-ellipsis">
      romscom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.converttimes" class="md-nav__link">
    <span class="md-ellipsis">
      converttimes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.dict2standardin" class="md-nav__link">
    <span class="md-ellipsis">
      dict2standardin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.readparamfile" class="md-nav__link">
    <span class="md-ellipsis">
      readparamfile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.runtodate" class="md-nav__link">
    <span class="md-ellipsis">
      runtodate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.setoutfilenames" class="md-nav__link">
    <span class="md-ellipsis">
      setoutfilenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.simfolders" class="md-nav__link">
    <span class="md-ellipsis">
      simfolders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.stringifyvalues" class="md-nav__link">
    <span class="md-ellipsis">
      stringifyvalues
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference_rcutils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rcutils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom" class="md-nav__link">
    <span class="md-ellipsis">
      romscom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.converttimes" class="md-nav__link">
    <span class="md-ellipsis">
      converttimes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.dict2standardin" class="md-nav__link">
    <span class="md-ellipsis">
      dict2standardin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.readparamfile" class="md-nav__link">
    <span class="md-ellipsis">
      readparamfile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.runtodate" class="md-nav__link">
    <span class="md-ellipsis">
      runtodate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.setoutfilenames" class="md-nav__link">
    <span class="md-ellipsis">
      setoutfilenames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.simfolders" class="md-nav__link">
    <span class="md-ellipsis">
      simfolders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#romscom.romscom.stringifyvalues" class="md-nav__link">
    <span class="md-ellipsis">
      stringifyvalues
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>romscom</h1>

<div class="doc doc-object doc-module">



<a id="romscom.romscom"></a>
    <div class="doc doc-contents first">

        <p><strong>ROMS Communication Module primary functions</strong></p>
<p>This module holds the primary functions expected to be called by end-users in a
typical romscom workflow, which includes importing ROMS parameters from .yaml files,
manipulating values as needed for an experiment, and then exporting to ROMS .in
files:</p>
<ul>
<li><code>readparamfile(filename,...)</code> reads a parameter YAML file into an ordered
  dictionary</li>
<li><code>stringifyvalues(d,...)</code> reformats the values in a parameter dictionary to
  ROMS syntax strings</li>
<li><code>dict2standardin(d,...)</code> converts a parameter dictionary to standard input
  text, and optionally writes to file</li>
<li><code>converttimes(d,direction)</code> converts time-related parameter fields between ROMS
  format and datetimes/timedeltas.</li>
</ul>
<p>Additional functions focus on a specific ROMS workflow; this includes a standard
folder setup and file-naming conventions that facilitate robust automation of
simulations.</p>
<ul>
<li><code>runtodate(ocean,simdir,simname,enddate,...)</code> sets up I/O and runs ROMS
  simulation through indicated date, with options to restart and work past
  blowups</li>
<li><code>simfolders(simdir)</code> generates folder path names for, and optionally creates,
  the 3 I/O folders used by runtodate</li>
<li><code>setoutfilenames(ocean,base,...)</code> resets the values of output file name
  parameters in a ROMS parameter dictionary to use a systematic naming scheme</li>
</ul>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.converttimes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">converttimes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Converts time-related parameter fields between ROMS format and
datetimes/timedeltas.  The conversions apply to the following keys in
the input dictionary d:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>'ROMS' format</th>
<th>'time' format</th>
</tr>
</thead>
<tbody>
<tr>
<td>DSTART</td>
<td>float, days since initialization</td>
<td>datetime, starting date+time</td>
</tr>
<tr>
<td>TIME_REF</td>
<td>float, reference time (yyyymmdd.f)</td>
<td>datetime, reference date+time</td>
</tr>
<tr>
<td>NTIMES*</td>
<td>integer, number of time steps in simulation</td>
<td>timedelta, duration of simulation</td>
</tr>
<tr>
<td>N###</td>
<td>integer, number of time steps</td>
<td>timedelta, length of time</td>
</tr>
<tr>
<td>NDEF###</td>
<td>integer, number of time steps</td>
<td>timedelta, length of time</td>
</tr>
<tr>
<td>DT:</td>
<td>integer, number of seconds</td>
<td>timedelta, length of time</td>
</tr>
</tbody>
</table>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ROMS parameter dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>'ROMS' to convert to ROMS standard input units or 'time' to 
convert to datetime/timedelta values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">converttimes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts time-related parameter fields between ROMS format and</span>
<span class="sd">    datetimes/timedeltas.  The conversions apply to the following keys in</span>
<span class="sd">    the input dictionary d:</span>

<span class="sd">    |Key      | &#39;ROMS&#39; format                      |&#39;time&#39; format</span>
<span class="sd">    |---------|------------------------------------|------------------------------</span>
<span class="sd">    |DSTART   | float, days since initialization   |datetime, starting date+time</span>
<span class="sd">    |TIME_REF | float, reference time (yyyymmdd.f) |datetime, reference date+time</span>
<span class="sd">    |NTIMES*  | integer, number of time steps in simulation |timedelta, duration of simulation</span>
<span class="sd">    |N###     | integer, number of time steps      |timedelta, length of time</span>
<span class="sd">    |NDEF###  | integer, number of time steps      |timedelta, length of time</span>
<span class="sd">    |DT:      | integer, number of seconds         |timedelta, length of time</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): ROMS parameter dictionary</span>
<span class="sd">        direction (string): &#39;ROMS&#39; to convert to ROMS standard input units or &#39;time&#39; to </span>
<span class="sd">            convert to datetime/timedelta values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timeflds</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">timefieldlist</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">istime</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fieldsaretime</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">istime</span> <span class="ow">and</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
        <span class="c1"># Convert from ROMS standard input units to datetimes and timedeltas</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;360-day and 365.25-day calendars not compatible with this function&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1968</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
            <span class="n">mn</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">yr</span><span class="o">*</span><span class="mi">10000</span> <span class="o">-</span> <span class="n">mn</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">dyfrac</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">yr</span><span class="o">*</span><span class="mi">10000</span> <span class="o">-</span> <span class="n">mn</span><span class="o">*</span><span class="mi">100</span> <span class="o">-</span> <span class="n">dy</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">dyfrac</span> <span class="o">*</span> <span class="mi">24</span>
            <span class="n">mnt</span> <span class="o">=</span> <span class="p">(</span><span class="n">dyfrac</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">mnt</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mnt</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># Note: assuming no fractional seconds</span>
            <span class="n">mnt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mnt</span><span class="p">)</span>

            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="n">mn</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">hr</span><span class="p">,</span><span class="n">mnt</span><span class="p">,</span><span class="n">sc</span><span class="p">)</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">])</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DSTART&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;DSTART&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">timeflds</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">istime</span> <span class="ow">and</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;ROMS&quot;</span><span class="p">:</span>
        <span class="c1"># Convert from datetimes and timedeltas to ROMS standard input units</span>
        <span class="n">dfrac</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">86400.0</span>
        <span class="n">datefloat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{year}{month:02d}{day:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DSTART&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;DSTART&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mf">86400.0</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datefloat</span> <span class="o">+</span> <span class="n">dfrac</span>

        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">timeflds</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.dict2standardin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dict2standardin</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Converts a parameter dictionary to standard input text, and optionally
writes to file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameter dictionary compress (logical, optional): True to
compress repreated values (e.g., T T T -&gt; 3*T), False (default) to
leave as is.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="string">string</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of output file.  If None (default), text is 
returned; otherwise, text will be printed to file indicated</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>standard input text (only if output file not provided)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dict2standardin</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a parameter dictionary to standard input text, and optionally</span>
<span class="sd">    writes to file</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): parameter dictionary compress (logical, optional): True to</span>
<span class="sd">            compress repreated values (e.g., T T T -&gt; 3*T), False (default) to</span>
<span class="sd">            leave as is.</span>
<span class="sd">        file (string or None): name of output file.  If None (default), text is </span>
<span class="sd">            returned; otherwise, text will be printed to file indicated</span>

<span class="sd">    Returns:</span>
<span class="sd">        (string): standard input text (only if output file not provided)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;DT&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">istime</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fieldsaretime</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">istime</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">istime</span><span class="p">:</span>
        <span class="n">converttimes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;ROMS&quot;</span><span class="p">)</span>
    <span class="n">dstr</span> <span class="o">=</span> <span class="n">stringifyvalues</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>
    <span class="n">no_plural</span> <span class="o">=</span> <span class="n">dstr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;no_plural&#39;</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="n">dstr</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">]:</span>
                <span class="n">txt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">formatkeyvalue</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">no_plural</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">]:</span>
                <span class="n">newkey</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">txt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">formatkeyvalue</span><span class="p">(</span><span class="n">newkey</span><span class="p">,</span> <span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">no_plural</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">formatkeyvalue</span><span class="p">(</span><span class="n">ky</span><span class="p">,</span> <span class="n">dstr</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span> <span class="n">no_plural</span><span class="p">))</span>

    <span class="n">delim</span> <span class="o">=</span>  <span class="s1">&#39;&#39;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">istime</span><span class="p">:</span>
        <span class="n">converttimes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">txt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.readparamfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readparamfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tconvert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads parameter YAML file into an ordered dictionary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of parameter file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tconvert</code>
            </td>
            <td>
                  <code><span title="logical">logical</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to convert time-related fields to 
datetimes and timedeltas, False (default) to keep in native ROMS 
format.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="OrderedDict">OrderedDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ROMS parameter dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readparamfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tconvert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads parameter YAML file into an ordered dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (string): name of parameter file</span>
<span class="sd">        tconvert (logical, optional): True to convert time-related fields to </span>
<span class="sd">            datetimes and timedeltas, False (default) to keep in native ROMS </span>
<span class="sd">            format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (OrderedDict): ROMS parameter dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">ordered_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tconvert</span><span class="p">:</span>
        <span class="n">converttimes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.runtodate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">runtodate</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">simdir</span><span class="p">,</span> <span class="n">simname</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">dtslow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addcounter</span><span class="o">=</span><span class="s1">&#39;most&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">romscmd</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mpirun&#39;</span><span class="p">,</span> <span class="s1">&#39;romsM&#39;</span><span class="p">],</span> <span class="n">dryrunflag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">permissions</span><span class="o">=</span><span class="mi">493</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">runpastblowup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sets up I/O and runs ROMS simulation through indicated date</p>
<p>This function provides a wrapper to set up a ROMS simulation and run through
the desired date, allowing for robust restarts when necessary. It organizes
ROMS I/O under a 3-folder system (under the user-specified simdir folder): </p>
<ul>
<li><simdir>/In: holds all stardard input (.in) files for the simulation</li>
<li><simdir>/Log: holds standard output and standard error files (redirected
    to file from the call to ROMS) as well as step-size tracking to support
    this function's runpastblowup option</li>
<li><simdir>/Out: holds all netCDF output files from the ROMS simulation</li>
</ul>
<p>Before calling the ROMS executable, this function looks for an
appropriately-named restart file under the <simdir>/Out subfolder. If found,
it uses this restart file to initialize a run with NRREC=-1; otherwise, it
will use the user-provided ININAME and NRREC values. It also adjusts the
NTIMES field to reach the requested end date.</p>
<p>This procedure allows a simulation to be restarted using the same call to
runtodate regardless of whether it has been partially completed or not; this
can be useful when running simulations on computer clusters where jobs may
be cancelled and resubmitted for various queue management reasons, or to
extend existing simulations with new forcing.</p>
<p>This function also provides the option to work through ROMS blowups. These
occur when physical conditions lead to numeric instabilities. Blowups can
sometimes be mitigated by reducing the model time step. When the
runpastblowup option is True and runtodate encounters a blowup, it will
adjust the DT parameter to the user-provided slow time step, restart the
simulation from the last history file, and run for 30 days.  It will then
return to the original time step and resume. Note that this time step
reduction will only be attempted once; if the model still blows up, the
simulation will exit and the user will need to troubleshoot the situation.</p>
<p>Each time the model is restarted, output file counters are incremented as
specified by the addcounter option.  This preserves output that would
otherwise be overwritten on restart with the same simulation name.  By
default, the counter is only added to file types that modern ROMS does not
check for on restart.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocean</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ROMS parameter dictionary for standard input simdir</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>(string)</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>folder where I/O subfolders are found/created simname</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>(string)</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>base name for simulation, used as prefix for 
auto-generated input, standard output and error files, and .nc
output.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enddate</code>
            </td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>datetime, simulation end date dtslow (timedelta,</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optional)</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>length of time step used during 
slow-stepping (blowup) periods. If None (default), this will be set
to half the primary (i.e., ocean['DT']) time step</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addcounter</code>
            </td>
            <td>
                  <code>string or list of strings</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of output 
filename prefixes corresponding to those where a counter index
should be added to the name, or one of the following special strings</p>
<ul>
<li>'all': add counter to all output types</li>
<li>'most': add counter only to output types that do not have
        the option of being broken into smaller files on output
        (i.e. those that do not have an NDEFXXX option)</li>
<li>'none': do not add counter to any (default)</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;most&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compress</code>
            </td>
            <td>
                  <code><span title="logical">logical</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to compress repreated values (e.g., 
T T T -&gt; 3*T), False (default) to leave as is.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>romscmd</code>
            </td>
            <td>
                  <code>list of strings</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>components of command used to call 
the ROMS executable (see subprocess.run).  Default is
["mpirun","romsM"], which would be  appropriate to call a
compiled-for-parallel ROMS executable via MPI.</p>
              </div>
            </td>
            <td>
                  <code>[&#39;mpirun&#39;, &#39;romsM&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dryrunflag</code>
            </td>
            <td>
                  <code><span title="logical">logical</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to perform a dry run, where I/O is 
prepped but the ROMS executable is not called, False to call ROMS.
Defaults to True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>permissions</code>
            </td>
            <td>
                  <code><span title="octal">octal</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>folder permissions applied to I/O 
subfolders if they don't already exist (see os.chmod). Default is
0o755</p>
              </div>
            </td>
            <td>
                  <code>493</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting index for file counter. runpastblowup</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>(logical,optional)</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to attempt time step reduction if the
model blows up, false otherwise</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>indicator of ROMS simulation results, will be one of:</p>
<ul>
<li>'dryrun': dryrunflag was True, no simulation was attempted</li>
<li>'blowup': simulation blew up (either with runpastblowup off, or 
   reduction of time step did not mitigate blowup)</li>
<li>'error': simulation encountered an error other than a blowup</li>
<li>'success': simulation completed successfully</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">runtodate</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">simdir</span><span class="p">,</span> <span class="n">simname</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">dtslow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addcounter</span><span class="o">=</span><span class="s2">&quot;most&quot;</span><span class="p">,</span>
               <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">romscmd</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mpirun&quot;</span><span class="p">,</span><span class="s2">&quot;romsM&quot;</span><span class="p">],</span> <span class="n">dryrunflag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">permissions</span><span class="o">=</span><span class="mo">0o755</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">runpastblowup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up I/O and runs ROMS simulation through indicated date</span>

<span class="sd">    This function provides a wrapper to set up a ROMS simulation and run through</span>
<span class="sd">    the desired date, allowing for robust restarts when necessary. It organizes</span>
<span class="sd">    ROMS I/O under a 3-folder system (under the user-specified simdir folder): </span>

<span class="sd">    - &lt;simdir&gt;/In: holds all stardard input (.in) files for the simulation</span>
<span class="sd">    - &lt;simdir&gt;/Log: holds standard output and standard error files (redirected</span>
<span class="sd">        to file from the call to ROMS) as well as step-size tracking to support</span>
<span class="sd">        this function&#39;s runpastblowup option</span>
<span class="sd">    - &lt;simdir&gt;/Out: holds all netCDF output files from the ROMS simulation</span>

<span class="sd">    Before calling the ROMS executable, this function looks for an</span>
<span class="sd">    appropriately-named restart file under the &lt;simdir&gt;/Out subfolder. If found,</span>
<span class="sd">    it uses this restart file to initialize a run with NRREC=-1; otherwise, it</span>
<span class="sd">    will use the user-provided ININAME and NRREC values. It also adjusts the</span>
<span class="sd">    NTIMES field to reach the requested end date.</span>

<span class="sd">    This procedure allows a simulation to be restarted using the same call to</span>
<span class="sd">    runtodate regardless of whether it has been partially completed or not; this</span>
<span class="sd">    can be useful when running simulations on computer clusters where jobs may</span>
<span class="sd">    be cancelled and resubmitted for various queue management reasons, or to</span>
<span class="sd">    extend existing simulations with new forcing.</span>

<span class="sd">    This function also provides the option to work through ROMS blowups. These</span>
<span class="sd">    occur when physical conditions lead to numeric instabilities. Blowups can</span>
<span class="sd">    sometimes be mitigated by reducing the model time step. When the</span>
<span class="sd">    runpastblowup option is True and runtodate encounters a blowup, it will</span>
<span class="sd">    adjust the DT parameter to the user-provided slow time step, restart the</span>
<span class="sd">    simulation from the last history file, and run for 30 days.  It will then</span>
<span class="sd">    return to the original time step and resume. Note that this time step</span>
<span class="sd">    reduction will only be attempted once; if the model still blows up, the</span>
<span class="sd">    simulation will exit and the user will need to troubleshoot the situation.</span>

<span class="sd">    Each time the model is restarted, output file counters are incremented as</span>
<span class="sd">    specified by the addcounter option.  This preserves output that would</span>
<span class="sd">    otherwise be overwritten on restart with the same simulation name.  By</span>
<span class="sd">    default, the counter is only added to file types that modern ROMS does not</span>
<span class="sd">    check for on restart.</span>

<span class="sd">    Args:</span>
<span class="sd">        ocean (dict): ROMS parameter dictionary for standard input simdir</span>
<span class="sd">        (string): folder where I/O subfolders are found/created simname</span>
<span class="sd">        (string): base name for simulation, used as prefix for </span>
<span class="sd">            auto-generated input, standard output and error files, and .nc</span>
<span class="sd">            output.</span>
<span class="sd">        enddate (datetime):    datetime, simulation end date dtslow (timedelta,</span>
<span class="sd">        optional): length of time step used during </span>
<span class="sd">            slow-stepping (blowup) periods. If None (default), this will be set</span>
<span class="sd">            to half the primary (i.e., ocean[&#39;DT&#39;]) time step</span>
<span class="sd">        addcounter (string or list of strings, optional): list of output </span>
<span class="sd">            filename prefixes corresponding to those where a counter index</span>
<span class="sd">            should be added to the name, or one of the following special strings</span>

<span class="sd">            - &#39;all&#39;: add counter to all output types</span>
<span class="sd">            - &#39;most&#39;: add counter only to output types that do not have</span>
<span class="sd">                    the option of being broken into smaller files on output</span>
<span class="sd">                    (i.e. those that do not have an NDEFXXX option)</span>
<span class="sd">            - &#39;none&#39;: do not add counter to any (default)</span>
<span class="sd">        compress (logical, optional): True to compress repreated values (e.g., </span>
<span class="sd">            T T T -&gt; 3*T), False (default) to leave as is.</span>
<span class="sd">        romscmd (list of strings, optional): components of command used to call </span>
<span class="sd">            the ROMS executable (see subprocess.run).  Default is</span>
<span class="sd">            [&quot;mpirun&quot;,&quot;romsM&quot;], which would be  appropriate to call a</span>
<span class="sd">            compiled-for-parallel ROMS executable via MPI.</span>
<span class="sd">        dryrunflag (logical, optional): True to perform a dry run, where I/O is </span>
<span class="sd">            prepped but the ROMS executable is not called, False to call ROMS.</span>
<span class="sd">            Defaults to True</span>
<span class="sd">        permissions (octal, optional): folder permissions applied to I/O </span>
<span class="sd">            subfolders if they don&#39;t already exist (see os.chmod). Default is</span>
<span class="sd">            0o755</span>
<span class="sd">        count (int, optional): Starting index for file counter. runpastblowup</span>
<span class="sd">        (logical,optional): True to attempt time step reduction if the</span>
<span class="sd">            model blows up, false otherwise</span>

<span class="sd">    Returns:     </span>
<span class="sd">        (string): indicator of ROMS simulation results, will be one of:</span>

<span class="sd">            - &#39;dryrun&#39;: dryrunflag was True, no simulation was attempted</span>
<span class="sd">            - &#39;blowup&#39;: simulation blew up (either with runpastblowup off, or </span>
<span class="sd">               reduction of time step did not mitigate blowup)</span>
<span class="sd">            - &#39;error&#39;: simulation encountered an error other than a blowup</span>
<span class="sd">            - &#39;success&#39;: simulation completed successfully</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get some stuff from dictionary, before we make changes</span>

    <span class="n">converttimes</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span> <span class="c1"># make sure we&#39;re in datetime/timedelta mode</span>
    <span class="n">inifile</span> <span class="o">=</span> <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">]</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span>
    <span class="n">drst</span> <span class="o">=</span> <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRST&#39;</span><span class="p">]</span>
    <span class="n">nrrec</span> <span class="o">=</span> <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRREC&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dtslow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtslow</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1"># Set up input, output, and log folders</span>

    <span class="n">fol</span> <span class="o">=</span> <span class="n">simfolders</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">permissions</span><span class="o">=</span><span class="n">permissions</span><span class="p">)</span>

    <span class="c1"># Initialization file: check for any existing restart files, and if not</span>
    <span class="c1"># found, start from the initialization file</span>

    <span class="n">rstinfo</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">parserst</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">simname</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">rstinfo</span><span class="p">[</span><span class="s1">&#39;lastfile&#39;</span><span class="p">]:</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">rstinfo</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rstinfo</span><span class="p">[</span><span class="s1">&#39;lastfile&#39;</span><span class="p">]</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRREC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">count</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inifile</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRREC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nrrec</span>

    <span class="c1"># Check that all input files exist (better to do this here than let ROMS try and fail)</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">inputfilesexist</span><span class="p">(</span><span class="n">ocean</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
        <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Input file missing, exiting&quot;</span><span class="p">)</span>

    <span class="c1"># Get starting time from initialization file</span>
    <span class="c1"># TODO: Eventually would like to support other ROMS-supported calendar </span>
    <span class="c1"># options (e.g., 360_day) but it would require tracking the TIME_REF flags </span>
    <span class="c1"># after converting to datetime</span>
    <span class="c1"># TODO: Would also like to add some checks to ensure files that include </span>
    <span class="c1"># calendar info and/or reference dates in their time attributes are properly</span>
    <span class="c1"># synced with the TIME_REF parameter</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">tunit</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

    <span class="k">if</span> <span class="s2">&quot;day&quot;</span> <span class="ow">in</span> <span class="n">tunit</span><span class="p">:</span>
        <span class="n">tunit</span> <span class="o">=</span> <span class="s2">&quot;days&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;second&quot;</span> <span class="ow">in</span> <span class="n">tunit</span><span class="p">:</span>
        <span class="n">tunit</span> <span class="o">=</span> <span class="s2">&quot;seconds&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Your initialization time unit will be interpreted by ROMS as seconds&quot;</span><span class="p">)</span>
        <span class="n">tunit</span> <span class="o">=</span> <span class="s2">&quot;seconds&quot;</span>
    <span class="n">tunit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tunit</span><span class="si">}</span><span class="s2"> since </span><span class="si">{</span><span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;TIME_REF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>        
    <span class="n">tini</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">][:],</span> <span class="n">units</span><span class="o">=</span><span class="n">tunit</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">))</span>

    <span class="c1"># Create log file to document slow-stepping time periods</span>

    <span class="n">steplog</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">simname</span><span class="si">}</span><span class="s2">_step.txt&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">steplog</span><span class="p">):</span>
        <span class="n">fstep</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">steplog</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span>
        <span class="n">fstep</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Run sim</span>

    <span class="k">while</span> <span class="n">tini</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">enddate</span> <span class="o">-</span> <span class="n">drst</span><span class="p">):</span>

        <span class="c1"># Set end date as furthest point we can run.  This will be either</span>
        <span class="c1"># the simulation end date  or the end of the slow-stepping period (if we</span>
        <span class="c1"># are in one), whichever comes first</span>

        <span class="c1"># Check if in slow-stepping period</span>

        <span class="n">endslow</span> <span class="o">=</span> <span class="n">enddate</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">steplog</span><span class="p">)</span> <span class="k">as</span> <span class="n">fstep</span><span class="p">:</span>
            <span class="n">readCSV</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fstep</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">readCSV</span><span class="p">:</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M:%S&#39;</span><span class="p">)</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M:%S&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tini</span> <span class="o">&gt;=</span> <span class="n">t1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tini</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">drst</span><span class="p">)):</span> <span class="c1"># in a slow-step period</span>
                    <span class="n">endslow</span> <span class="o">=</span> <span class="n">t2</span>
                    <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtslow</span>

        <span class="n">tend</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">endslow</span><span class="p">)</span>
        <span class="c1"># ocean[&#39;NTIMES&#39;] = tend - ocean[&#39;DSTART&#39;]</span>
        <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NTIMES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tend</span> <span class="o">-</span> <span class="n">tini</span>

        <span class="c1"># Set names for output files</span>

        <span class="n">setoutfilenames</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">simname</span><span class="p">),</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">addcounter</span><span class="o">=</span><span class="n">addcounter</span><span class="p">)</span>

        <span class="c1"># Names for standard input, output, and error</span>

        <span class="n">standinfile</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">],</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">simname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cnt</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_ocean.in&quot;</span><span class="p">)</span>
        <span class="n">standoutfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">simname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cnt</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_log.txt&quot;</span><span class="p">)</span>
        <span class="n">standerrfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">simname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cnt</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_err.txt&quot;</span><span class="p">)</span>

        <span class="c1"># Export parameters to standard input file</span>

        <span class="n">converttimes</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="s2">&quot;ROMS&quot;</span><span class="p">)</span>
        <span class="n">dict2standardin</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">standinfile</span><span class="p">)</span>
        <span class="n">converttimes</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>

        <span class="c1"># Print summary</span>

        <span class="n">cmdstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">romscmd</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running ROMS simulation&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Counter block:   </span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Start date:      </span><span class="si">{</span><span class="n">tini</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  End date:        </span><span class="si">{</span><span class="n">tend</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ROMS command:    </span><span class="si">{</span><span class="n">cmdstr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Standard input:  </span><span class="si">{</span><span class="n">standinfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Standard output: </span><span class="si">{</span><span class="n">standoutfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Standard error:  </span><span class="si">{</span><span class="n">standerrfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dryrunflag</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dry run&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;dryrun&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">standoutfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">standerrfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ferr</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">romscmd</span><span class="o">+</span><span class="p">[</span><span class="n">standinfile</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">ferr</span><span class="p">)</span>

        <span class="n">rsim</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">parseromslog</span><span class="p">(</span><span class="n">standoutfile</span><span class="p">)</span>

        <span class="c1"># Did the run crash (i.e. anything but successful end or blowup)? If</span>
        <span class="c1"># so, we&#39;ll exit now</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rsim</span><span class="p">[</span><span class="s1">&#39;cleanrun&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rsim</span><span class="p">[</span><span class="s1">&#39;blowup&#39;</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Simulation block terminated with error&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;error&#39;</span>

        <span class="c1"># Did it blow up?  If it did so during a slow-step period, we&#39;ll exit</span>
        <span class="c1"># now.  If it blew up during a fast-step period, set up a new</span>
        <span class="c1"># slow-step period and reset input to start with last history file.</span>
        <span class="c1"># If it ran to completion, reset input to start with last restart</span>
        <span class="c1"># file</span>

        <span class="n">rstinfo</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">parserst</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">simname</span><span class="p">))</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">rstinfo</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rsim</span><span class="p">[</span><span class="s1">&#39;blowup&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">runpastblowup</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Simulation block blew up&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;blowup&#39;</span>

            <span class="k">if</span> <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dtslow</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Simulation block blew up in a slow-step period&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;blowup&#39;</span>

            <span class="c1"># Find the most recent history file written to</span>
            <span class="n">hisfile</span> <span class="o">=</span> <span class="n">rsim</span><span class="p">[</span><span class="s1">&#39;lasthis&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hisfile</span><span class="p">:</span> <span class="c1"># non-clean blowup, no his file defined</span>
                <span class="n">allhis</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">simname</span> <span class="o">+</span> <span class="s2">&quot;*his*.nc&quot;</span><span class="p">)))</span>
                <span class="n">hisfile</span> <span class="o">=</span> <span class="n">allhis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">fhis</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">hisfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fhis</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">allhis</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">simname</span> <span class="o">+</span> <span class="s2">&quot;*his*.nc&quot;</span><span class="p">))</span>
                <span class="n">allhis</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">allhis</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">hisfile</span><span class="p">])))</span>
                <span class="n">hisfile</span> <span class="o">=</span> <span class="n">allhis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hisfile</span>
            <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRREC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">tunit</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
            <span class="n">tcal</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">calendar</span>
            <span class="n">tini</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">][:],</span> <span class="n">units</span><span class="o">=</span><span class="n">tunit</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">tcal</span><span class="p">))</span>

            <span class="n">t1</span> <span class="o">=</span> <span class="n">tini</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M:%S&#39;</span><span class="p">)</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">tini</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M:%S&#39;</span><span class="p">)</span>
            <span class="n">fstep</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">steplog</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
            <span class="n">fstep</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">))</span>
            <span class="n">fstep</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rstinfo</span><span class="p">[</span><span class="s1">&#39;lastfile&#39;</span><span class="p">]</span>
            <span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;NRREC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ocean</span><span class="p">[</span><span class="s1">&#39;ININAME&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">tunit</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
            <span class="n">tcal</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">calendar</span>
            <span class="n">tini</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">][:],</span> <span class="n">units</span><span class="o">=</span><span class="n">tunit</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">tcal</span><span class="p">))</span>

    <span class="c1"># Print completion status message</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation completed through specified end date&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.setoutfilenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setoutfilenames</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">addcounter</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Resets the values of output file name parameters in a ROMS parameter dictionary</p>
<p>This function systematically resets the output file name values using the
pattern <code>{base}_{prefix}.nc</code>, where prefix is a lowercase version of the 3- or
4-letter prefix of the various XXXNAME parameters, e.g. <code>ocean['AVGNAME'] = 'base_avg.nc'</code>.
Where specified, a 2-digit counter may also be added, e.g. <code>ocean['STANAME'] = 'base_01_sta.nc'</code>.
Note that these extra counters apply an additional increment beyond those that ROMS
itself applies to any file type with an NDEFXXX option; for example, history files are
typically incremented internally, so <code>ocean['HISNAME'] = 'base_his.nc'</code> with <code>ocean['NDEFHIS'] &gt; 0</code> 
and <code>addcounter="none"</code> will still produce files named <code>&lt;simdir&gt;/Out/base_his_00001.nc</code>, 
<code>&lt;simdir&gt;/Out/base_his_00002.nc</code>, etc.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocean</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameter dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>base name for output files (including path when 
applicable)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cnt</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>counter to be added to filenames, if requested.  Default = 1</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outtype</code>
            </td>
            <td>
                  <code>string or list of strings</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of output filename 
prefixes corresponding to those to be modified (e.g., 
['AVG', 'HIS']), or one of the following special strings:
all:    modify all output types (default)</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addcounter</code>
            </td>
            <td>
                  <code>string or list of strings</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of output 
filename prefixes corresponding to those where a counter index 
should be added to the name, or one of the following special strings:</p>
<ul>
<li>all: add counter to all output types, equal to 
       ['DAI', 'GST', 'RST', 'HIS', 'QCK', 'TLF', 'TLM', 'ADJ', 'AVG',
        'HAR', 'DIA', 'STA', 'FLT', 'AVG2']</li>
<li>most: add counter only to output types that do not have
        the option of being broken into smaller files on
        output (i.e. those that do not have an NDEFXXX
        option).  Includes all those listed in 'all' <em>except</em>
        ['AVG', 'AVG2', 'HIS', 'DIA', 'TLM', 'ADJ']</li>
<li>none: do not add counter to any (default)</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;none&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setoutfilenames</span><span class="p">(</span><span class="n">ocean</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">addcounter</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resets the values of output file name parameters in a ROMS parameter dictionary</span>

<span class="sd">    This function systematically resets the output file name values using the</span>
<span class="sd">    pattern `{base}_{prefix}.nc`, where prefix is a lowercase version of the 3- or</span>
<span class="sd">    4-letter prefix of the various XXXNAME parameters, e.g. `ocean[&#39;AVGNAME&#39;] = &#39;base_avg.nc&#39;`.</span>
<span class="sd">    Where specified, a 2-digit counter may also be added, e.g. `ocean[&#39;STANAME&#39;] = &#39;base_01_sta.nc&#39;`.</span>
<span class="sd">    Note that these extra counters apply an additional increment beyond those that ROMS</span>
<span class="sd">    itself applies to any file type with an NDEFXXX option; for example, history files are</span>
<span class="sd">    typically incremented internally, so `ocean[&#39;HISNAME&#39;] = &#39;base_his.nc&#39;` with `ocean[&#39;NDEFHIS&#39;] &gt; 0` </span>
<span class="sd">    and `addcounter=&quot;none&quot;` will still produce files named `&lt;simdir&gt;/Out/base_his_00001.nc`, </span>
<span class="sd">    `&lt;simdir&gt;/Out/base_his_00002.nc`, etc.  </span>

<span class="sd">    Args:</span>
<span class="sd">        ocean (dict): parameter dictionary</span>
<span class="sd">        base (string): base name for output files (including path when </span>
<span class="sd">            applicable)</span>
<span class="sd">        cnt (int): counter to be added to filenames, if requested.  Default = 1</span>
<span class="sd">        outtype (string or list of strings, optional): list of output filename </span>
<span class="sd">            prefixes corresponding to those to be modified (e.g., </span>
<span class="sd">            [&#39;AVG&#39;, &#39;HIS&#39;]), or one of the following special strings:</span>
<span class="sd">            all:    modify all output types (default)</span>
<span class="sd">        addcounter (string or list of strings, optional): list of output </span>
<span class="sd">            filename prefixes corresponding to those where a counter index </span>
<span class="sd">            should be added to the name, or one of the following special strings:</span>

<span class="sd">            - all: add counter to all output types, equal to </span>
<span class="sd">                   [&#39;DAI&#39;, &#39;GST&#39;, &#39;RST&#39;, &#39;HIS&#39;, &#39;QCK&#39;, &#39;TLF&#39;, &#39;TLM&#39;, &#39;ADJ&#39;, &#39;AVG&#39;,</span>
<span class="sd">                    &#39;HAR&#39;, &#39;DIA&#39;, &#39;STA&#39;, &#39;FLT&#39;, &#39;AVG2&#39;]</span>
<span class="sd">            - most: add counter only to output types that do not have</span>
<span class="sd">                    the option of being broken into smaller files on</span>
<span class="sd">                    output (i.e. those that do not have an NDEFXXX</span>
<span class="sd">                    option).  Includes all those listed in &#39;all&#39; *except*</span>
<span class="sd">                    [&#39;AVG&#39;, &#39;AVG2&#39;, &#39;HIS&#39;, &#39;DIA&#39;, &#39;TLM&#39;, &#39;ADJ&#39;]</span>
<span class="sd">            - none: do not add counter to any (default)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">outopt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DAI&#39;</span><span class="p">,</span> <span class="s1">&#39;GST&#39;</span><span class="p">,</span> <span class="s1">&#39;RST&#39;</span><span class="p">,</span> <span class="s1">&#39;HIS&#39;</span><span class="p">,</span> <span class="s1">&#39;QCK&#39;</span><span class="p">,</span> <span class="s1">&#39;TLF&#39;</span><span class="p">,</span> <span class="s1">&#39;TLM&#39;</span><span class="p">,</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">,</span> <span class="s1">&#39;AVG&#39;</span><span class="p">,</span>
                <span class="s1">&#39;HAR&#39;</span><span class="p">,</span> <span class="s1">&#39;DIA&#39;</span><span class="p">,</span> <span class="s1">&#39;STA&#39;</span><span class="p">,</span> <span class="s1">&#39;FLT&#39;</span><span class="p">,</span> <span class="s1">&#39;AVG2&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outtype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outtype</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">outtype</span> <span class="o">=</span> <span class="n">outopt</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">addcounter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">addcounter</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="n">addcounter</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">addcounter</span> <span class="o">==</span> <span class="s2">&quot;most&quot;</span><span class="p">:</span>
            <span class="n">default_nocount</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AVG&#39;</span><span class="p">,</span> <span class="s1">&#39;AVG2&#39;</span><span class="p">,</span> <span class="s1">&#39;HIS&#39;</span><span class="p">,</span> <span class="s1">&#39;DIA&#39;</span><span class="p">,</span> <span class="s1">&#39;TLM&#39;</span><span class="p">,</span> <span class="s1">&#39;ADJ&#39;</span><span class="p">]</span>
            <span class="n">addcounter</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outtype</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">default_nocount</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">addcounter</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">addcounter</span> <span class="o">=</span> <span class="n">outtype</span>

    <span class="k">for</span> <span class="n">fl</span> <span class="ow">in</span> <span class="n">outtype</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fl</span> <span class="ow">in</span> <span class="n">addcounter</span><span class="p">:</span>
            <span class="n">ocean</span><span class="p">[</span><span class="n">fl</span><span class="o">+</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cnt</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.nc&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ocean</span><span class="p">[</span><span class="n">fl</span><span class="o">+</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.nc&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.simfolders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simfolders</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">permissions</span><span class="o">=</span><span class="mi">493</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate path names for, and if requested, create folders for the the 3 I/O
folders used by runtodate (<simdir>/In, <simdir>/Log, and <simdir>/Out).  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simdir</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to location where folders will be located. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create</code>
            </td>
            <td>
                  <code><span title="logical">logical</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to create the folders if they do not 
exist.  Defaults to False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>permissions</code>
            </td>
            <td>
                  <code><span title="octal">octal</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>folder permissions applied to I/O 
subfolders if they don't already exist (see os.chmod). Default is
0o755</p>
              </div>
            </td>
            <td>
                  <code>493</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the following fields:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value type</th>
<th>Value description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>out</code></td>
<td><code>string</code></td>
<td>path to folder where ROMS netCDF output will be placed</td>
</tr>
<tr>
<td><code>in</code></td>
<td><code>string</code></td>
<td>path to folder for romscom-generated ROMS text input files</td>
</tr>
<tr>
<td><code>log</code></td>
<td><code>string</code></td>
<td>path to folder for standard error and standard output files</td>
</tr>
</tbody>
</table>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simfolders</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">permissions</span><span class="o">=</span><span class="mo">0o755</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate path names for, and if requested, create folders for the the 3 I/O</span>
<span class="sd">    folders used by runtodate (&lt;simdir&gt;/In, &lt;simdir&gt;/Log, and &lt;simdir&gt;/Out).  </span>

<span class="sd">    Args:</span>
<span class="sd">        simdir (string): path to location where folders will be located. </span>
<span class="sd">        create (logical, optional): True to create the folders if they do not </span>
<span class="sd">            exist.  Defaults to False</span>
<span class="sd">        permissions (octal, optional): folder permissions applied to I/O </span>
<span class="sd">            subfolders if they don&#39;t already exist (see os.chmod). Default is</span>
<span class="sd">            0o755</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): with the following fields:</span>

<span class="sd">            Key        |Value type|Value description</span>
<span class="sd">            -----------|----------|-----------------</span>
<span class="sd">            `out`      |`string`  | path to folder where ROMS netCDF output will be placed</span>
<span class="sd">            `in`       |`string`  | path to folder for romscom-generated ROMS text input files</span>
<span class="sd">            `log`      |`string`  | path to folder for standard error and standard output files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="s2">&quot;Out&quot;</span><span class="p">)</span>
    <span class="n">indir</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="s2">&quot;In&quot;</span><span class="p">)</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">simdir</span><span class="p">,</span> <span class="s2">&quot;Log&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">indir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">indir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">indir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">logdir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">logdir</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;out&quot;</span><span class="p">:</span> <span class="n">outdir</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="n">indir</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">logdir</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="romscom.romscom.stringifyvalues" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stringifyvalues</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Formats all dictionary values to ROMS standard input syntax</p>
<p>This function converts values to the Fortran-ish syntax used in ROMS
standard input files.  Floats are converted to the double-precision format
of Fortran read/write statements, booleans are converted to T/F, integers
are converted straight to strings, and lists are converted to space-
delimited strings of the above (compressed using * for repeated values where
applicable).  Values corresponding to a few special KEYWORDS (e.g., the
'POS' station table, multi-file parameters, 'LBC' boundary conditions)
receive the appropriate formatting</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ROMS parameter dictionary compress (logical, optional): True
to compress repeated values (e.g., T T T -&gt; 3*T), False (default) to
leave as is.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>deep copy of d with all values replaced by ROMS-formatted
strings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/romscom/romscom.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stringifyvalues</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats all dictionary values to ROMS standard input syntax</span>

<span class="sd">    This function converts values to the Fortran-ish syntax used in ROMS</span>
<span class="sd">    standard input files.  Floats are converted to the double-precision format</span>
<span class="sd">    of Fortran read/write statements, booleans are converted to T/F, integers</span>
<span class="sd">    are converted straight to strings, and lists are converted to space-</span>
<span class="sd">    delimited strings of the above (compressed using * for repeated values where</span>
<span class="sd">    applicable).  Values corresponding to a few special KEYWORDS (e.g., the</span>
<span class="sd">    &#39;POS&#39; station table, multi-file parameters, &#39;LBC&#39; boundary conditions)</span>
<span class="sd">    receive the appropriate formatting</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): ROMS parameter dictionary compress (logical, optional): True</span>
<span class="sd">            to compress repeated values (e.g., T T T -&gt; 3*T), False (default) to</span>
<span class="sd">            leave as is.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): deep copy of d with all values replaced by ROMS-formatted</span>
<span class="sd">            strings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
        <span class="n">consecstep</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">consecstep</span><span class="o">=-</span><span class="mi">99999</span>

    <span class="n">newdict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newdict</span><span class="p">:</span>

        <span class="c1"># Start by checking for special cases</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;no_plural&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;POS&#39;</span><span class="p">:</span>
            <span class="c1"># Stations table</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># lat/lon pairs</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:17s}{:4d}</span><span class="s1"> </span><span class="si">{:4d}</span><span class="s1"> </span><span class="si">{:12f}</span><span class="s1"> </span><span class="si">{:12f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># I/J pairs</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:17s}{:4d}</span><span class="s1"> </span><span class="si">{:4d}</span><span class="s1"> </span><span class="si">{:12d}</span><span class="s1"> </span><span class="si">{:12d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

            <span class="n">tablestr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:14s}{:4s}</span><span class="s1"> </span><span class="si">{:4s}</span><span class="s1"> </span><span class="si">{:12s}</span><span class="s1"> </span><span class="si">{:12s}</span><span class="s1"> </span><span class="si">{:12s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;GRID&#39;</span><span class="p">,</span><span class="s1">&#39;FLAG&#39;</span><span class="p">,</span> <span class="s1">&#39;X-POS&#39;</span><span class="p">,</span> <span class="s1">&#39;Y-POS&#39;</span><span class="p">,</span> <span class="s1">&#39;COMMENT&#39;</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tablestr</span><span class="p">)</span>

            <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BRYNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;CLMNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;FRCNAME&#39;</span><span class="p">]:</span>
            <span class="c1"># Multi-file entries (Single file strings are not modified)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">multifile2str</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;LBC&#39;</span><span class="p">):</span>
            <span class="c1"># LBC values are grouped 4 per line</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">nline</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="o">//</span><span class="mi">4</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nline</span><span class="p">):</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">ii</span><span class="o">*</span><span class="mi">4</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">ii</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">s</span><span class="p">:</span><span class="n">e</span><span class="p">]))</span>
                    <span class="n">delim</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="se">\\\n</span><span class="s2">&quot;</span>
                    <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fsh_age_offset&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_q_G&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_q_Gz&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_alpha_G&#39;</span><span class="p">,</span> 
                   <span class="s1">&#39;fsh_alpha_Gz&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_beta_G&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_beta_Gz&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_catch_sel&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;fsh_catch_01&#39;</span><span class="p">,</span> <span class="s1">&#39;fsh_catch_99&#39;</span><span class="p">]:</span>
            <span class="c1"># FEAST parses arrays via repeated keywords</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
                <span class="n">tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">list2str</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">consecstep</span><span class="o">=-</span><span class="mi">99999</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">float2str</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">bool2str</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">list2str</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">consecstep</span><span class="o">=</span><span class="n">consecstep</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">list2str</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">consecstep</span><span class="o">=</span><span class="n">consecstep</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">stringifyvalues</span><span class="p">(</span><span class="n">newdict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newdict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.footnote.tooltips", "navigation.sections"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>