"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[833],{2511:(e,t,n)=>{var a,r;n.d(t,{A:()=>a,v:()=>r}),function(e){e.Simple="SIMPLE",e.Sql="SQL"}(a||(a={})),function(e){e.Having="HAVING",e.Where="WHERE"}(r||(r={}))},8786:(e,t,n)=>{n.d(t,{_h:()=>I,ih:()=>w});var a,r=n(96540),i=n(96453),o=n(27366),s=n(78518),l=n(67073),d=n(48327),c=n(62221);!function(e){e.Results="results",e.Samples="samples"}(a||(a={}));var u=n(80145),h=n(62952),p=n(51436),m=n(17444),g=n(50455),v=n(2514),b=n(8877),f=n(80493),y=n(2445);const x=i.I4.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,C=new WeakMap,S=({isRequest:e,queryFormData:t,queryForce:n,ownState:a,errorMessage:i,actions:o,isVisible:l,dataSize:d=50,canDownload:c})=>{var S;const A=(0,u.A)().get((null==t?void 0:t.viz_type)||(null==t?void 0:t.vizType)),[w,T]=(0,r.useState)([]),[F,D]=(0,r.useState)(!0),[_,Y]=(0,r.useState)(""),$=null!=(S=null==A?void 0:A.queryObjectCount)?S:1,I=null==A?void 0:A.dynamicQueryObjectCount;if((0,r.useEffect)((()=>{i||(e&&C.has(t)&&(T((0,h.A)(C.get(t))),Y(""),n&&o&&o.setForceQuery(!1),D(!1)),e&&!C.has(t)&&(D(!0),(0,v.getChartDataRequest)({formData:t,force:n,resultFormat:"json",resultType:"results",ownState:a}).then((({json:e})=>{T((0,h.A)(e.result)),Y(""),C.set(t,e.result),n&&o&&o.setForceQuery(!1)})).catch((e=>{(0,p.h4)(e).then((({error:e,message:t})=>{Y(e||t||(0,s.t)("Sorry, an error occurred"))}))})).finally((()=>{D(!1)}))))}),[t,e]),(0,r.useEffect)((()=>{i&&D(!1)}),[i]),F)return Array($).fill((0,y.Y)(m.A,{}));if(i){const e=(0,s.t)("Run a query to display results");return Array($).fill((0,y.Y)(g.p,{image:"document.svg",title:e}))}if(_){const e=(0,y.FD)(y.FK,{children:[(0,y.Y)(f.x,{data:[],columnNames:[],columnTypes:[],rowcount:0,datasourceId:t.datasource,onInputChange:()=>{},isLoading:!1,canDownload:c}),(0,y.Y)(x,{children:_})]});return Array($).fill(e)}if(0===w.length){const e=(0,s.t)("No results were returned for this query");return Array($).fill((0,y.Y)(g.p,{image:"document.svg",title:e}))}return(I?w:w.slice(0,$)).map(((e,n)=>(0,y.Y)(b.U,{data:e.data,colnames:e.colnames,coltypes:e.coltypes,rowcount:e.rowcount,dataSize:d,datasourceId:t.datasource,isVisible:l,canDownload:c},n)))},A=i.I4.div`
  display: flex;
  flex-direction: column;
  height: 100%;

  .ant-tabs {
    height: 100%;
  }

  .ant-tabs-content {
    height: 100%;
  }

  .ant-tabs-tabpane {
    display: flex;
    flex-direction: column;
  }

  .table-condensed {
    overflow: auto;
  }
`,w=({isRequest:e,queryFormData:t,queryForce:n,ownState:r,errorMessage:i,actions:o,isVisible:l,dataSize:c=50,canDownload:u})=>{const h=S({errorMessage:i,queryFormData:t,queryForce:n,ownState:r,isRequest:e,actions:o,dataSize:c,isVisible:l,canDownload:u});if(1===h.length)return(0,y.Y)(A,{children:h[0]});const p=h.map(((e,t)=>0===t?(0,y.Y)(d.Ay.TabPane,{tab:(0,s.t)("Results"),children:e},a.Results):(0,y.Y)(d.Ay.TabPane,{tab:(0,s.t)("Results %s",t+1),children:e},`${a.Results} ${t+1}`)));return(0,y.Y)(A,{children:(0,y.Y)(d.Ay,{fullWidth:!1,children:p})})};var T=n(50217),F=n(39091);const D=i.I4.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,_=new WeakSet,Y=({isRequest:e,datasource:t,queryForce:n,actions:a,dataSize:i=50,isVisible:o,canDownload:l})=>{const[d,c]=(0,r.useState)(""),[u,p]=(0,r.useState)([]),[b,x]=(0,r.useState)([]),[C,S]=(0,r.useState)([]),[A,w]=(0,r.useState)(!1),[Y,$]=(0,r.useState)(0),[I,E]=(0,r.useState)(""),M=(0,r.useMemo)((()=>`${t.id}__${t.type}`),[t]);(0,r.useEffect)((()=>{e&&n&&_.delete(t),e&&!_.has(t)&&(w(!0),(0,v.getDatasourceSamples)(t.type,t.id,n,{}).then((e=>{p((0,h.A)(e.data)),x((0,h.A)(e.colnames)),S((0,h.A)(e.coltypes)),$(e.rowcount),E(""),_.add(t),n&&a&&a.setForceQuery(!1)})).catch((e=>{p([]),x([]),S([]),E(`${e.name}: ${e.message}`)})).finally((()=>{w(!1)})))}),[t,e,n]);const R=(0,F.XS)(b,C,u,M,o,{},!0),k=(0,F.$r)(d,u);if(A)return(0,y.Y)(m.A,{});if(I)return(0,y.FD)(y.FK,{children:[(0,y.Y)(f.x,{data:k,columnNames:b,columnTypes:C,rowcount:Y,datasourceId:M,onInputChange:e=>c(e),isLoading:A,canDownload:l}),(0,y.Y)(D,{children:I})]});if(0===u.length){const e=(0,s.t)("No samples were returned for this dataset");return(0,y.Y)(g.p,{image:"document.svg",title:e})}return(0,y.FD)(y.FK,{children:[(0,y.Y)(f.x,{data:k,columnNames:b,columnTypes:C,rowcount:Y,datasourceId:M,onInputChange:e=>c(e),isLoading:A,canDownload:l}),(0,y.Y)(T.A,{columns:R,data:k,pageSize:i,noDataText:(0,s.t)("No results"),emptyWrapperType:T.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0})]})},$=i.I4.div`
  ${({theme:e})=>`\n    position: relative;\n    background-color: ${e.colors.grayscale.light5};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${4*e.gridUnit}px;\n\n        .table {\n          margin-bottom: ${2*e.gridUnit}px;\n        }\n      }\n\n      .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}
`,I=({queryFormData:e,datasource:t,queryForce:n,onCollapseChange:u,chartStatus:h,ownState:p,errorMessage:m,actions:g,canDownload:v})=>{const b=(0,i.DP)(),[x,C]=(0,r.useState)(a.Results),[A,w]=(0,r.useState)({results:!1,samples:!1}),[T,F]=(0,r.useState)(!(0,o.G7)(o.TO.DatapanelClosedByDefault)&&(0,c.Gq)(c.Hh.IsDatapanelOpen,!1));(0,r.useEffect)((()=>{(0,o.G7)(o.TO.DatapanelClosedByDefault)||(0,c.SO)(c.Hh.IsDatapanelOpen,T)}),[T]),(0,r.useEffect)((()=>{T||w({results:!1,samples:!1}),T&&x.startsWith(a.Results)&&h&&"loading"!==h&&w({results:!0,samples:!1}),T&&x===a.Samples&&w({results:!1,samples:!0})}),[T,x,h]);const D=(0,r.useCallback)((e=>{u(e),F(e)}),[u]),_=(0,r.useCallback)(((e,t)=>{T?e===x&&(t.preventDefault(),D(!1)):D(!0),C(e)}),[x,D,T]),I=(0,r.useMemo)((()=>{const e=T?(0,y.Y)(l.F.CaretUpOutlined,{iconSize:"l","aria-label":(0,s.t)("Collapse data panel")}):(0,y.Y)(l.F.DownOutlined,{iconSize:"l","aria-label":(0,s.t)("Expand data panel")});return(0,y.Y)(f.y,{children:T?(0,y.Y)("span",{role:"button",tabIndex:0,onClick:()=>D(!1),children:e}):(0,y.Y)("span",{role:"button",tabIndex:0,onClick:()=>D(!0),children:e})})}),[D,T,b.colors.grayscale.base]),E=S({errorMessage:m,queryFormData:e,queryForce:n,ownState:p,isRequest:A.results,actions:g,isVisible:a.Results===x,canDownload:v}).map(((e,t)=>0===t?(0,y.Y)(d.Ay.TabPane,{tab:(0,s.t)("Results"),children:e},a.Results):t>0?(0,y.Y)(d.Ay.TabPane,{tab:(0,s.t)("Results %s",t+1),children:e},`${a.Results} ${t+1}`):null));return(0,y.Y)($,{"data-test":"some-purposeful-instance",children:(0,y.FD)(d.Ay,{fullWidth:!1,tabBarExtraContent:I,activeKey:T?x:"",onTabClick:_,children:[E,(0,y.Y)(d.Ay.TabPane,{tab:(0,s.t)("Samples"),children:(0,y.Y)(Y,{datasource:t,queryForce:n,isRequest:A.samples,actions:g,isVisible:a.Samples===x,canDownload:v})},a.Samples)]})})}},8877:(e,t,n)=>{n.d(t,{U:()=>d});var a=n(96540),r=n(78518),i=n(50217),o=n(39091),s=n(80493),l=n(2445);const d=({data:e,colnames:t,coltypes:n,rowcount:d,datasourceId:c,dataSize:u=50,isVisible:h,canDownload:p})=>{const[m,g]=(0,a.useState)(""),v=(0,o.XS)(t,n,e,c,h,{},!0),b=(0,o.$r)(m,e);return(0,l.FD)(l.FK,{children:[(0,l.Y)(s.x,{data:b,columnNames:t,columnTypes:n,rowcount:d,datasourceId:c,onInputChange:e=>g(e),isLoading:!1,canDownload:p}),(0,l.Y)(i.A,{columns:v,data:b,pageSize:u,noDataText:(0,r.t)("No results"),emptyWrapperType:i.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0})]})}},8901:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(5556),r=n.n(a),i=n(95483),o=n(74792),s=n(17093);const l=r().oneOfType([r().shape({expressionType:r().oneOf([s.t.SIMPLE]).isRequired,column:o.A.isRequired,aggregate:r().oneOf(Object.keys(i.dq)).isRequired,label:r().string.isRequired}),r().shape({expressionType:r().oneOf([s.t.SQL]).isRequired,sqlExpression:r().string.isRequired,label:r().string.isRequired})])},8972:(e,t,n)=>{n.d(t,{A:()=>J});var a=n(96540),r=n(5556),i=n.n(r),o=n(46920),s=n(96453),l=n(78518),d=n(49544),c=n(48327),u=n(8901),h=n(90422),p=n(86523),m=n(15595),g=n(13270),v=n(35742),b=n(27366),f=n(95483),y=n(84064),x=n(19129),C=n(90868),S=n(15151),A=n(67984),w=n(38221),T=n.n(w),F=n(62952),D=n(58561),_=n.n(D);const Y={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var $=n(59638),I=n(39942),E=n(2511),M=n(2445);const R=(0,s.I4)(C.pd)`
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
`,k=((0,s.I4)(p.A)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,(0,s.I4)(m.l6)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colors.grayscale.light1};
    width: max-content;
  }
`),O=e=>{var t,n;const{onSubjectChange:r,onOperatorChange:i,isOperatorRelevant:o,onComparatorChange:s,onDatePickerChange:d}=(e=>{const t=(0,I.IM)(),n=(t,n)=>{var a;const r=null==(a=e.datasource.columns)?void 0:a.find((e=>e.column_name===n)),i=!!r&&("BOOL"===r.type||"BOOLEAN"===r.type),o=!!r&&("INT"===r.type||"INTEGER"===r.type),s=!!r&&!!r.expression;if(t&&t===f.ux.LatestPartition){const{partitionColumn:t}=e;return t&&n&&n===t}return(!t||t!==f.ux.TemporalRange)&&(t===f.ux.IsTrue||t===f.ux.IsFalse?i||o||s:i?t===f.ux.IsNull||t===f.ux.IsNotNull:e.adhocFilter.clause!==E.v.Having||-1!==f._T.indexOf(t))};return{onSubjectChange:a=>{const r=e.options.find((e=>"column_name"in e&&e.column_name===a||"optionName"in e&&e.optionName===a));let i,o="";r&&"column_name"in r?(o=r.column_name,i=E.v.Where):r&&"saved_metric_name"in r?(o=r.saved_metric_name,i=E.v.Having):null!=r&&r.label&&(o=r.label,i=E.v.Having);let{operator:s,operatorId:l,comparator:d}=e.adhocFilter;s=s&&l&&n(l,o)?f.nS[l].operation:null,(0,g.A)(s)||(s=f.ux.In,l=f.ux.In,d=void 0),(0,A.D)(a,e.datasource)&&(o=a,s=f.ux.TemporalRange,l=f.ux.TemporalRange,d=t),e.onChange(e.adhocFilter.duplicateWith({subject:o,clause:i,operator:s,expressionType:E.A.Simple,operatorId:l,comparator:d}))},onOperatorChange:t=>{const n=e.adhocFilter.comparator;let a;a=f.sJ.has(t)?Array.isArray(n)?n:[n].filter((e=>e)):Array.isArray(n)?n[0]:n,t&&f.Wy.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:E.v.Where,operatorId:t,operator:f.nS[t].operation,expressionType:E.A.Sql,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:f.nS[t].operation,comparator:a,expressionType:E.A.Simple}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:E.A.Simple}))},isOperatorRelevant:n,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,n)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:f.ux.TemporalRange,comparator:n,expressionType:E.A.Simple}))}}})(e),[c,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(e.adhocFilter.comparator),[C,w]=(0,a.useState)(!1),{advancedDataTypesState:D,subjectAdvancedDataType:O,fetchAdvancedDataTypeValueCallback:N,fetchSubjectAdvancedDataType:U}=(e=>{const[t,n]=(0,a.useState)(Y),[r,i]=(0,a.useState)(),o=(0,a.useCallback)(((t,a,r)=>{const i=(0,F.A)(t);r?T()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${_().encode({type:r,values:i})}`;v.A.get({endpoint:t}).then((({json:t})=>{n({parsedAdvancedDataType:t.result.display_value,advancedDataTypeOperatorList:t.result.valid_filter_operators,errorMessage:t.result.error_message}),e(!t.result.error_message)})).catch((()=>{n({parsedAdvancedDataType:"",advancedDataTypeOperatorList:a.advancedDataTypeOperatorList,errorMessage:(0,l.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():n(Y)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:r,setAdvancedDataTypesState:n,fetchAdvancedDataTypeValueCallback:o,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?i(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),q=(e,t)=>O?o(e,t)&&D.advancedDataTypeOperatorList.includes(e):o(e,t),L=()=>{const e=(()=>{const e=Array.isArray(h)?h.filter((e=>c.includes(e))).length:0;return c?c.length-e:0})(),t=(0,l.t)("%s option(s)",e);return e?t:""};let z=e.options;const{subject:H,operator:P,operatorId:j}=e.adhocFilter,W={ariaLabel:(0,l.t)("Select subject"),value:null!=H?H:void 0,onChange:e=>{p(void 0),r(e)},notFoundContent:(0,l.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!H,placeholder:""};W.placeholder=e.adhocFilter.clause===E.v.Where?(0,l.t)("%s column(s)",z.length):(0,l.t)("To filter on a metric, use Custom SQL tab."),z=e.options.filter((e=>"column_name"in e&&e.column_name));const V={placeholder:(0,l.t)("%s operator(s)",(null!=(t=e.operators)?t:f.RX).filter((e=>q(e,H))).length),value:j,onChange:i,autoFocus:!!W.value&&!P,ariaLabel:(0,l.t)("Select operator")},B=!!W.value&&!!V.value,G={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,l.t)("Comparator option"),mode:f.sJ.has(j)?"multiple":"single",loading:C,value:h,onChange:s,notFoundContent:(0,l.t)("Type a value here"),disabled:f.Sd.includes(j),placeholder:L(),autoFocus:B},Q=h&&h.length>0&&L(),K=(0,$.w)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===f.ux.TemporalRange?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:d});(0,a.useEffect)((()=>{K||(()=>{const{datasource:t}=e,n=e.adhocFilter.subject,a=e.adhocFilter.clause===E.v.Having;if(n&&t&&t.filter_select&&!a){const e=new AbortController,{signal:a}=e;C&&e.abort(),w(!0),v.A.get({signal:a,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${n}/values/`}).then((({json:e})=>{u(e.result.map((e=>({value:e,label:(0,S.ed)(e)})))),w(!1)})).catch((()=>{u([]),w(!1)}))}})()}),[e.adhocFilter.subject]),(0,a.useEffect)((()=>{(0,b.G7)(b.TO.EnableAdvancedDataTypes)&&U(e)}),[e.adhocFilter.subject]),(0,a.useEffect)((()=>{(0,b.G7)(b.TO.EnableAdvancedDataTypes)&&N(void 0===h?"":h,D,O)}),[h,O,N]),(0,a.useEffect)((()=>{(0,b.G7)(b.TO.EnableAdvancedDataTypes)&&p(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]);const X=(0,M.Y)(m.l6,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),"data-test":"select-element",options:z.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,M.Y)(y.A,{option:t}))};var t})),...W}),J=(0,M.FD)(M.FK,{children:[(0,M.Y)(m.l6,{css:e=>({marginBottom:4*e.gridUnit}),options:(null!=(n=e.operators)?n:f.RX).filter((e=>q(e,H))).map(((e,t)=>({value:e,label:f.nS[e].display,key:e,order:t}))),...V}),f.sJ.has(j)||c.length>0?(0,M.Y)(x.m_,{title:D.errorMessage||D.parsedAdvancedDataType,children:(0,M.Y)(k,{labelText:Q,options:c,...G})}):(0,M.Y)(x.m_,{title:D.errorMessage||D.parsedAdvancedDataType,children:(0,M.Y)(R,{"data-test":"adhoc-filter-simple-value",name:"filter-value",ref:e=>{e&&B&&e.focus()},onChange:e=>{const{value:t}=e.target;p(t),s(t)},value:h,placeholder:(0,l.t)("Filter value (case sensitive)"),disabled:f.Sd.includes(j)})})]});return(0,M.FD)(M.FK,{children:[X,null!=K?K:J]})};var N=n(17437),U=n(24976),q=n(28274),L=n(92013);const z=(0,s.I4)(m.l6)`
  ${({theme:e})=>`\n    width: ${30*e.gridUnit}px;\n    marginRight: ${e.gridUnit}px;\n  `}
`;function H({adhocFilter:e,onChange:t,options:n,height:r}){const i=(0,a.useRef)(null),o=(0,s.DP)();(0,a.useEffect)((()=>{var e;null==i||null==(e=i.current)||e.editor.resize()}),[e]);const d=(0,a.useMemo)((()=>q.A.concat((0,L.r)(n.filter((e=>"object"==typeof e&&null!==e&&"column_name"in e&&"string"==typeof e.column_name&&"type"in e))))),[q.A]),c=(0,a.useMemo)((()=>Object.values(E.v).map((e=>({label:e,value:e})))),[E.v]);return(0,M.FD)("span",{children:[(0,M.FD)("div",{className:"filter-edit-clause-section",children:[(0,M.Y)("div",{children:(0,M.Y)(z,{options:c,ariaLabel:(0,l.t)("Select column"),placeholder:(0,l.t)("choose WHERE or HAVING..."),value:e.clause,onChange:n=>{t(e.duplicateWith({clause:n,expressionType:E.A.Sql}))}})}),(0,M.FD)("span",{className:"filter-edit-clause-info",children:[(0,M.Y)("strong",{children:"WHERE"})," ",(0,l.t)("Filters by columns"),(0,M.Y)("br",{}),(0,M.Y)("strong",{children:"HAVING"})," ",(0,l.t)("Filters by metrics")]})]}),(0,M.Y)("div",{css:N.AH`
          margin-top: ${4*o.gridUnit}px;
        `,children:(0,M.Y)(U.YU,{ref:i,keywords:d,height:r-130+"px",onChange:n=>{t(e.duplicateWith({sqlExpression:n,expressionType:E.A.Sql}))},width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})})]})}var P=n(21062);const j={adhocFilter:i().instanceOf(h.A).isRequired,onChange:i().func.isRequired,onClose:i().func.isRequired,onResize:i().func.isRequired,options:i().arrayOf(i().oneOfType([P.A,i().shape({saved_metric_name:i().string.isRequired}),u.A])).isRequired,datasource:i().object,partitionColumn:i().string,theme:i().object,sections:i().arrayOf(i().string),operators:i().arrayOf(i().string),requireSave:i().bool},W=s.I4.i`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,V=s.I4.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.gridUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.typography.sizes.xs}px;
  }

  .filter-edit-clause-section {
    display: flex;
    flex-direction: row;
    gap: ${({theme:e})=>5*e.gridUnit}px;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.gridUnit}px;
  }
`,B=s.I4.div`
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`;class G extends a.Component{constructor(e){var t,n;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:f._R,height:f.Z_,activeKey:(null==(t=this.props)||null==(n=t.adhocFilter)?void 0:n.expressionType)||"SIMPLE",isSimpleTabValid:!0},this.popoverContentRef=(0,a.createRef)()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),f._R),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),f.Z_)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:n,onClose:a,onResize:r,datasource:i,partitionColumn:s,theme:u,operators:h,requireSave:p,...m}=this.props,{adhocFilter:g}=this.state,v=g.isValid(),b=p||!g.equals(e);return(0,M.FD)(V,{id:"filter-edit-popover",...m,"data-test":"filter-edit-popover",ref:this.popoverContentRef,children:[(0,M.FD)(c.Ay,{id:"adhoc-filter-edit-tabs",defaultActiveKey:g.expressionType,className:"adhoc-filter-edit-tabs","data-test":"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange,children:[(0,M.Y)(c.Ay.TabPane,{className:"adhoc-filter-edit-tab",tab:(0,l.t)("Simple"),children:(0,M.Y)(d.A,{children:(0,M.Y)(O,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:s,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid})})},E.A.Simple),(0,M.Y)(c.Ay.TabPane,{className:"adhoc-filter-edit-tab",tab:(0,l.t)("Custom SQL"),children:(0,M.Y)(d.A,{children:(0,M.Y)(H,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})})},E.A.Sql)]}),(0,M.FD)(B,{children:[(0,M.Y)(o.A,{buttonSize:"small",onClick:this.props.onClose,cta:!0,children:(0,l.t)("Close")}),(0,M.Y)(o.A,{"data-test":"adhoc-filter-edit-popover-save-button",disabled:!v||!this.state.isSimpleTabValid||!b,buttonStyle:"primary",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0,children:(0,l.t)("Save")}),(0,M.Y)(W,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})]})]})}}G.propTypes=j;var Q=n(16238),K=n(22533);class X extends a.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:n,togglePopover:a,closePopover:r}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},i=(0,M.Y)(Q.y,{children:(0,M.Y)(G,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:r,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave})});return(0,M.Y)(K.A,{trigger:"click",content:i,defaultOpen:n,open:n,onOpenChange:a,destroyTooltipOnHide:!0,children:this.props.children})}}const J=X},14693:(e,t,n)=>{n.d(t,{QD:()=>C.Q,Ay:()=>S});var a=n(9063),r=n.n(a),i=n(96540),o=n(98250),s=n(96453),l=n(19129),d=n(62952),c=n(78518),u=n(67073),h=n(2445);const p=s.I4.div`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`,m=({text:e,header:t})=>{const n=(0,d.A)(e);return(0,h.FD)(h.FK,{children:[t&&(0,h.Y)(p,{children:t}),n.map((e=>(0,h.Y)("div",{children:e},e)))]})},g=16,v={dashboards:0,table:1,sql:2,rows:3,tags:4,description:5,owner:6,lastModified:7},b=s.I4.div`
  ${({theme:e,count:t})=>`\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    background-color: ${e.colors.grayscale.light4};\n    color: ${e.colors.grayscale.base};\n    font-size: ${e.typography.sizes.s}px;\n    min-width: ${24+32*t-g}px;\n    border-radius: ${e.borderRadius}px;\n    line-height: 1;\n  `}
`,f=s.I4.div`
  ${({theme:e,collapsed:t,last:n,onClick:a})=>`\n    display: flex;\n    align-items: center;\n    max-width: ${174+(n?0:g)}px;\n    min-width: ${t?16+(n?0:g):94+(n?0:g)}px;\n    padding-right: ${n?0:g}px;\n    cursor: ${a?"pointer":"default"};\n    & .metadata-icon {\n      color: ${a&&t?e.colors.primary.base:e.colors.grayscale.base};\n      padding-right: ${t?0:8}px;\n      & .anticon {\n        line-height: 0;\n      }\n    }\n    & .metadata-text {\n      min-width: 70px;\n      overflow: hidden;\n      text-overflow: ${t?"unset":"ellipsis"};\n      white-space: nowrap;\n      text-decoration: ${a?"underline":"none"};\n      line-height: 1.4;\n    }\n  `}
`,y=s.I4.div`
  display: -webkit-box;
  -webkit-line-clamp: 20;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
`,x=({barWidth:e,contentType:t,collapsed:n,last:a=!1,tooltipPlacement:r})=>{const{icon:o,title:s,tooltip:d=s}=(e=>{const{type:t}=e;switch(t){case C.Q.Dashboards:return{icon:u.F.FundProjectionScreenOutlined,title:e.title,tooltip:e.description?(0,h.Y)("div",{children:(0,h.Y)(m,{header:e.title,text:e.description})}):void 0};case C.Q.Description:return{icon:u.F.BookOutlined,title:e.value};case C.Q.LastModified:return{icon:u.F.EditOutlined,title:e.value,tooltip:(0,h.FD)("div",{children:[(0,h.Y)(m,{header:(0,c.t)("Last modified"),text:e.value}),(0,h.Y)(m,{header:(0,c.t)("Modified by"),text:e.modifiedBy})]})};case C.Q.Owner:return{icon:u.F.UserOutlined,title:e.createdBy,tooltip:(0,h.FD)("div",{children:[(0,h.Y)(m,{header:(0,c.t)("Created by"),text:e.createdBy}),!!e.owners&&(0,h.Y)(m,{header:(0,c.t)("Owners"),text:e.owners}),(0,h.Y)(m,{header:(0,c.t)("Created on"),text:e.createdOn})]})};case C.Q.Rows:return{icon:u.F.InsertRowBelowOutlined,title:e.title,tooltip:e.title};case C.Q.Sql:return{icon:u.F.ConsoleSqlOutlined,title:e.title,tooltip:e.title};case C.Q.Table:return{icon:u.F.InsertRowAboveOutlined,title:e.title,tooltip:e.title};case C.Q.Tags:return{icon:u.F.TagsOutlined,title:e.values.join(", "),tooltip:(0,h.Y)("div",{children:(0,h.Y)(m,{header:(0,c.t)("Tags"),text:e.values})})};default:throw Error(`Invalid type provided: ${t}`)}})(t),[p,g]=(0,i.useState)(!1),v=(0,i.useRef)(null),b=o,{type:x,onClick:S}=t;(0,i.useEffect)((()=>{g(!!v.current&&v.current.scrollWidth>v.current.clientWidth)}),[e,g,t]);const A=(0,h.FD)(f,{collapsed:n,last:a,onClick:S?()=>S(x):void 0,role:S?"button":void 0,children:[(0,h.Y)(b,{iconSize:"l",className:"metadata-icon"}),!n&&(0,h.Y)("span",{ref:v,className:"metadata-text",children:s})]});return p||n||d&&d!==s?(0,h.Y)(l.m_,{placement:r,title:(0,h.Y)(y,{children:d}),children:A}):A};var C=n(70175);const S=({items:e,tooltipPlacement:t="top"})=>{const[n,a]=(0,i.useState)(),[s,l]=(0,i.useState)(!1),d=r()(e,((e,t)=>e.type===t.type)).sort(((e,t)=>v[e.type]-v[t.type])),c=d.length;if(c<2)throw Error("The minimum number of items for the metadata bar is 2.");if(c>6)throw Error("The maximum number of items for the metadata bar is 6.");const u=(0,i.useCallback)((e=>{const t=110*c-g;a(e),l(Boolean(e&&e<t))}),[c]),{ref:p}=(0,o.uZ)({onResize:u});return(0,h.Y)(b,{ref:p,count:c,"data-test":"metadata-bar",children:d.map(((e,a)=>(0,h.Y)(x,{barWidth:n,contentType:e,collapsed:s,last:a===c-1,tooltipPlacement:t},a)))})}},15700:(e,t,n)=>{n.d(t,{t3:()=>j,oU:()=>W});var a=n(96540),r=n(61225),i=n(93641),o=n(96453),s=n(17437),l=n(78518),d=n(27366),c=n(67073),u=n(6749),h=n(18301),p=n(46920),m=n(5261),g=n(85183),v=n(72965),b=n(32132),f=n(73135),y=n(71085),x=n(7735),C=n(35700),S=n(17432),A=n(90868),w=n(19966),T=n(27023),F=n(39091),D=n(2445);const _=(0,o.I4)(F.i8)`
  && {
    margin: 0 0 ${({theme:e})=>e.gridUnit}px;
  }
`,Y=({formData:e,addDangerToast:t})=>{const[n,r]=(0,a.useState)("400"),[i,o]=(0,a.useState)("600"),[d,c]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),p=(0,a.useCallback)((e=>{const{value:t,name:n}=e.currentTarget;"width"===n&&o(t),"height"===n&&r(t)}),[]),m=(0,a.useCallback)((()=>{c(""),(0,b.Kx)(e).then((e=>{c(e),h("")})).catch((()=>{h((0,l.t)("Error")),t((0,l.t)("Sorry, something went wrong. Try again later."))}))}),[t,e]);(0,a.useEffect)((()=>{m()}),[]);const g=(0,a.useMemo)((()=>{if(!d)return"";const e=`${d}?${T.vX.standalone.name}=1&height=${n}`;return`<iframe\n  width="${i}"\n  height="${n}"\n  seamless\n  frameBorder="0"\n  scrolling="no"\n  src="${e}"\n>\n</iframe>`}),[n,d,i]),v=u||g||(0,l.t)("Generating link, please wait..");return(0,D.FD)("div",{id:"embed-code-popover","data-test":"embed-code-popover",children:[(0,D.FD)("div",{css:s.AH`
          display: flex;
          flex-direction: column;
        `,children:[(0,D.Y)(w.A,{shouldShowText:!1,text:g,copyNode:(0,D.Y)(_,{buttonSize:"xsmall",children:(0,D.Y)("i",{className:"fa fa-clipboard"})})}),(0,D.Y)(A.fs,{"data-test":"embed-code-textarea",name:"embedCode",disabled:!g,value:v,rows:"4",readOnly:!0,css:e=>s.AH`
            resize: vertical;
            padding: ${2*e.gridUnit}px;
            font-size: ${e.typography.sizes.s}px;
            border-radius: 4px;
            background-color: ${e.colors.secondary.light5};
          `})]}),(0,D.FD)("div",{css:e=>s.AH`
          display: flex;
          margin-top: ${4*e.gridUnit}px;
          & > div {
            margin-right: ${2*e.gridUnit}px;
          }
          & > div:last-of-type {
            margin-right: 0;
            margin-left: ${2*e.gridUnit}px;
          }
        `,children:[(0,D.FD)("div",{children:[(0,D.Y)("label",{htmlFor:"embed-height",children:(0,l.t)("Chart height")}),(0,D.Y)(A.pd,{type:"text",defaultValue:n,name:"height",onChange:p})]}),(0,D.FD)("div",{children:[(0,D.Y)("label",{htmlFor:"embed-width",children:(0,l.t)("Chart width")}),(0,D.Y)(A.pd,{type:"text",defaultValue:i,name:"width",onChange:p,id:"embed-width"})]})]})]})};var $=n(71519);const I=({chartId:e,dashboards:t=[],...n})=>{const r=(0,o.DP)(),[i,d]=(0,a.useState)(),[h,p]=(0,a.useState)(),m=t.length>10,g=t.filter((e=>!i||e.dashboard_title.toLowerCase().includes(i.toLowerCase()))),v=0===t.length,b=i&&0===g.length,f=e?`?focused_chart=${e}`:"";return(0,D.FD)(D.FK,{children:[m&&(0,D.Y)(A.pd,{allowClear:!0,placeholder:(0,l.t)("Search"),prefix:(0,D.Y)(c.F.StarOutlined,{iconSize:"l"}),css:s.AH`
            width: ${220}px;
            margin: ${2*r.gridUnit}px ${3*r.gridUnit}px;
          `,value:i,onChange:e=>d(e.currentTarget.value)}),(0,D.FD)("div",{css:s.AH`
          max-height: ${300}px;
          overflow: auto;
        `,children:[g.map((e=>(0,D.Y)(u.W1.Item,{onMouseEnter:()=>p(e.id),onMouseLeave:()=>{h===e.id&&p(null)},...n,children:(0,D.Y)($.N_,{target:"_blank",rel:"noreferer noopener",to:`/superset/dashboard/${e.id}${f}`,children:(0,D.FD)("div",{css:s.AH`
                  display: flex;
                  flex-direction: row;
                  align-items: center;
                  max-width: ${220}px;
                `,children:[(0,D.Y)("div",{css:s.AH`
                    white-space: normal;
                  `,children:e.dashboard_title}),(0,D.Y)(c.F.Full,{iconSize:"l",css:s.AH`
                    margin-left: ${2*r.gridUnit}px;
                    visibility: ${h===e.id?"visible":"hidden"};
                  `})]})})},String(e.id)))),b&&(0,D.Y)("div",{css:s.AH`
              margin-left: ${3*r.gridUnit}px;
              margin-bottom: ${r.gridUnit}px;
            `,children:(0,l.t)("No results found")}),v&&(0,D.Y)(u.W1.Item,{disabled:!0,css:s.AH`
              min-width: ${220}px;
            `,...n,children:(0,l.t)("None")})]})]})},E="edit_properties",M="export_to_csv",R="export_to_csv_pivoted",k="export_to_json",O="export_to_xlsx",N="download_as_image",U="copy_permalink",q="embed_code",L="share_by_email",z="view_query",H="run_in_sql_lab",P=[i.Y.PivotTable],j=o.I4.div`
  ${({theme:e})=>s.AH`
    display: flex;
    align-items: center;

    & svg {
      width: ${3*e.gridUnit}px;
      height: ${3*e.gridUnit}px;
    }

    & span[role='checkbox'] {
      display: inline-flex;
      margin-right: ${e.gridUnit}px;
    }
  `}
`,W=((0,o.I4)(p.A)`
  ${({theme:e})=>s.AH`
    width: ${8*e.gridUnit}px;
    height: ${8*e.gridUnit}px;
    padding: 0;
    border: 1px solid ${e.colors.primary.dark2};

    &.antd5-btn > span.anticon {
      line-height: 0;
      transition: inherit;
    }

    &:hover:not(:focus) > span.anticon {
      color: ${e.colors.primary.light1};
    }
  `}
`,(e,t,n,i,s,p,A,w,T,...F)=>{const _=(0,o.DP)(),{addDangerToast:$,addSuccessToast:j}=(0,m.Yf)(),W=(0,r.wA)(),[V,B]=(0,a.useState)(null),[G,Q]=(0,a.useState)(!1),K=(0,r.d4)((e=>{var t;return null==(t=e.charts)?void 0:t[(0,g.kD)(e.explore)]})),{datasource:X}=e,J=(0,a.useCallback)((async()=>{try{const t=(0,l.t)("Superset Chart"),n=await(0,b.Kx)(e),a=encodeURIComponent((0,l.t)("%s%s","Check out this chart: ",n));window.location.href=`mailto:?Subject=${t}%20&Body=${a}`}catch(e){$((0,l.t)("Sorry, something went wrong. Try again later."))}}),[$,e]),Z=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,ownState:p,resultType:"full",resultFormat:"csv"}):null),[t,e]),ee=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"post_processed",resultFormat:"csv"}):null),[t,e]),te=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"results",resultFormat:"json"}):null),[t,e]),ne=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"results",resultFormat:"xlsx"}):null),[t,e]),ae=(0,a.useCallback)((async()=>{try{if(!e)throw new Error;await(0,f.A)((()=>(0,b.Kx)(e))),j((0,l.t)("Copied to clipboard!"))}catch(e){$((0,l.t)("Sorry, something went wrong. Try again later."))}}),[$,j,e]),re=(0,a.useCallback)((({key:t,domEvent:a})=>{var r;switch(t){case E:s(),Q(!1);break;case M:Z(),Q(!1),W((0,x.logEvent)(C.xb,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case R:ee(),Q(!1),W((0,x.logEvent)(C.vp,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case k:te(),Q(!1),W((0,x.logEvent)(C.v2,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case O:ne(),Q(!1),W((0,x.logEvent)(C.k8,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case N:(0,v.A)(".panel-body .chart-container",null!=(r=null==n?void 0:n.slice_name)?r:(0,l.t)("New chart"),!0)(a),Q(!1),W((0,x.logEvent)(C.C7,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case U:ae(),Q(!1);break;case q:Q(!1);break;case L:J(),Q(!1);break;case z:Q(!1);break;case H:i(e,a.metaKey),Q(!1)}}),[ae,Z,ee,te,e,i,s,J,null==n?void 0:n.slice_name]);return[(0,a.useMemo)((()=>(0,D.FD)(u.W1,{onClick:re,selectable:!1,...F,children:[(0,D.FD)(D.FK,{children:[n&&(0,D.Y)(u.W1.Item,{children:(0,l.t)("Edit chart properties")},E),(0,D.Y)(u.W1.SubMenu,{title:(0,l.t)("On dashboards"),children:(0,D.Y)(I,{chartId:null==n?void 0:n.slice_id,dashboards:A})},"dashboards_added_to"),(0,D.Y)(u.W1.Divider,{})]}),(0,D.FD)(u.W1.SubMenu,{title:(0,l.t)("Download"),children:[P.includes(e.viz_type)?(0,D.FD)(D.FK,{children:[(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to original .CSV")},M),(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to pivoted .CSV")},R)]}):(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to .CSV")},M),(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to .JSON")},k),(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileImageOutlined,{}),children:(0,l.t)("Download as image")},N),(0,D.Y)(u.W1.Item,{icon:(0,D.Y)(c.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to Excel")},O)]},"download_submenu"),(0,D.FD)(u.W1.SubMenu,{title:(0,l.t)("Share"),children:[(0,D.Y)(u.W1.Item,{children:(0,l.t)("Copy permalink to clipboard")},U),(0,D.Y)(u.W1.Item,{children:(0,l.t)("Share chart by email")},L),(0,d.G7)(d.TO.EmbeddableCharts)?(0,D.Y)(u.W1.Item,{children:(0,D.Y)(h.A,{triggerNode:(0,D.Y)("div",{"data-test":"embed-code-button",children:(0,l.t)("Embed code")}),modalTitle:(0,l.t)("Embed code"),modalBody:(0,D.Y)(Y,{formData:e,addDangerToast:$}),maxWidth:100*_.gridUnit+"px",destroyOnClose:!0,responsive:!0})},q):null]},"share_submenu"),(0,D.Y)(u.W1.Divider,{}),V?(0,D.FD)(D.FK,{children:[(0,D.Y)(y.A,{submenuTitle:(0,l.t)("Manage email report"),chart:K,setShowReportSubMenu:B,showReportSubMenu:V,showReportModal:w,setCurrentReportDeleting:T,useTextMenu:!0}),(0,D.Y)(u.W1.Divider,{})]}):(0,D.Y)(y.A,{chart:K,setShowReportSubMenu:B,showReportModal:w,setCurrentReportDeleting:T,useTextMenu:!0}),(0,D.Y)(u.W1.Item,{children:(0,D.Y)(h.A,{triggerNode:(0,D.Y)("div",{"data-test":"view-query-menu-item",children:(0,l.t)("View query")}),modalTitle:(0,l.t)("View query"),modalBody:(0,D.Y)(S.A,{latestQueryFormData:e}),draggable:!0,resizable:!0,responsive:!0})},z),X&&(0,D.Y)(u.W1.Item,{children:(0,l.t)("Run in SQL Lab")},H)]})),[$,t,K,A,re,G,e,V,n,_.gridUnit]),G,Q]})},16238:(e,t,n)=>{n.d(t,{y:()=>a});const a=n(96453).I4.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.gridUnit}px;
    margin-right: ${({theme:e})=>-2*e.gridUnit}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colors.grayscale.light2} solid thin;
  }
`},17093:(e,t,n)=>{n.d(t,{A:()=>s,t:()=>r});var a=n(95483);const r={SIMPLE:"SIMPLE",SQL:"SQL"};function i(e){if(e.sqlExpression&&a.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function o(e){if(e.sqlExpression&&a.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class s{constructor(e){if(this.expressionType=e.expressionType||r.SIMPLE,this.expressionType===r.SIMPLE){const t=i(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||o(e),this.sqlExpression=null}else this.expressionType===r.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){return this.translateToSql({useVerboseName:!0})}translateToSql(e={useVerboseName:!1,transformCountDistinct:!1}){if(this.expressionType===r.SIMPLE){var t,n;const r=this.aggregate||"",i=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(n=this.column)&&n.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&r===a.dq.COUNT_DISTINCT&&/^\(.*\)$/.test(i)?`COUNT(DISTINCT ${i.slice(1,-1)})`:r+i}return this.expressionType===r.SQL?this.sqlExpression:""}duplicateWith(e){return new s({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===r.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===r.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return o(this)}inferSqlExpressionColumn(){return i(this)}}},17432:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(96540),r=n(96453),i=n(62952),o=n(51436),s=n(78518),l=n(17444),d=n(2514),c=n(91643),u=n(2445);const h=r.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,p=({latestQueryFormData:e})=>{const[t,n]=(0,a.useState)([]),[r,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(null);return(0,a.useEffect)((()=>{p(!0),(0,d.getChartDataRequest)({formData:e,resultFormat:"json",resultType:"query"}).then((({json:e})=>{n((0,i.A)(e.result)),p(!1),g(null)})).catch((e=>{(0,o.h4)(e).then((({error:t,message:n})=>{g(t||n||e.statusText||(0,s.t)("Sorry, An error occurred")),p(!1)}))}))}),[JSON.stringify(e)]),r?(0,u.Y)(l.A,{}):m?(0,u.Y)("pre",{children:m}):(0,u.Y)(h,{children:t.map((t=>t.query?(0,u.Y)(c.A,{datasource:e.datasource,sql:t.query,language:t.language||void 0}):null))})}},19966:(e,t,n)=>{n.d(t,{A:()=>h});var a=n(96540),r=n(78518),i=n(19129),o=n(5261),s=n(73135),l=n(2445);const d={copyNode:(0,l.Y)("span",{children:(0,r.t)("Copy")}),onCopyEnd:()=>{},shouldShowText:!0,wrapped:!0,tooltipText:(0,r.t)("Copy to clipboard"),hideTooltip:!1};var c={name:"8irbms",styles:"display:inline-flex;align-items:center"};class u extends a.Component{constructor(e){super(e),this.copyToClipboard=this.copyToClipboard.bind(this),this.onClick=this.onClick.bind(this)}onClick(){this.props.getText?this.props.getText((e=>{this.copyToClipboard(Promise.resolve(e))})):this.copyToClipboard(Promise.resolve(this.props.text||""))}getDecoratedCopyNode(){return(0,a.cloneElement)(this.props.copyNode,{style:{cursor:"pointer"},onClick:this.onClick})}copyToClipboard(e){(0,s.A)((()=>e)).then((()=>{this.props.addSuccessToast((0,r.t)("Copied to clipboard!"))})).catch((()=>{this.props.addDangerToast((0,r.t)("Sorry, your browser does not support copying. Use Ctrl / Cmd + C!"))})).finally((()=>{this.props.onCopyEnd&&this.props.onCopyEnd()}))}renderTooltip(e){return(0,l.Y)(l.FK,{children:this.props.hideTooltip?this.getDecoratedCopyNode():(0,l.Y)(i.m_,{id:"copy-to-clipboard-tooltip",placement:"topRight",style:{cursor:e},title:this.props.tooltipText||"",trigger:["hover"],arrow:{pointAtCenter:!0},children:this.getDecoratedCopyNode()})})}renderNotWrapped(){return this.renderTooltip("pointer")}renderLink(){return(0,l.FD)("span",{css:c,children:[this.props.shouldShowText&&this.props.text&&(0,l.Y)("span",{className:"m-r-5","data-test":"short-url",children:this.props.text}),this.renderTooltip("pointer")]})}render(){const{wrapped:e}=this.props;return e?this.renderLink():this.renderNotWrapped()}}u.defaultProps=d;const h=(0,o.Ay)(u)},21062:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(5556),r=n.n(a);const i=r().shape({column_name:r().string.isRequired,type:r().string})},21357:(e,t,n)=>{n.d(t,{w:()=>o});var a=n(78518);const r=(0,a.t)("Create chart"),i=(0,a.t)("Update chart"),o=e=>(0,a.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?r:i}"`)},25143:(e,t,n)=>{n.d(t,{S:()=>a.A,v:()=>r.A});var a=n(46740),r=n(16707)},25671:(e,t,n)=>{n.d(t,{A:()=>O});var a=n(96540),r=n(5556),i=n.n(r),o=n(35742),s=n(5362),l=n(78518),d=n(62952),c=n(17437),u=n(98837),h=n(50317),p=n(8901),m=n(32291),g=n(17093),v=n(95483),b=n(84064),f=n(72652),y=n(67073),x=n(85861),C=n(8972),S=n(28254),A=n(59638),w=n(2445);function T({adhocFilter:e,options:t,datasource:n,onFilterEdit:a,onRemoveFilter:r,partitionColumn:i,onMoveLabel:o,onDropLabel:s,index:l,sections:d,operators:c}){const{actualTimeRange:u,title:h}=(0,A.K)(e);return(0,w.Y)(C.A,{sections:d,operators:c,adhocFilter:e,options:t,datasource:n,onFilterEdit:a,partitionColumn:i,children:(0,w.Y)(f.Px,{label:null!=u?u:e.getDefaultLabel(),tooltipTitle:null!=h?h:e.getTooltipTitle(),onRemove:r,onMoveLabel:o,onDropLabel:s,index:l,type:S.S.FilterOption,withCaret:!0,isExtra:e.isExtra})})}var F=n(90422),D=n(2511);const _=i().oneOfType([i().shape({expressionType:i().oneOf([D.A.Simple]).isRequired,clause:i().oneOf([D.v.Having,D.v.Where]).isRequired,subject:i().string.isRequired,comparator:i().oneOfType([i().string,i().arrayOf(i().string)]).isRequired}),i().shape({expressionType:i().oneOf([D.A.Sql]).isRequired,clause:i().oneOf([D.v.Where,D.v.Having]).isRequired,sqlExpression:i().string.isRequired})]);var Y=n(21062),$=n(32132);const{warning:I}=x.Ay,E=i().oneOfType([i().string,p.A]),M={label:i().oneOfType([i().object,i().string]),name:i().string,sections:i().arrayOf(i().string),operators:i().arrayOf(i().string),onChange:i().func,value:i().arrayOf(_),datasource:i().object,columns:i().arrayOf(Y.A),savedMetrics:i().arrayOf(m.A),selectedMetrics:i().oneOfType([E,i().arrayOf(E)]),isLoading:i().bool,canDelete:i().func};function R(e){return e&&!(e instanceof F.A)&&e.expressionType}class k extends a.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>R(e)?new F.A(e):e));this.optionRenderer=e=>(0,w.Y)(b.A,{option:e}),this.valueRenderer=(e,t)=>(0,w.Y)(T,{index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn},t),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const n=null==(t=e.database)?void 0:t.id,{datasource_name:a,catalog:r,schema:i,is_sqllab_view:l}=e;!l&&n&&a&&i&&o.A.get({endpoint:`/api/v1/database/${n}/table_metadata/extra/${(0,$.zJ)({name:a,catalog:r,schema:i})}`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}})).catch((e=>{s.A.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>R(e)?new F.A(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:n}=this.state,a=null==t?void 0:t(n[e],n);"string"!=typeof a?this.removeFilter(e):I({title:(0,l.t)("Warning"),content:a})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:n}=this.state,a=[...n];[a[t],a[e]]=[a[e],a[t]],this.setState({values:a})}mapOption(e){return e instanceof F.A?e:e.saved_metric_name?new F.A({expressionType:D.A.Sql,subject:this.getMetricExpression(e.saved_metric_name),operator:v.nS[v.ux.GreaterThan].operation,comparator:0,clause:D.v.Having}):e.label?new F.A({expressionType:D.A.Sql,subject:new g.A(e).translateToSql(),operator:v.nS[v.ux.GreaterThan].operation,comparator:0,clause:D.v.Having}):e.column_name?new F.A({expressionType:D.A.Simple,subject:e.column_name,operator:v.nS[v.ux.Equals].operation,comparator:"",clause:D.v.Where,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,d.A)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new g.A(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof g.A&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,w.Y)(C.A,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new F.A({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn,children:e})}render(){const{theme:e}=this.props;return(0,w.FD)("div",{className:"metrics-select","data-test":"adhoc-filter-control",children:[(0,w.FD)(f.B3,{children:[(0,w.Y)(h.A,{...this.props}),this.addNewFilterPopoverTrigger((0,w.Y)(f.XB,{"data-test":"add-filter-button",children:(0,w.Y)(y.F.PlusOutlined,{iconSize:"m",iconColor:e.colors.grayscale.light5})}))]}),(0,w.Y)(f.p6,{children:this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,w.FD)(f.JG,{children:[(0,w.Y)(y.F.PlusOutlined,{css:c.AH`
                      margin: auto ${e.gridUnit}px auto 0;
                    `,iconSize:"m",iconColor:e.colors.grayscale.light1}),(0,l.t)("Add filter")]}))})]})}}k.propTypes=M,k.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const O=(0,u.b)(k)},26761:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(78518),r=n(32142),i=n(35768),o=n(19129),s=n(2445);const l=(0,a.t)("The row limit set for the chart was reached. The chart may show partial data.");function d(e){const{rowcount:t=0,limit:n=null,loading:d}=e,c=n&&t>=n,u=c||0===t&&!d?"danger":"default",h=(0,r.gV)()(t),p=(0,s.Y)(i.Ay,{type:u,children:d?(0,a.t)("Loading..."):(0,s.Y)("span",{"data-test":"row-count-label",children:(0,a.tn)("%s row","%s rows",t,h)})});return c?(0,s.Y)(o.m_,{id:"tt-rowcount-tooltip",title:(0,s.Y)("span",{children:l}),children:p}):p}},28254:(e,t,n)=>{var a;n.d(t,{S:()=>a}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(a||(a={}))},28274:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(67553);const r=["AND","AS","ASC","AVG","BY","CASE","COUNT","CREATE","CROSS","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","ELSE","END","FOREIGN","FROM","GRANT","GROUP","HAVING","IF","INNER","INSERT","JOIN","KEY","LEFT","LIMIT","MAX","MIN","NATURAL","NOT","NULL","OFFSET","ON","OR","ORDER","OUTER","PRIMARY","REFERENCES","RIGHT","SELECT","SUM","TABLE","THEN","TYPE","UNION","UPDATE","WHEN","WHERE"].concat(["BIGINT","BINARY","BIT","CHAR","DATE","DECIMAL","DOUBLE","FLOAT","INT","INTEGER","MONEY","NUMBER","NUMERIC","REAL","SET","TEXT","TIMESTAMP","VARCHAR"]).map((e=>({meta:"sql",name:e,score:a.lI,value:e})))},28543:(e,t,n)=>{n.d(t,{oY:()=>l}),n(96540);var a=n(37827),r=n(17437),i=n(6749),o=n(19129),s=n(2445);const l=({tooltipText:e,children:t,onClick:n,style:l,menuKey:d})=>{const[c,u]=(0,a.A)();return(0,s.Y)(i.W1.Item,{css:r.AH`
        display: flex;
        line-height: 1.5em;
      `,eventKey:d,onClick:n,style:l,children:(0,s.Y)(o.m_,{title:u?e:null,children:(0,s.Y)("div",{ref:c,css:r.AH`
            max-width: 100%;
            ${a.P};
          `,children:t})})})}},29356:(e,t,n)=>{n.d(t,{A:()=>B});var a=n(96540),r=n(61574),i=n(96453),o=n(78518),s=n(17437),l=n(85861),d=n(46920),c=n(61225),u=n(94229),h=n(84666),p=n(87903),m=n(62952),g=n(98250),v=n(17444),b=n(27023),f=n(2445);const y=function({value:e}){return(0,f.Y)("span",{children:e?b.bU:b.y2})},x=i.I4.span`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,C=function(){return(0,f.Y)(x,{children:b.bV})};var S=n(85170),A=n(7349);const w=function({format:e=S.A.DATABASE_DATETIME,value:t}){return t?(0,f.Y)("span",{children:(0,A.mo)(e).format(t)}):(0,f.Y)(C,{})};var T=n(50455),F=n(2514),D=n(51003),_=n(78697),Y=n(67073),$=n(64535);const I=function(e){const{headerTitle:t,groupTitle:n,groupOptions:r,value:o,onChange:l}=e,d=(0,i.DP)(),[c,u]=(0,a.useState)(!1);return(0,f.FD)("div",{css:s.AH`
        display: flex;
        align-items: center;
      `,children:[(0,f.Y)($.A,{trigger:"click",open:c,content:(0,f.FD)("div",{children:[(0,f.Y)("div",{css:s.AH`
                font-weight: ${d.typography.weights.bold};
                margin-bottom: ${d.gridUnit}px;
              `,children:n}),(0,f.Y)(_.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:4,wrap:!1,align:"start"},value:o,onChange:e=>{l(e.target.value),u(!1)},options:r})]}),placement:"bottomLeft",arrow:{pointAtCenter:!0},children:(0,f.Y)(Y.F.SettingOutlined,{iconSize:"m",iconColor:d.colors.grayscale.light1,css:s.AH`
            margin-top: ${.75*d.gridUnit}px;
            margin-right: ${d.gridUnit}px;
          `,onClick:()=>u(!0)})}),t]})};var E=n(86274),M=n(55976),R=n(25143),k=n(70700),O=n(26761);function N({filters:e,setFilters:t,totalCount:n,loading:r,onReload:l}){const d=(0,i.DP)(),c=(0,a.useMemo)((()=>Object.assign({},...e.map((e=>({[(0,k.q0)(e.col)?e.col.label:e.col]:e}))))),[e]),u=(0,a.useCallback)((e=>{const n={...c};delete n[e],t([...Object.values(n)])}),[c,t]),h=(0,a.useMemo)((()=>Object.entries(c).map((([e,{val:t,formattedVal:n}])=>({colName:e,val:null!=n?n:t}))).sort(((e,t)=>e.colName.localeCompare(t.colName)))),[c]);return(0,f.FD)("div",{css:s.AH`
        display: flex;
        justify-content: space-between;
        padding: ${d.gridUnit/2}px 0;
        margin-bottom: ${2*d.gridUnit}px;
      `,children:[(0,f.Y)("div",{css:s.AH`
          display: flex;
          flex-wrap: wrap;
        `,children:h.map((({colName:e,val:t},n)=>(0,f.FD)(R.v,{editable:!0,onDelete:u.bind(null,e),index:n,id:n,name:`${e}=${t}`,"data-test":"filter-col",children:[(0,f.Y)("span",{css:s.AH`
                margin-right: ${d.gridUnit}px;
              `,children:e}),(0,f.Y)("strong",{"data-test":"filter-val",children:t})]},e)))}),(0,f.FD)("div",{css:s.AH`
          display: flex;
          align-items: center;
          height: min-content;
        `,children:[(0,f.Y)(O.A,{loading:r&&!n,rowcount:n}),(0,f.Y)(Y.F.ReloadOutlined,{iconColor:d.colors.grayscale.light1,iconSize:"l","aria-label":(0,o.t)("Reload"),role:"button",onClick:l})]})]})}var U=n(90179),q=n.n(U),L=n(26632);const z=50;var H,P={name:"82a6rk",styles:"flex:1"};function j({children:e}){const{ref:t,height:n}=(0,g.uZ)();return(0,f.Y)("div",{ref:t,css:P,children:(0,a.cloneElement)(e,{height:n})})}function W({formData:e,initialFilters:t}){var n;const r=(0,i.DP)(),[l,d]=(0,a.useState)(0),u=(0,a.useRef)(l),[h,g]=(0,a.useState)(t),[b,x]=(0,a.useState)(!1),[S,A]=(0,a.useState)(""),[_,Y]=(0,a.useState)(new Map),[$,R]=(0,a.useState)({}),k=(0,c.d4)((e=>e.common.conf.SAMPLES_ROW_LIMIT)),[O,U]=(0,a.useMemo)((()=>e.datasource.split("__")),[e.datasource]),{metadataBar:P,status:W}=(0,M.M)({datasetId:O}),V=(0,a.useMemo)((()=>{const e=_.get(l);return e?(u.current=l,e):_.get(u.current)}),[l,_]),B=(0,a.useMemo)((()=>(null==V?void 0:V.colNames.map(((e,t)=>({key:e,dataIndex:e,title:(null==V?void 0:V.colTypes[t])===p.s.Temporal?(0,f.Y)(I,{headerTitle:e,groupTitle:(0,o.t)("Formatting"),groupOptions:[{label:(0,o.t)("Original value"),value:H.Original},{label:(0,o.t)("Formatted value"),value:H.Formatted}],value:$[e]===H.Original?H.Original:H.Formatted,onChange:t=>R((n=>({...n,[e]:parseInt(t,10)})))}):e,render:n=>!0===n||!1===n?(0,f.Y)(y,{value:n}):null===n?(0,f.Y)(C,{}):(null==V?void 0:V.colTypes[t])===p.s.Temporal&&$[e]!==H.Original&&("number"==typeof n||n instanceof Date)?(0,f.Y)(w,{value:n}):String(n),width:150}))))||[]),[null==V?void 0:V.colNames,null==V?void 0:V.colTypes,$]),G=(0,a.useMemo)((()=>(null==V?void 0:V.data.map(((e,t)=>null==V?void 0:V.colNames.reduce(((t,n)=>({...t,[n]:e[n]})),{key:t}))))||[]),[null==V?void 0:V.colNames,null==V?void 0:V.data]),Q=(0,a.useCallback)((()=>{A(""),Y(new Map),d(0)}),[]);(0,a.useEffect)((()=>{A(""),Y(new Map),d(0)}),[h]),(0,a.useEffect)((()=>{if(_.has(l)&&[..._.keys()].at(-1)!==l){const e=new Map(_);e.delete(l),Y(e.set(l,_.get(l)))}}),[l,_]),(0,a.useEffect)((()=>{if(!S&&!b&&!_.has(l)){var t;x(!0);const n=null!=(t=function(e,t){if(!e)return;const n=(0,L.A)(e),a=q()(n.extras,"having"),r=[...(0,m.A)(n.filters),...(0,m.A)(t).map((e=>q()(e,"formattedVal")))];return{granularity:n.granularity,time_range:n.time_range,filters:r,extras:a}}(e,h))?t:{},a=Math.ceil(k/z);(0,F.getDatasourceSamples)(U,O,!1,n,z,l+1).then((e=>{Y(new Map([...[..._.entries()].slice(1-a),[l,{total:e.total_count,data:e.data,colNames:(0,m.A)(e.colnames),colTypes:(0,m.A)(e.coltypes)}]])),A("")})).catch((e=>{A(`${e.name}: ${e.message}`)})).finally((()=>{x(!1)}))}}),[k,O,U,h,e,b,l,S,_]);const K=!S&&!_.size||W===E.bk.Loading,X=null==(n=e.allow_render_html)||n;let J=null;if(S)J=(0,f.Y)("pre",{css:s.AH`
          margin-top: ${4*r.gridUnit}px;
        `,children:S});else if(K)J=(0,f.Y)(v.A,{});else if(0===(null==V?void 0:V.total)){const e=(0,o.t)("No rows were returned for this dataset");J=(0,f.Y)(T.p,{image:"document.svg",title:e})}else J=(0,f.Y)(j,{children:(0,f.Y)(D.Ay,{data:G,columns:B,size:D.QS.Small,defaultPageSize:z,recordCount:null==V?void 0:V.total,usePagination:!0,loading:b,onChange:e=>d(e.current?e.current-1:0),resizable:!0,virtualize:!0,allowHTML:X})});return(0,f.FD)(f.FK,{children:[!K&&P,!K&&(0,f.Y)(N,{filters:h,setFilters:g,totalCount:null==V?void 0:V.total,loading:b,onReload:Q}),J]})}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(H||(H={}));const V=({canExplore:e,closeModal:t,exploreChart:n})=>{const a=(0,i.DP)();return(0,f.FD)(f.FK,{children:[(0,f.Y)(d.A,{buttonStyle:"secondary",buttonSize:"small",onClick:n,disabled:!e,tooltip:e?void 0:(0,o.t)("You do not have sufficient permissions to edit the chart"),children:(0,o.t)("Edit chart")}),(0,f.Y)(d.A,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drilltodetail-modal",css:s.AH`
          margin-left: ${2*a.gridUnit}px;
        `,children:(0,o.t)("Close")})]})};function B({chartId:e,formData:t,initialFilters:n,showModal:d,onHideModal:p}){const m=(0,i.DP)(),g=(0,r.W6)(),v=(0,a.useContext)(u.DashboardPageIdContext),{slice_name:b}=(0,c.d4)((t=>{var n,a;return(null==(n=t.sliceEntities)||null==(a=n.slices)?void 0:a[e])||{}})),y=(0,c.d4)((e=>{var t;return(0,h.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),x=(0,a.useMemo)((()=>`/explore/?dashboard_page_id=${v}&slice_id=${e}`),[e,v]),C=(0,a.useCallback)((()=>{g.push(x)}),[x,g]);return(0,f.Y)(l.Ay,{show:d,onHide:null!=p?p:()=>null,css:s.AH`
        .antd5-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,title:(0,o.t)("Drill to detail: %s",b),footer:(0,f.Y)(V,{exploreChart:C,canExplore:y}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*m.gridUnit,minWidth:128*m.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1,children:(0,f.Y)(W,{formData:t,initialFilters:n})})}},32291:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(5556),r=n.n(a);const i=r().shape({metric_name:r().string,verbose_name:r().string,expression:r().string})},35233:(e,t,n)=>{n.d(t,{e:()=>i,w:()=>o});var a=n(35742),r=n(43859);const i=new Map,o=(0,r.K)(a.A.get,i,(({endpoint:e})=>e||""))},39091:(e,t,n)=>{n.d(t,{$r:()=>E,TN:()=>T,XS:()=>R,ZY:()=>F,i8:()=>w});var a=n(17437),r=n(38221),i=n.n(r),o=n(96540),s=n(96453),l=n(78518),d=n(7349),c=n(85170),u=n(87903),h=n(58642),p=n(90868),m=n(27023),g=n(78697),v=n(67073),b=n(46920),f=n(64535),y=n(15151),x=n(19966),C=n(86832),S=n(2445);const A=(0,s.I4)("span")`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,w=(0,s.I4)(b.A)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${({theme:e})=>2*e.gridUnit}px;
  }

  i {
    padding: 0 ${({theme:e})=>e.gridUnit}px;
  }
`,T=({data:e,columns:t})=>(0,S.Y)(x.A,{text:e&&t?(0,y.L)(e,t):"",wrapped:!1,copyNode:(0,S.Y)(v.F.CopyOutlined,{iconSize:"l","aria-label":(0,l.t)("Copy"),role:"button",css:a.AH`
          &.anticon > * {
            line-height: 0;
          }
        `})}),F=({onChangeHandler:e,shouldFocus:t=!1})=>{const n=(0,o.useRef)(null);(0,o.useEffect)((()=>{n.current&&t&&n.current.focus()}),[]);const r=(0,s.DP)(),d=i()(e,m.Qs);return(0,S.Y)(p.pd,{prefix:(0,S.Y)(v.F.SearchOutlined,{iconSize:"l"}),placeholder:(0,l.t)("Search"),onChange:e=>{const t=e.target.value;d(t)},css:a.AH`
        width: 200px;
        margin-right: ${2*r.gridUnit}px;
      `,ref:n})};var D;!function(e){e.Formatted="formatted",e.Original="original"}(D||(D={}));const _=({onChange:e,value:t})=>(0,S.Y)(g.s.GroupWrapper,{spaceConfig:{direction:"vertical",align:"start",size:15,wrap:!1},size:"large",value:t,onChange:e,options:[{label:(0,l.t)("Formatted date"),value:D.Formatted},{label:(0,l.t)("Original value"),value:D.Original}]}),Y=s.I4.div`
  display: flex;
  flex-direction: column;

  padding: ${({theme:e})=>4*e.gridUnit+"px"};
`,$=s.I4.span`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
`,I=({columnName:e,onTimeColumnChange:t,datasourceId:n,isOriginalTimeColumn:r})=>{const i=(0,s.DP)(),d=n=>{t(e,n.target.value)},c=(0,o.useMemo)((()=>n?(0,S.FD)(Y,{onClick:e=>e.stopPropagation(),children:[(0,S.Y)($,{children:(0,l.t)("Column Formatting")}),(0,S.Y)(_,{onChange:d,value:r?D.Original:D.Formatted})]}):null),[n,r]);return n?(0,S.FD)("span",{children:[(0,S.Y)(f.A,{trigger:"click",content:c,placement:"bottomLeft",arrow:{pointAtCenter:!0},children:(0,S.Y)(v.F.SettingOutlined,{iconSize:"m",iconColor:i.colors.grayscale.light1,css:(0,a.AH)({marginRight:`${i.gridUnit}px`},"",""),onClick:e=>e.stopPropagation()})}),e]}):(0,S.Y)("span",{children:e})},E=(e,t)=>{const n=(0,o.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,l.t)("N/A"))))))?e:[]}),[t]);return(0,o.useMemo)((()=>null!=t&&t.length?t.filter(((t,a)=>n[a].some((t=>null==t?void 0:t.includes(e.toLowerCase()))))):[]),[t,e,n])},M=(0,d.mo)(c.A.DATABASE_DATETIME),R=(e,t,n,a,r,i,s)=>{const[l,d]=(0,o.useState)((0,C.p)(a)),c=(e,t)=>{if(a)if(t!==D.Original||l.includes(e)){if(t===D.Formatted&&l.includes(e)){const t=(0,C.p)(a);t.splice(t.indexOf(e),1),(0,C.J)(a,t),d(t)}}else{const t=(0,C.p)(a);t.push(e),(0,C.J)(a,t),d(t)}};return(0,o.useEffect)((()=>{r&&d((0,C.p)(a))}),[a,r]),(0,o.useMemo)((()=>e&&null!=n&&n.length?e.filter((e=>Object.keys(n[0]).includes(e))).map(((e,r)=>{const o=null==t?void 0:t[r],d=n[0][e],p=o===u.s.Temporal?l.indexOf(e):-1,g=l.includes(e);return{id:e||r,accessor:t=>t[e],Header:o===u.s.Temporal&&"string"!=typeof d?(0,S.Y)(I,{columnName:e,datasourceId:a,onTimeColumnChange:c,isOriginalTimeColumn:g}):e,Cell:({value:e})=>!0===e?m.bU:!1===e?m.y2:null===e?(0,S.Y)(A,{children:m.bV}):o===u.s.Temporal&&-1===p&&"number"==typeof e?M(e):"string"==typeof e&&s?(0,h.nn)(e):String(e),...null==i?void 0:i[e]}})):[]),[e,n,t,a,i,l])}},40104:(e,t,n)=>{n.d(t,{Kg:()=>g,J8:()=>p,Pz:()=>v,tg:()=>u,pY:()=>h,px:()=>m});var a=n(96627),r=n(58863),i=n(78518),o=n(88488);const s=e=>null!=e&&"function"==typeof e[Symbol.iterator];var l=n(49588),d=n(38708);const c=()=>{var e,t;const n=(0,d.Ay)();return(null==n||null==(e=n.common)||null==(t=e.conf)?void 0:t.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},u=({datasetId:e,dependencies:t={},groupby:n,defaultDataMask:a,controlValues:r,filterType:i,sortMetric:s,adhoc_filters:l,time_range:d,granularity_sqla:u,type:h,dashboardId:p,id:m})=>{var g;const v={};return e&&(v.datasource=`${e}__table`),n&&(v.groupby=[n]),s&&(v.sortMetric=s),{...r,...v,adhoc_filters:null!=l?l:[],extra_filters:[],extra_form_data:t,granularity_sqla:u,metrics:["count"],row_limit:c(),showSearch:!0,defaultValue:null==a||null==(g=a.filterState)?void 0:g.value,time_range:d,url_params:(0,o.A)("regular"),inView:!0,viz_type:i,type:h,dashboardId:p,native_filter_id:m}};function h(e={},t={}){const n={};return a.t1.forEach((a=>{const r=e[a],i=t[a],o=[...s(r)?r:[],...s(i)?i:[]];o.length&&(n[a]=o)})),a.zk.forEach((a=>{const r=e[a];void 0!==r&&(n[a]=r);const i=t[a];void 0!==i&&(n[a]=i)})),n}function p(e,t){let n={};return t.forEach((t=>{var a,r;n=h(n,null!=(a=null==(r=e[t])?void 0:r.extraFormData)?a:{})})),n}function m(e){return!e.includes(r.nS.NativeFilter)||e.includes(r.nS.InteractiveChart)}const g=(e,t)=>new Set(t.map((t=>{var n,a;return null==(n=e.find((e=>{var n;return(null==e||null==(n=e.meta)?void 0:n.chartId)===t})))||null==(a=n.parents)?void 0:a.filter((e=>e.startsWith(`${l.B8}-`)))})).filter((e=>void 0!==e)).flat()),v=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,i.t)("Unknown value")},48422:(e,t,n)=>{n.d(t,{w:()=>o});var a=n(96540),r=n(43561);const i=new BroadcastChannel("tab_id_channel");function o(){const[e,t]=(0,a.useState)();return(0,a.useEffect)((()=>{if(!function(){try{return window.localStorage&&window.sessionStorage}catch(e){return!1}}())return void(e||t((0,r.Ak)()));const n=()=>{let e;try{e=window.localStorage.getItem("last_tab_id")}catch(e){}const n=String(e?Number.parseInt(e,10)+1:1);try{window.sessionStorage.setItem("tab_id",n),window.localStorage.setItem("last_tab_id",n)}catch(e){}t(n)};let a;try{a=window.sessionStorage.getItem("tab_id")}catch(e){}a?(i.postMessage({type:"REQUESTING_TAB_ID",tabId:a}),t(a)):n(),i.onmessage=t=>{if(t.data.tabId===e)if("REQUESTING_TAB_ID"===t.data.type){const e={type:"TAB_ID_DENIED",tabId:t.data.tabId};i.postMessage(e)}else"TAB_ID_DENIED"===t.data.type&&n()}}),[e]),e}},50068:(e,t,n)=>{n.d(t,{Dj:()=>s.Dj,cp:()=>s.cp,Ay:()=>o});var a=n(96453),r=n(2445);const i=a.I4.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function o({checked:e=!1,onChange:t,style:n,className:a}){return(0,r.Y)(i,{style:n,onClick:()=>{t(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox",className:a||"",children:e?(0,r.Y)(s.Dj,{}):(0,r.Y)(s.cp,{})})}var s=n(75264)},53860:(e,t,n)=>{n.d(t,{S:()=>i});var a=n(61225),r=n(84666);const i=()=>{const e=(0,a.d4)((e=>{var t;return(0,r.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),t=(0,a.d4)((e=>{var t;return(0,r.L)("can_write","ExploreFormDataRestApi",null==(t=e.user)?void 0:t.roles)})),n=(0,a.d4)((e=>{var t;return(0,r.L)("can_samples","Datasource",null==(t=e.user)?void 0:t.roles)})),i=(0,a.d4)((e=>{var t;return(0,r.L)("can_csv","Superset",null==(t=e.user)?void 0:t.roles)})),o=(0,a.d4)((e=>{var t;return(0,r.L)("can_drill","Dashboard",null==(t=e.user)?void 0:t.roles)}));return{canExplore:e,canWriteExploreFormData:t,canDatasourceSamples:n,canDownload:i,canDrill:o,canDrillBy:(e||o)&&t,canDrillToDetail:(e||o)&&n,canViewQuery:(0,a.d4)((e=>{var t;return(0,r.L)("can_view_query","Dashboard",null==(t=e.user)?void 0:t.roles)})),canViewTable:(0,a.d4)((e=>{var t;return(0,r.L)("can_view_chart_as_table","Dashboard",null==(t=e.user)?void 0:t.roles)}))}}},55976:(e,t,n)=>{n.d(t,{M:()=>p});var a=n(96540),r=n(96453),i=n(78518),o=n(17437),s=n(25946),l=n(14693),d=n(70175),c=n(86274),u=n(35233),h=n(2445);const p=({dataset:e,datasetId:t})=>{const n=(0,r.DP)(),[p,m]=(0,a.useState)(),[g,v]=(0,a.useState)(e?c.bk.Complete:c.bk.Loading);return(0,a.useEffect)((()=>{!e&&t&&(0,u.w)({endpoint:`/api/v1/dataset/${t}`}).then((({json:{result:e}})=>{m(e),v(c.bk.Complete)})).catch((()=>{v(c.bk.Error)}))}),[t,e]),{metadataBar:(0,a.useMemo)((()=>{const t=[],a=e||p;if(a){var r,u;const{changed_on_humanized:e,created_on_humanized:n,description:o,table_name:s,changed_by:l,created_by:c,owners:h}=a,p=(0,i.t)("Not available"),m=`${null!=(r=null==c?void 0:c.first_name)?r:""} ${null!=(u=null==c?void 0:c.last_name)?u:""}`.trim()||p,g=l?`${l.first_name} ${l.last_name}`:p,v=(null==h?void 0:h.length)>0?h.map((e=>`${e.first_name} ${e.last_name}`)):[p];t.push({type:d.Q.Table,title:s}),t.push({type:d.Q.LastModified,value:e,modifiedBy:g}),t.push({type:d.Q.Owner,createdBy:m,owners:v,createdOn:n}),o&&t.push({type:d.Q.Description,value:o})}return(0,h.FD)("div",{css:o.AH`
          display: flex;
          margin-bottom: ${4*n.gridUnit}px;
        `,children:[g===c.bk.Complete&&(0,h.Y)(l.Ay,{items:t,tooltipPlacement:"bottom"}),g===c.bk.Error&&(0,h.Y)(s.A,{type:"error",message:(0,i.t)("There was an error loading the dataset metadata")})]})}),[e,p,g,n.gridUnit]),status:g}}},59638:(e,t,n)=>{n.d(t,{w:()=>m,K:()=>l});var a=n(96540),r=n(96627),i=n(77189),o=n(95483),s=n(2511);const l=e=>{const[t,n]=(0,a.useState)({});return(0,a.useEffect)((()=>{e.operator===o.ux.TemporalRange&&e.expressionType===s.A.Simple||n({}),e.operator===o.ux.TemporalRange&&e.comparator===r.WC&&n({actualTimeRange:`${e.subject} (${r.WC})`,title:r.WC}),e.operator===o.ux.TemporalRange&&e.expressionType===s.A.Simple&&e.comparator!==r.WC&&t.title!==e.comparator&&(0,i.x9)(e.comparator,e.subject).then((({value:t,error:a})=>{n(a?{actualTimeRange:`${e.subject} (${e.comparator})`,title:a}:{actualTimeRange:null!=t?t:"",title:e.comparator})}))}),[e]),t};var d=n(78518),c=n(67984),u=n(45267),h=n(50317),p=n(2445);const m=({columnName:e,timeRange:t,datasource:n,onChange:a})=>(0,c.D)(e,n)?(0,p.FD)(p.FK,{children:[(0,p.Y)(h.A,{label:(0,d.t)("Time Range")}),(0,p.Y)(u.A,{value:t,name:"time_range",onChange:t=>a(e,t),overlayStyle:"Modal"})]}):void 0},59838:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(70700),r=n(2511),i=n(95483),o=n(71191);const s=(e,t=r.v.Where)=>{let n;var s;return n=(0,a.q0)(e.col)?{expressionType:"SQL",clause:t,sqlExpression:(0,o.e)({expressionType:r.A.Simple,subject:`(${e.col.sqlExpression})`,operator:e.op,comparator:"val"in e?e.val:void 0})}:{expressionType:"SIMPLE",clause:t,operator:e.op,operatorId:null==(s=Object.entries(i.nS).find((t=>t[1].operation===e.op)))?void 0:s[0],subject:e.col,comparator:"val"in e?e.val:void 0},e.isExtra&&Object.assign(n,{isExtra:!0,filterOptionName:`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}),n}},60237:(e,t,n)=>{n.d(t,{T3:()=>c,cL:()=>u,kV:()=>s});var a=n(90179),r=n.n(a),i=n(35742);const o=["url_params"],s=e=>r()(e,o),l=(e,t)=>{let n="api/v1/explore/form_data";return e&&(n=n.concat(`/${e}`)),t&&(n=n.concat(`?tab_id=${t}`)),n},d=(e,t,n,a)=>{const r={datasource_id:e,datasource_type:t,form_data:JSON.stringify(s(n))};return a&&(r.chart_id=a),r},c=(e,t,n,a,r)=>i.A.post({endpoint:l(void 0,r),jsonPayload:d(e,t,n,a)}).then((e=>e.json.key)),u=(e,t,n,a,r,o)=>i.A.put({endpoint:l(n,o),jsonPayload:d(e,t,a,r)}).then((e=>e.json.message))},67429:(e,t,n)=>{n.d(t,{C:()=>s});var a=n(17437),r=n(67073),i=n(19129),o=n(2445);const s=({title:e,color:t})=>(0,o.Y)(i.m_,{title:e,placement:"top",children:(0,o.Y)(r.F.InfoCircleOutlined,{"data-test":"tooltip-trigger",css:e=>a.AH`
        color: ${t||e.colors.text.label};
        margin-left: ${2*e.gridUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `})})},70175:(e,t,n)=>{var a;n.d(t,{Q:()=>a}),function(e){e.Dashboards="dashboards",e.Description="description",e.LastModified="lastModified",e.Owner="owner",e.Rows="rows",e.Sql="sql",e.Table="table",e.Tags="tags"}(a||(a={}))},70542:(e,t,n)=>{n.d(t,{k:()=>w});var a=n(62193),r=n.n(a),i=n(96540),o=n(78518),s=n(17437),l=n(58642),d=n(96453),c=n(80145),u=n(58863),h=n(46302),p=n(61225),m=n(6749),g=n(83537),v=n(67429),b=n(28543),f=n(2445);const y=(0,o.t)("Drill to detail"),x=(0,o.t)("Drill to detail by"),C={DATABASE:(0,o.t)("Drill to detail is disabled for this database. Change the database settings to enable it."),NO_AGGREGATIONS:(0,o.t)("Drill to detail is disabled because this chart does not group data by dimension value."),NO_FILTERS:(0,o.t)("Right-click on a dimension value to drill to detail by that value."),NOT_SUPPORTED:(0,o.t)("Drill to detail by value is not yet supported for this chart type.")},S=({children:e,menuKey:t,...n})=>(0,f.Y)(m.W1.Item,{disabled:!0,...n,children:(0,f.Y)("div",{css:s.AH`
        white-space: normal;
        max-width: 160px;
      `,children:e})},t),A=(0,d.I4)((({children:e,stripHTML:t=!1})=>{const n=t&&"string"==typeof e?(0,l.zF)(e):e;return(0,f.Y)("span",{children:n})}))`
  ${({theme:e})=>`\n     font-weight: ${e.typography.weights.bold};\n     color: ${e.colors.primary.base};\n   `}
`,w=({formData:e,filters:t=[],isContextMenu:n=!1,contextMenuY:a=0,onSelection:s=()=>null,onClick:l=()=>null,submenuIndex:d=0,setFilters:w,setShowModal:T,key:F,...D})=>{const _=(0,p.d4)((({datasources:t})=>{var n,a;return null==(n=t[e.datasource])||null==(a=n.database)?void 0:a.disable_drill_to_detail})),Y=(0,i.useCallback)(((e,t)=>{l(t),s(),w(e),T(!0)}),[l,s]),$=(0,i.useMemo)((()=>{var t;return null==(t=(0,c.A)().get(e.viz_type))?void 0:t.behaviors.find((e=>e===u.nS.DrillToDetail))}),[e.viz_type]),I=(0,i.useMemo)((()=>{const{metrics:t}=(0,h.A)(e);return r()(t)}),[e]),E=(0,i.useMemo)((()=>(0,g.Gs)(a,t.length>1?t.length+1:t.length,d)),[a,t.length,d]);let M,R;_?(M=C.DATABASE,R=C.DATABASE):$?I?(M=C.NO_AGGREGATIONS,R=C.NO_AGGREGATIONS):null!=t&&t.length||(R=C.NO_FILTERS):R=C.NOT_SUPPORTED;const k=M?(0,f.FD)(S,{menuKey:"drill-to-detail-disabled",...D,children:[y,(0,f.Y)(v.C,{title:M})]}):(0,f.Y)(m.W1.Item,{onClick:Y.bind(null,[]),children:y},"drill-to-detail"),O=R?(0,f.FD)(S,{menuKey:"drill-to-detail-by-disabled",...D,children:[x,(0,f.Y)(v.C,{title:R})]}):(0,f.Y)(m.W1.SubMenu,{popupOffset:[0,E],popupClassName:"chart-context-submenu",title:x,...D,children:(0,f.FD)("div",{"data-test":"drill-to-detail-by-submenu",children:[t.map(((e,t)=>(0,f.FD)(b.oY,{tooltipText:`${x} ${e.formattedVal}`,menuKey:`drill-detail-filter-${t}`,onClick:Y.bind(null,[e]),children:[`${x} `,(0,f.Y)(A,{stripHTML:!0,children:e.formattedVal})]}))),t.length>1&&(0,f.Y)(m.W1.Item,{onClick:Y.bind(null,t),children:(0,f.FD)("div",{children:[`${x} `,(0,f.Y)(A,{stripHTML:!1,children:(0,o.t)("all")})]})},"drill-detail-filter-all")]})},F);return(0,f.FD)(f.FK,{children:[k,n&&O]})}},71085:(e,t,n)=>{n.d(t,{A:()=>$,v:()=>_});var a=n(62193),r=n.n(a),i=n(96540),o=n(61225),s=n(72391),l=n(17437),d=n(96453),c=n(27366),u=n(83505),h=n(78518),p=n(67073),m=n(75488),g=n(6749),v=n(50068),b=n(15151),f=n(93491),y=n(50500),x=n(15700),C=n(2445);const S=(0,s.a)(),A=e=>l.AH`
  color: ${e.colors.error.base};
`,w=e=>l.AH`
  & .antd5-menu-item {
    padding: 5px 12px;
    margin-top: 0px;
    margin-bottom: 4px;
    :hover {
      color: ${e.colors.grayscale.dark1};
    }
  }
  :hover {
    background-color: ${e.colors.secondary.light5};
  }
`,T=e=>l.AH`
  &:hover {
    color: ${e.colors.grayscale.dark1};
    background-color: ${e.colors.secondary.light5};
  }
`,F=d.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,D=S.get("report-modal.dropdown.item.icon");var _;!function(e){e.Charts="charts",e.Dashboards="dashboards"}(_||(_={}));const Y={};function $({dashboardId:e,chart:t,useTextMenu:n=!1,setShowReportSubMenu:a,submenuTitle:s,showReportModal:d,setCurrentReportDeleting:S}){const $=(0,o.wA)(),I=(0,o.d4)((n=>{const a=e?_.Dashboards:_.Charts;return(0,y.oi)(n,a,e||(null==t?void 0:t.id))||Y})),E=(null==I?void 0:I.active)||!1,M=(0,o.d4)((e=>e.user)),R=()=>!!(0,c.G7)(c.TO.AlertReports)&&(!(null==M||!M.userId)&&(!!(e||null!=t&&t.id)&&Object.keys(M.roles||[]).map((e=>M.roles[e].filter((e=>"menu_access"===e[0]&&"Manage"===e[1])))).some((e=>e.length>0)))),k=(0,u.Z)(e),O=async(e,t)=>{null!=e&&e.id&&$((0,f.PM)(e,t))},N=R()&&!!(e&&k!==e||null!=t&&t.id);(0,i.useEffect)((()=>{N&&$((0,f.LQ)({userId:M.userId,filterField:e?"dashboard_id":"chart_id",creationMethod:e?"dashboards":"charts",resourceId:e||(null==t?void 0:t.id)}))}),[]);const U=I&&a&&R();(0,i.useEffect)((()=>{U?a(!0):!I&&a&&a(!1)}),[I]);const q=()=>{d()};return(0,C.Y)(C.FK,{children:R()&&(n?r()(I)?(0,C.FD)(g.W1.SubMenu,{title:s,css:w,children:[(0,C.Y)(g.W1.Item,{onClick:q,children:D?(0,C.FD)(F,{children:[(0,C.Y)("div",{children:(0,h.t)("Set up an email report")}),(0,C.Y)(D,{})]}):(0,h.t)("Set up an email report")}),(0,C.Y)(g.W1.Divider,{})]}):(0,C.FD)(g.W1.SubMenu,{title:s,css:l.AH`
          border: none;
        `,children:[(0,C.Y)(g.W1.Item,{css:T,onClick:()=>O(I,!E),children:(0,C.FD)(x.t3,{children:[(0,C.Y)(v.Ay,{checked:E,onChange:b.fZ}),(0,h.t)("Email reports active")]})}),(0,C.Y)(g.W1.Item,{css:T,onClick:q,children:(0,h.t)("Edit email report")}),(0,C.Y)(g.W1.Item,{css:T,onClick:()=>{S(I)},children:(0,h.t)("Delete email report")})]}):r()(I)?(0,C.Y)("span",{role:"button",title:(0,h.t)("Schedule email report"),tabIndex:0,className:"action-button action-schedule-report",onClick:()=>d(),children:(0,C.Y)(p.F.CalendarOutlined,{})}):(L=(0,C.Y)(p.F.CalendarOutlined,{}),(0,C.FD)(g.W1.SubMenu,{title:L,css:l.AH`
        width: 200px;
      `,children:[(0,C.FD)(g.W1.Item,{children:[(0,h.t)("Email reports active"),(0,C.Y)(m.d,{"data-test":"toggle-active",checked:E,onClick:e=>O(I,e),size:"small",css:e=>l.AH`
            margin-left: ${2*e.gridUnit}px;
          `})]}),(0,C.Y)(g.W1.Item,{onClick:()=>d(),children:(0,h.t)("Edit email report")}),(0,C.Y)(g.W1.Item,{onClick:()=>S(I),css:A,children:(0,h.t)("Delete email report")})]})))});var L}},71191:(e,t,n)=>{n.d(t,{e:()=>s});var a=n(808),r=n(95483),i=n(85183);const o={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},s=(e,{useSimple:t}={useSimple:!1})=>{if((0,a.md)(e)||t){const{subject:t,operator:n}=e,a="comparator"in e?e.comparator:void 0,s=n&&n===r.nS[r.ux.LatestPartition].operation?o[n](e):o[n];return(0,i.zJ)(t,s,a)}return(0,a.wF)(e)?e.sqlExpression:""}},72652:(e,t,n)=>{n.d(t,{B3:()=>C,Bt:()=>f,Gh:()=>y,JG:()=>T,JU:()=>v,Px:()=>D,XB:()=>F,a2:()=>g,f$:()=>w,p6:()=>S,yJ:()=>m});var a=n(96540),r=n(26206),i=n(30535),o=n(96453),s=n(17437),l=n(78518),d=n(66537),c=n(19129),u=n(67073),h=n(84080),p=n(2445);const m=o.I4.div`
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,g=o.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  height: ${({theme:e})=>6*e.gridUnit}px;
  background-color: ${({theme:e})=>e.colors.grayscale.light3};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
`,v=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.gridUnit}px;\n    svg {\n      margin-right: ${e.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.gridUnit}px;\n      margin-left: ${e.gridUnit}px;\n      font-weight: ${e.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,b=o.I4.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,f=o.I4.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  margin-left: auto;
`,y=o.I4.div`
  height: auto;
  width: ${({theme:e})=>6*e.gridUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  cursor: pointer;
`,x=(0,o.I4)(d.W)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`,C=o.I4.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,S=o.I4.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: solid 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,A=s.i7`
  0% {
    right: 100%;
  }
  50% {
    left: 4px;
  }
  90% {
    right: 4px;
  }
  100% {
    left: 100%;
  }
`,w=o.I4.div`
  ${({theme:e,isLoading:t,canDrop:n,isDragging:a,isOver:r})=>`\n  position: relative;\n  padding: ${e.gridUnit}px;\n  border: ${!t&&a?`dashed 1px ${n?e.colors.info.dark1:e.colors.error.dark1}`:`solid 1px ${t&&a?e.colors.warning.light1:e.colors.grayscale.light2}`};\n  border-radius: ${e.gridUnit}px;\n  &:before,\n  &:after {\n    content: ' ';\n    position: absolute;\n    border-radius: ${e.gridUnit}px;\n  }\n  &:before {\n    display: ${a||t?"block":"none"};\n    background-color: ${n?e.colors.primary.base:e.colors.error.light1};\n    z-index: ${e.zIndex.aboveDashboardCharts};\n    opacity: ${e.opacity.light};\n    top: 1px;\n    right: 1px;\n    bottom: 1px;\n    left: 1px;\n  }\n  &:after {\n    display: ${t||n&&r?"block":"none"};\n    background-color: ${t?e.colors.grayscale.light3:e.colors.primary.base};\n    z-index: ${e.zIndex.dropdown};\n    opacity: ${e.opacity.mediumLight};\n    top: ${-e.gridUnit}px;\n    right: ${-e.gridUnit}px;\n    bottom: ${-e.gridUnit}px;\n    left: ${-e.gridUnit}px;\n    cursor: ${t?"wait":"auto"};\n  }\n  `}

  &:before {
    ${({theme:e,isLoading:t})=>t&&s.AH`
        animation: ${A} 2s ease-in infinite;
        background: linear-gradient(currentColor 0 0) 0 100%/0% 3px no-repeat;
        background-size: 100% ${e.gridUnit/2}px;
        top: auto;
        right: ${e.gridUnit}px;
        left: ${e.gridUnit}px;
        bottom: -${e.gridUnit/2}px;
        height: ${e.gridUnit/2}px;
      `};
  }
`,T=o.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
  border: dashed 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light4};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light3};
  }
`,F=o.I4.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.gridUnit}px;
  width: ${({theme:e})=>4*e.gridUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colors.primary.dark1};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,D=({label:e,savedMetric:t,adhocMetric:n,onRemove:d,onMoveLabel:C,onDropLabel:S,withCaret:A,isFunction:w,type:T,index:F,isExtra:D,datasourceWarningMessage:_,tooltipTitle:Y,multi:$=!0,...I})=>{const E=(0,o.DP)(),M=(0,a.useRef)(null),R=(0,a.useRef)(null),k=null==t?void 0:t.metric_name,[,O]=(0,r.H)({accept:T,drop(){$&&(null==S||S())},hover(e,t){var n;if(!$)return;if(!M.current)return;const{dragIndex:a}=e,r=F;if(a===r)return;const i=null==(n=M.current)?void 0:n.getBoundingClientRect(),o=(i.bottom-i.top)/2,s=t.getClientOffset(),l=null!=s&&s.y?(null==s?void 0:s.y)-i.top:0;a<r&&l<o||a>r&&l>o||(null==C||C(a,r),e.dragIndex=r)}}),[{isDragging:N},U]=(0,i.i)({item:{type:T,dragIndex:F,value:null!=t&&t.metric_name?t:n},collect:e=>({isDragging:e.isDragging()})});return U(O(M)),(0,p.Y)(m,{ref:M,children:(0,p.FD)(g,{withCaret:A,"data-test":"option-label",...I,css:s.AH`
        text-align: center;
      `,children:[(0,p.Y)(y,{role:"button","data-test":"remove-control-button",onClick:d,children:(0,p.Y)(u.F.CloseOutlined,{iconSize:"m",iconColor:E.colors.grayscale.light1,css:s.AH`
            vertical-align: sub;
          `})}),(0,p.FD)(v,{"data-test":"control-label",children:[w&&(0,p.Y)(u.F.FunctionOutlined,{iconSize:"m"}),(()=>{const n=!N&&"string"==typeof e&&Y&&e&&Y!==e||!N&&R&&R.current&&R.current.scrollWidth>R.current.clientWidth;return t&&k?(0,p.Y)(h.b,{metric:t,labelRef:R,shouldShowTooltip:!N}):n?(0,p.Y)(c.m_,{title:Y||e,children:(0,p.Y)(b,{ref:R,children:e})}):(0,p.Y)(b,{ref:R,children:e})})()]}),(!!_||D)&&(0,p.Y)(x,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:_||(0,l.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),A&&(0,p.Y)(f,{children:(0,p.Y)(u.F.RightOutlined,{iconSize:"m",css:s.AH`
              margin-top: ${E.gridUnit}px;
            `,iconColor:E.colors.grayscale.light1})})]})})}},72965:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(20249),r=n.n(a),i=n(67390),o=n.n(i),s=n(78518),l=n(96453),d=n(95272);const c=(e,t=new Date)=>`${r()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`;function u(e,t,n=!1){return a=>{const r=n?document.querySelector(e):a.currentTarget.closest(e);return r?o().toJpeg(r,{bgcolor:l.TT.colors.grayscale.light4,filter:e=>"string"!=typeof e.className||"mapboxgl-control-container"!==e.className&&!e.className.includes("header-controls")}).then((e=>{const n=document.createElement("a");n.download=`${c(t)}.jpg`,n.href=e,n.click()})).catch((e=>{console.error("Creating image failed",e)})):(0,d.Zd)((0,s.t)("Image download failed, please refresh and try again."))}}},74792:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(5556),r=n.n(a);const i=r().shape({column_name:r().string.isRequired,type:r().string})},76295:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(2404),r=n.n(a),i=n(40104),o=n(35839);function s(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}var l=n(92008);const d={},c={};function u({chart:e,filters:t,nativeFilters:n,chartConfiguration:a,colorScheme:u,ownColorScheme:h,colorNamespace:p,sliceId:m,dataMask:g,extraControls:v,labelsColor:b,labelsColorMap:f,sharedLabelsColors:y,allSliceIds:x}){const C=c[m];if(d[m]===t&&(0,o.r$)(null==C?void 0:C.own_color_scheme,h)&&(0,o.r$)(null==C?void 0:C.color_scheme,u)&&(0,o.r$)(null==C?void 0:C.color_namespace,p,{ignoreUndefined:!0})&&(0,o.r$)(null==C?void 0:C.label_colors,b,{ignoreUndefined:!0})&&(0,o.r$)(null==C?void 0:C.map_label_colors,f,{ignoreUndefined:!0})&&r()(null==C?void 0:C.shared_label_colors,y)&&C&&(0,o.r$)(null==C?void 0:C.dataMask,g,{ignoreUndefined:!0})&&(0,o.r$)(null==C?void 0:C.extraControls,v,{ignoreUndefined:!0}))return C;let S={};const A=(0,l.R)({chartConfiguration:a,dataMask:g,nativeFilters:n,allSliceIds:x}),w=Object.entries(A).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));w.length&&(S={extra_form_data:(0,i.J8)(g,w)});const T={...e.form_data,chart_id:e.id,label_colors:b,shared_label_colors:y,map_label_colors:f,...u&&{color_scheme:u},...h&&{own_color_scheme:h},extra_filters:s(t),...S,...v};return d[m]=t,c[m]={...T,dataMask:g,extraControls:v},T}},80493:(e,t,n)=>{n.d(t,{x:()=>g,y:()=>m});var a=n(65611),r=n.n(a),i=n(96540),o=n(96453),s=n(87903),l=n(17437),d=n(39091),c=n(15151),u=n(86832),h=n(26761),p=n(2445);const m=o.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${2*e.gridUnit}px;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}
`,g=({data:e,datasourceId:t,onInputChange:n,columnNames:a,columnTypes:o,rowcount:g,isLoading:v,canDownload:b})=>{const f=(0,u.p)(t),y=r()(a,o).filter((([e,t])=>t===s.s.Temporal&&e&&!f.includes(e))).map((([e])=>e)),x=(0,i.useMemo)((()=>(0,c.bE)(e,y)),[e,y]);return(0,p.FD)(m,{children:[(0,p.Y)(d.ZY,{onChangeHandler:n,shouldFocus:!0}),(0,p.FD)("div",{css:l.AH`
          display: flex;
          align-items: center;
        `,children:[(0,p.Y)(h.A,{rowcount:g,loading:v}),b&&(0,p.Y)(d.TN,{data:x,columns:a})]})]})}},81410:(e,t,n)=>{n.d(t,{A:()=>z});var a,r,i=n(96540),o=n(93641),s=n(78518),l=n(51436),d=n(61225),c=n(93491),u=n(25946),h=n(17466),p=n(97987),m=n(67073),g=n(78697),v=n(90868),b=n(5261);!function(e){e.Dashboards="dashboards",e.Charts="charts"}(a||(a={})),function(e){e.Text="TEXT",e.PNG="PNG",e.CSV="CSV"}(r||(r={}));var f=n(50500),y=n(43658),x=n(71085),C=n(96453),S=n(17437),A=n(85861),w=n(46920),T=n(51647);const F=(0,C.I4)(A.Ay)`
  .antd5-modal-body {
    padding: 0;
  }
`,D=C.I4.div`
  padding: ${({theme:e})=>`${3*e.gridUnit}px ${4*e.gridUnit}px ${2*e.gridUnit}px`};
  label {
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,_=C.I4.div`
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  padding: ${({theme:e})=>`${4*e.gridUnit}px ${4*e.gridUnit}px ${6*e.gridUnit}px`};
  .ant-select {
    width: 100%;
  }
  .control-label {
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,Y=C.I4.span`
  span {
    margin-right: ${({theme:e})=>2*e.gridUnit}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
`,$=C.I4.div`
  margin-bottom: ${({theme:e})=>7*e.gridUnit}px;

  h4 {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }
`,I=(0,C.I4)(T.l5)`
  margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  width: ${({theme:e})=>120*e.gridUnit}px;
`,E=C.I4.p`
  color: ${({theme:e})=>e.colors.error.base};
`,M=S.AH`
  margin-bottom: 0;
`,R=(0,C.I4)(w.A)`
  width: ${({theme:e})=>40*e.gridUnit}px;
`,k=e=>S.AH`
  margin: ${3*e.gridUnit}px 0 ${2*e.gridUnit}px;
`,O=C.I4.div`
  margin: ${({theme:e})=>8*e.gridUnit}px 0
    ${({theme:e})=>4*e.gridUnit}px;
`;(0,C.I4)(g.s)`
  display: block;
  line-height: ${({theme:e})=>8*e.gridUnit}px;
`;var N=n(2445);const U=[o.Y.PivotTable,"table",o.Y.PairedTTest],q={crontab:"0 12 * * 1"},L={},z=(0,b.Ay)((function({onHide:e,show:t=!1,dashboardId:n,chart:a,userId:o,userEmail:b,ccEmail:C,bccEmail:A,creationMethod:w,dashboardName:T,chartName:z}){var H;const P=null==a||null==(H=a.sliceFormData)?void 0:H.viz_type,j=!!a,W=j&&P&&U.includes(P),V=W?r.Text:r.PNG,B=T||z,G=(0,i.useMemo)((()=>({...q,name:B?(0,s.t)("Weekly Report for %s",B):(0,s.t)("Weekly Report")})),[B]),Q=(0,i.useCallback)(((e,t)=>"reset"===t?G:{...e,...t}),[G]),[K,X]=(0,i.useReducer)(Q,G),[J,Z]=(0,i.useState)(),ee=(0,d.wA)(),te=(0,d.d4)((e=>{const t=n?x.v.Dashboards:x.v.Charts;return(0,f.oi)(e,t,n||(null==a?void 0:a.id))||L})),ne=te&&Object.keys(te).length;(0,i.useEffect)((()=>{X(ne?te:"reset")}),[ne,te]);const ae=(0,N.FD)(Y,{children:[(0,N.Y)(m.F.CalendarOutlined,{}),(0,N.Y)("span",{className:"text",children:ne?(0,s.t)("Edit email report"):(0,s.t)("Schedule a new email report")})]}),re=(0,N.FD)(N.FK,{children:[(0,N.Y)(R,{onClick:e,children:(0,s.t)("Cancel")},"back"),(0,N.Y)(R,{buttonStyle:"primary",onClick:async()=>{const t={type:"Report",active:!0,force_screenshot:!1,custom_width:K.custom_width,creation_method:w,dashboard:n,chart:null==a?void 0:a.id,owners:[o],recipients:[{recipient_config_json:{target:b,ccTarget:C,bccTarget:A},type:"Email"}],name:K.name,description:K.description,crontab:K.crontab,report_format:K.report_format||V,timezone:K.timezone};X({isSubmitting:!0,error:void 0});try{ne?await ee((0,c.Zp)(K.id,t)):await ee((0,c.ef)(t)),e()}catch(e){const{error:t}=await(0,l.h4)(e);X({error:t})}X({isSubmitting:!1})},disabled:!K.name,loading:K.isSubmitting,children:ne?(0,s.t)("Save"):(0,s.t)("Add")},"submit")]}),ie=(0,N.FD)(N.FK,{children:[(0,N.Y)(O,{children:(0,N.Y)("h4",{children:(0,s.t)("Message content")})}),(0,N.Y)("div",{className:"inline-container",children:(0,N.Y)(g.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:"middle",align:"start",wrap:!1},onChange:e=>{X({report_format:e.target.value})},value:K.report_format||V,options:[{label:(0,s.t)("Text embedded in email"),value:r.Text},{label:(0,s.t)("Image (PNG) embedded in email"),value:r.PNG},{label:(0,s.t)("Formatted CSV attached in email"),value:r.CSV}]})})]}),oe=(0,N.FD)(y.tu,{children:[(0,N.Y)("div",{className:"control-label",css:k,children:(0,s.t)("Screenshot width")}),(0,N.Y)("div",{className:"input-container",children:(0,N.Y)(v.pd,{type:"number",name:"custom_width",value:(null==K?void 0:K.custom_width)||"",placeholder:(0,s.t)("Input custom width in pixels"),onChange:e=>{X({custom_width:parseInt(e.target.value,10)||null})}})})]});return(0,N.FD)(F,{show:t,onHide:e,title:ae,footer:re,width:"432",centered:!0,children:[(0,N.FD)(D,{children:[(0,N.Y)(p.A,{id:"name",name:"name",value:K.name||"",placeholder:G.name,required:!0,validationMethods:{onChange:({target:e})=>X({name:e.value})},label:(0,s.t)("Report Name"),"data-test":"report-name-test"}),(0,N.Y)(p.A,{id:"description",name:"description",value:(null==K?void 0:K.description)||"",validationMethods:{onChange:({target:e})=>{X({description:e.value})}},label:(0,s.t)("Description"),placeholder:(0,s.t)("Include a description that will be sent with your report"),css:M,"data-test":"report-description-test"})]}),(0,N.FD)(_,{children:[(0,N.FD)($,{children:[(0,N.Y)("h4",{css:e=>(e=>S.AH`
  margin: ${3*e.gridUnit}px 0;
`)(e),children:(0,s.t)("Schedule")}),(0,N.Y)("p",{children:(0,s.t)("The report will be sent to your email at")})]}),(0,N.Y)(I,{clearButton:!1,value:K.crontab||"0 12 * * 1",setValue:e=>{X({crontab:e})},onError:Z}),(0,N.Y)(E,{children:J}),(0,N.Y)("div",{className:"control-label",css:e=>(e=>S.AH`
  margin: ${3*e.gridUnit}px 0 ${2*e.gridUnit}px;
`)(e),children:(0,s.t)("Timezone")}),(0,N.Y)(h.A,{timezone:K.timezone,onTimezoneChange:e=>{X({timezone:e})}}),j&&ie,(!j||!W)&&oe]}),K.error&&(0,N.Y)(u.A,{type:"error",css:e=>(e=>S.AH`
  margin: ${4*e.gridUnit}px;
  margin-top: 0;
`)(e),message:ne?(0,s.t)("Failed to update report"):(0,s.t)("Failed to create report"),description:K.error})]})}))},83537:(e,t,n)=>{n.d(t,{Gs:()=>r,x4:()=>a});const a=(e,t,n=Number.MAX_SAFE_INTEGER,a=0)=>{const r=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),i=Math.min(32*t,n)+32+a;return r-e<i?r-i:e},r=(e,t,n=0,r=Number.MAX_SAFE_INTEGER,i=0)=>{const o=e+4+32*n+4;return a(o,t,r,i)-o}},84064:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(5556),r=n.n(a),i=n(74792),o=n(8901),s=n(84080),l=n(2445);const d={option:r().oneOfType([i.A,r().shape({saved_metric_name:r().string.isRequired}),o.A]).isRequired};function c({option:e}){return e.saved_metric_name?(0,l.Y)(s.V,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,l.Y)(s.V,{column:e,showType:!0}):e.label?(0,l.Y)(s.V,{column:{column_name:e.label,type:"expression"},showType:!0}):null}c.propTypes=d},86832:(e,t,n)=>{n.d(t,{J:()=>o,p:()=>i});var a=n(62952),r=n(62221);const i=e=>{const t=(0,r.Gq)(r.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});return void 0===e?[]:(0,a.A)(t[e])},o=(e,t)=>{const n=(0,r.Gq)(r.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});(0,r.SO)(r.Hh.ExploreDataTableOriginalFormattedTimeColumns,{...n,[e]:t})}},88168:(e,t,n)=>{n.d(t,{A:()=>Xe});var a,r=n(61225),i=n(82960),o=n(2514),s=n(7735),l=n(96540),d=n(78518),c=n(96453),u=n(5362),h=n(27366),p=n(62952),m=n(73212),g=n(17444),v=n(50455),b=n(49544),f=n(35700),y=n(27023),x=n(32132),C=n(92201);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(a||(a={}));var S,A=n(86274),w=n(88055),T=n.n(w),F=n(2404),D=n.n(F),_=n(4124),Y=n.n(_),$=n(5556),I=n.n($),E=n(58863),M=n(80145),R=n(93641),k=n(28846),O=n(17437),N=n(40961),U=n(6749),q=n(53860),L=n(93103),z=n(95004),H=n(13270),P=n(71519),j=n(85861),W=n(46920),V=n(94229),B=n(60237),G=n(59838),Q=n(55976),K=n(5261),X=n(25946),J=n(84666),Z=n(85183);!function(e){e[e.Chart=0]="Chart",e[e.Table=1]="Table"}(S||(S={}));var ee=n(2445);function te({formData:e,result:t,dataset:n,onContextMenu:a,inContextMenu:r}){const i=(0,l.useMemo)((()=>({onContextMenu:a})),[a]);return(0,ee.Y)("div",{css:O.AH`
        width: 100%;
        height: 100%;
        min-height: 0;
      `,"data-test":"drill-by-chart",children:(0,ee.Y)(k.A,{disableErrorBoundary:!0,chartType:e.viz_type,enableNoResults:!0,datasource:n,formData:e,queriesData:t,hooks:i,inContextMenu:r,height:"100%",width:"100%"})})}var ne=n(78697),ae=n(15595),re=n(15151);const ie=(0,c.I4)(ae.BD.Item)`
  ${({theme:e,isClickable:t,isHidden:n})=>O.AH`
    cursor: ${t?"pointer":"auto"};
    color: ${e.colors.grayscale.light1};
    transition: color ease-in ${e.transitionTiming}s;
    .ant-breadcrumb > span:last-child > & {
      color: ${e.colors.grayscale.dark1};
    }
    &:hover {
      color: ${t?e.colors.grayscale.dark1:"inherit"};
    }
    visibility: ${n?"hidden":"visible"};
  `}
`;var oe=n(8877),se=n(48327);const le=c.I4.div`
  ${({theme:e})=>O.AH`
    & .pagination-container {
      bottom: ${4*-e.gridUnit}px;
    }
  `}
`,de="adhoc_filters",ce=({formData:e,closeModal:t})=>{const n=(0,r.wA)(),{addDangerToast:a}=(0,K.Yf)(),i=(0,c.DP)(),[o,u]=(0,l.useState)(""),h=(0,l.useContext)(V.DashboardPageIdContext),p=(0,l.useCallback)((()=>{n((0,s.logEvent)(f.Ro,{slice_id:e.slice_id}))}),[n,e.slice_id]),m=(0,r.d4)((e=>{var t;return(0,J.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),[g,v]=e.datasource.split("__");(0,l.useEffect)((()=>{(0,B.T3)(Number(g),v,e,0).then((e=>{u(`/explore/?form_data_key=${e}&dashboard_page_id=${h}`)})).catch((()=>{a((0,d.t)("Failed to generate chart edit URL"))}))}),[a,h,g,v,e]);const b=!o||!m;return(0,ee.FD)(ee.FK,{children:[(0,ee.Y)(W.A,{buttonStyle:"secondary",buttonSize:"small",onClick:p,disabled:b,tooltip:b?(0,d.t)("You do not have sufficient permissions to edit the chart"):void 0,children:(0,ee.Y)(P.N_,{css:O.AH`
            &:hover {
              text-decoration: none;
            }
          `,to:o,children:(0,d.t)("Edit chart")})}),(0,ee.Y)(W.A,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drill-by-modal",css:O.AH`
          margin-left: ${2*i.gridUnit}px;
        `,children:(0,d.t)("Close")})]})};function ue({column:e,dataset:t,drillByConfig:n,formData:a,onHideModal:i,canDownload:u}){const h=(0,r.wA)(),m=(0,c.DP)(),{addDangerToast:v}=(0,K.Yf)(),[b,y]=(0,l.useState)(!0),[x,C]=(0,l.useState)([{...n,column:e}]);(0,l.useEffect)((()=>{h((0,s.logEvent)(f.bD,{slice_id:a.slice_id}))}),[h,a.slice_id]);const{column:A,groupbyFieldName:w=n.groupbyFieldName}=x[x.length-1]||{},T=(0,l.useMemo)((()=>(0,p.A)(a[w]).map((e=>{var n;return null==(n=t.columns)?void 0:n.find((t=>t.column_name===e))})).filter(H.A)),[t.columns,a,w]),{displayModeToggle:F,drillByDisplayMode:D}=(()=>{const[e,t]=(0,l.useState)(S.Chart);return{displayModeToggle:(0,l.useMemo)((()=>(0,ee.Y)("div",{css:e=>O.AH`
          margin-bottom: ${6*e.gridUnit}px;
        `,"data-test":"drill-by-display-toggle",children:(0,ee.Y)(ne.s.GroupWrapper,{onChange:({target:{value:e}})=>{t(e)},defaultValue:S.Chart,options:[{label:(0,d.t)("Chart"),value:S.Chart},{label:(0,d.t)("Table"),value:S.Table}],optionType:"button",buttonStyle:"outline"})})),[]),drillByDisplayMode:e}})(),[_,Y]=(0,l.useState)(),$=((e,t,n)=>(0,H.A)(e)?1===e.length?(0,ee.Y)(le,{"data-test":"drill-by-results-table",children:(0,ee.Y)(oe.U,{colnames:e[0].colnames,coltypes:e[0].coltypes,rowcount:e[0].sql_rowcount,data:e[0].data,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})}):(0,ee.Y)(se.Ay,{fullWidth:!1,"data-test":"drill-by-results-tabs",children:e.map(((e,a)=>(0,ee.Y)(se.Ay.TabPane,{tab:(0,d.t)("Results %s",a+1),children:(0,ee.Y)(le,{children:(0,ee.Y)(oe.U,{colnames:e.colnames,coltypes:e.coltypes,data:e.data,rowcount:e.sql_rowcount,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})})},a)))}):(0,ee.Y)("div",{}))(_,a.datasource,u),[I,E]=(0,l.useState)(a),[M,R]=(0,l.useState)([...T,e].filter(H.A)),[k,N]=(0,l.useState)([{groupby:T,filters:n.filters},{groupby:e||[]}]),U=(0,l.useCallback)(((e,t=w)=>Array.isArray(a[t])?[e.column_name]:e.column_name),[a,w]),q=(0,l.useCallback)((e=>e.reduce(((e,t)=>{null!=t&&t.groupbyFieldName&&t.column&&(e.formData[t.groupbyFieldName]=U(t.column,t.groupbyFieldName),e.overriddenGroupbyFields.add(t.groupbyFieldName));const n=(null==t?void 0:t.adhocFilterFieldName)||de;return e.formData[n]=[...(0,p.A)(e[n]),...(0,p.A)(t.filters).map((e=>(0,G.r)(e)))],e.overriddenAdhocFilterFields.add(n),e}),{formData:{},overriddenGroupbyFields:new Set,overriddenAdhocFilterFields:new Set})),[U]),L=(0,l.useCallback)((()=>x.reduce(((e,t)=>{const n=t.adhocFilterFieldName||de;return e[n]=[...e[n]||[],...t.filters.map((e=>(0,G.r)(e)))],e}),{})),[x]),z=((e,t=re.fZ)=>(0,l.useMemo)((()=>{const n=t=>t<e.length-1,a=e=>`${(0,p.A)(e.groupby).map((e=>e.verbose_name||e.column_name)).join(", ")} ${e.filters?`(${e.filters.map((e=>e.formattedVal||e.val)).join(", ")})`:""}`;return(0,ee.Y)(ae.BD,{css:e=>O.AH`
          margin: ${2*e.gridUnit}px 0 ${4*e.gridUnit}px;
        `,children:e.map(((e,r)=>{return(0,ee.Y)(ie,{isClickable:n(r),isHidden:(i=e,0===(0,p.A)(i.groupby).length&&0===(0,p.A)(i.filters).length),onClick:n(r)?()=>t(e,r):re.fZ,"data-test":"drill-by-breadcrumb-item",children:a(e)},r);var i})).filter((e=>!1===e.props.isHidden))})}),[e,t]))(k,(0,l.useCallback)(((e,t)=>{h((0,s.logEvent)(f.g$,{slice_id:a.slice_id})),C((e=>e.slice(0,t))),N((e=>{const n=e.slice(0,t+1);return delete n[n.length-1].filters,n})),R((e=>e.slice(0,t))),E((()=>{if(0===t)return a;const{formData:e,overriddenAdhocFilterFields:n}=q(x.slice(0,t)),r={...a,...e};return n.forEach((t=>({...r,[t]:[...a[t],...e[t]]}))),r}))}),[h,x,a,q])),P=(0,l.useMemo)((()=>{let e={...I};A&&w&&(e[w]=U(A));const t=L();return Object.keys(t).forEach((n=>{e={...e,[n]:[...(0,p.A)(a[n]),...t[n]]}})),e.slice_id=0,delete e.slice_name,delete e.dashboards,e}),[I,A,w,L,U,a]);(0,l.useEffect)((()=>{R((e=>!A||e.some((e=>e.column_name===A.column_name))?e:[...e,A]))}),[A]);const W=(0,l.useCallback)(((e,t)=>{h((0,s.logEvent)(f.gi,{drill_depth:x.length+1,slice_id:a.slice_id})),E(P),C((n=>[...n,{...t,column:e}])),N((n=>{const a=[...n,{groupby:e}];return a[a.length-2].filters=t.filters,a}))}),[h,x.length,P,a.slice_id]),V=(0,l.useMemo)((()=>({drillBy:{excludedColumns:M,openNewModal:!1}})),[M]),{contextMenu:B,inContextMenu:J,onContextMenu:ue}=((e,t,n,a,r)=>{const i=(0,l.useRef)(null),[o,s]=(0,l.useState)(!1),d=(0,l.useCallback)(((...e)=>{s(!1),null==n||n(...e)}),[n]),c=(0,l.useCallback)((()=>{s(!1)}),[]);return{contextMenu:(0,l.useMemo)((()=>(0,ee.Y)(Ee,{ref:i,id:0,formData:t,onSelection:d,onClose:c,displayedItems:a,additionalConfig:r})),[r,0,a,t,c,d]),inContextMenu:o,onContextMenu:(e,t,n)=>{var a;null==(a=i.current)||a.open(e,t,n),s(!0)}}})(0,I,W,Ye.DrillBy,V),he=(0,r.d4)((e=>{const t=Object.values(e.dashboardLayout.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===a.slice_id}));return(null==t?void 0:t.meta.sliceNameOverride)||(null==t?void 0:t.meta.sliceName)}));(0,l.useEffect)((()=>{if(P){const[e]=(0,Z.Mp)(P);y(!0),Y(void 0),(0,o.getChartDataRequest)({formData:P}).then((({response:t,json:n})=>(0,o.handleChartDataResponse)(t,n,e))).then((e=>{Y(e)})).catch((()=>{v((0,d.t)("Failed to load chart data."))})).finally((()=>{y(!1)}))}}),[v,P]);const{metadataBar:pe}=(0,Q.M)({dataset:t});return(0,ee.Y)(j.Ay,{css:O.AH`
        .antd5-modal-footer {
          border-top: none;
        }
      `,show:!0,onHide:null!=i?i:()=>null,title:(0,d.t)("Drill by: %s",he),footer:(0,ee.Y)(ce,{formData:P}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*m.gridUnit,minWidth:128*m.gridUnit,defaultSize:{width:"auto",height:"80vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1,children:(0,ee.FD)("div",{css:O.AH`
          display: flex;
          flex-direction: column;
          height: 100%;
        `,children:[pe,z,F,b&&(0,ee.Y)(g.A,{}),!b&&!_&&(0,ee.Y)(X.A,{type:"error",message:(0,d.t)("There was an error loading the chart data")}),D===S.Chart&&_&&(0,ee.Y)(te,{dataset:t,formData:P,result:_,onContextMenu:ue,inContextMenu:J}),D===S.Table&&_&&$,B]})})}var he=n(70542),pe=n(83537),me=n(67429),ge=n(38221),ve=n.n(ge),be=n(72391),fe=n(87843),ye=n(58561),xe=n.n(ye),Ce=n(5373),Se=n(67073),Ae=n(90868),we=n(35233),Te=n(28543);const Fe=(0,be.a)().get("load.drillby.options"),De=xe().encode({columns:["table_name","owners.first_name","owners.last_name","created_by.first_name","created_by.last_name","created_on_humanized","changed_by.first_name","changed_by.last_name","changed_on_humanized","columns.column_name","columns.verbose_name","columns.groupby"]}),_e=({drillByConfig:e,formData:t,contextMenuY:n=0,submenuIndex:a=0,onSelection:r=()=>{},onClick:i=()=>{},excludedColumns:o,openNewModal:s=!0,open:h,onDrillBy:m,...v})=>{const b=(0,c.DP)(),{addDangerToast:f}=(0,K.Yf)(),[y,x]=(0,l.useState)(!0),[C,S]=(0,l.useState)(""),[A,w]=(0,l.useState)(""),[T,F]=(0,l.useState)(),[D,_]=(0,l.useState)([]),Y=(0,l.useRef)(null),$=Fe||D.length>10,I=(0,l.useCallback)(((t,n)=>{i(t),r(n,e),s&&m&&T&&m(n,T)}),[e,i,r,s,m,T]);(0,l.useEffect)((()=>{var e,t;h?null==(e=Y.current)||null==(t=e.input)||t.focus({preventScroll:!0}):(S(""),w(""))}),[h]);const R=null==e?void 0:e.groupbyFieldName,k=(0,l.useMemo)((()=>{var e;return null==(e=(0,M.A)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===E.nS.DrillBy))}),[t.viz_type]);(0,l.useEffect)((()=>{k&&R&&async function(){const n=Number(t.datasource.split("__")[0]);try{let a;x(!0),a=Fe?await Fe(n,t):await(0,we.w)({endpoint:`/api/v1/dataset/${n}?q=${De}`});const{json:r}=a,{result:i}=r;F(i),_((0,p.A)(i.columns).filter((e=>e.groupby)).filter((n=>{var a,r;return!(0,p.A)(t[null!=(a=null==e?void 0:e.groupbyFieldName)?a:""]).includes(n.column_name)&&n.column_name!==t.x_axis&&(null==(r=(0,p.A)(o))?void 0:r.every((e=>e.column_name!==n.column_name)))})))}catch(e){u.A.error(e),we.e.delete(`/api/v1/dataset/${n}`),f((0,d.t)("Failed to load dimensions for drill by"))}finally{x(!1)}}()}),[f,null==e?void 0:e.groupbyFieldName,o,t,k,R]);const N=(0,l.useMemo)((()=>ve()((e=>{w(e)}),fe.j)),[]),q=(0,l.useMemo)((()=>D.filter((e=>(e.verbose_name||e.column_name).toLowerCase().includes(A.toLowerCase())))),[D,A]),L=(0,l.useMemo)((()=>(0,pe.Gs)(n,q.length||1,a,200,$?48:0)),[n,q.length,a,$]);let z;return k?R||(z=(0,d.t)("Drill by is not available for this data point")):z=(0,d.t)("Drill by is not yet supported for this chart type"),k&&R?(0,ee.Y)(ee.FK,{children:(0,ee.Y)(U.W1.SubMenu,{title:(0,d.t)("Drill by"),popupClassName:"chart-context-submenu",popupOffset:[0,L],...v,children:(0,ee.FD)("div",{"data-test":"drill-by-submenu",children:[$&&(0,ee.Y)(Ae.pd,{ref:Y,prefix:(0,ee.Y)(Se.F.SearchOutlined,{iconSize:"l",iconColor:b.colors.grayscale.light1}),onChange:e=>{var t;e.stopPropagation(),t=e.target.value,S(t),N(t)},placeholder:(0,d.t)("Search columns"),onClick:e=>{e.nativeEvent.stopImmediatePropagation()},allowClear:!0,css:O.AH`
                width: auto;
                max-width: 100%;
                margin: ${2*b.gridUnit}px ${3*b.gridUnit}px;
                box-shadow: none;
              `,value:C}),y?(0,ee.Y)("div",{css:O.AH`
                padding: ${3*b.gridUnit}px 0;
              `,children:(0,ee.Y)(g.A,{position:"inline-centered"})}):q.length?(0,ee.Y)(Ce.Y1,{width:"100%",height:200,itemSize:35,itemCount:q.length,itemData:{columns:q,...v},overscanCount:20,children:({index:e,data:t,style:n})=>{const{columns:a,...r}=t,i=a[e];return(0,ee.Y)(Te.oY,{menuKey:`drill-by-item-${i.column_name}`,tooltipText:i.verbose_name||i.column_name,onClick:e=>I(e,i),style:n,...r,children:i.verbose_name||i.column_name})}}):(0,ee.Y)(U.W1.Item,{disabled:!0,...v,children:(0,d.t)("No columns found")},"no-drill-by-columns-found")]})},"drill-by-submenu")}):(0,ee.Y)(U.W1.Item,{disabled:!0,...v,children:(0,ee.FD)("div",{children:[(0,d.t)("Drill by"),(0,ee.Y)(me.C,{title:z})]})},"drill-by-disabled")};var Ye,$e=n(29356);!function(e){e[e.CrossFilter=0]="CrossFilter",e[e.DrillToDetail=1]="DrillToDetail",e[e.DrillBy=2]="DrillBy",e[e.All=3]="All"}(Ye||(Ye={}));const Ie=({id:e,formData:t,onSelection:n,onClose:a,displayedItems:i=Ye.All,additionalConfig:o},s)=>{var u,m;const g=(0,c.DP)(),v=(0,r.wA)(),{canDrillToDetail:b,canDrillBy:f,canDownload:y}=(0,q.S)(),x=(0,r.d4)((({dashboardInfo:e})=>e.crossFiltersEnabled)),[C,S]=(0,l.useState)([]),[A,w]=(0,l.useState)([]),[T,F]=(0,l.useState)(!1),D=e=>i===Ye.All||(0,p.A)(i).includes(e),[{filters:_,clientX:Y,clientY:$},I]=(0,l.useState)({clientX:0,clientY:0}),[R,k]=(0,l.useState)(!1),[H,P]=(0,l.useState)(),[j,W]=(0,l.useState)(!1),[V,B]=(0,l.useState)(),G=(e=>{const t={};return(0,p.A)(null==e?void 0:e.columns).forEach((e=>{t[e.column_name]=e.verbose_name||e.column_name})),(0,p.A)(null==e?void 0:e.metrics).forEach((e=>{t[e.metric_name]=e.verbose_name||e.metric_name})),t})(V),Q=(0,l.useCallback)(((e,t)=>{P(e),B(t),W(!0)}),[]),K=(0,l.useCallback)((()=>{W(!1)}),[]),X=[],J=(0,h.G7)(h.TO.DrillToDetail)&&b&&D(Ye.DrillToDetail),Z=(0,h.G7)(h.TO.DrillBy)&&f&&D(Ye.DrillBy),te=D(Ye.CrossFilter),ne=null==(u=(0,M.A)().get(t.viz_type))||null==(m=u.behaviors)?void 0:m.includes(E.nS.InteractiveChart);let ae=0;if(te&&(ae+=1),J&&(ae+=2),Z&&(ae+=1),0===ae&&(ae=1),te){var re;const t=!ne||!x||!(null!=_&&_.crossFilter);let n=null;t?x?ne?null!=_&&_.crossFilter||(n=(0,ee.Y)(ee.FK,{children:(0,ee.Y)("div",{children:(0,d.t)("You can't apply cross-filter on this data point.")})})):n=(0,ee.Y)(ee.FK,{children:(0,ee.Y)("div",{children:(0,d.t)("This visualization type does not support cross-filtering.")})}):n=(0,ee.Y)(ee.FK,{children:(0,ee.Y)("div",{children:(0,d.t)("Cross-filtering is not enabled for this dashboard.")})}):n=(0,ee.FD)(ee.FK,{children:[(0,ee.Y)("div",{children:(0,d.t)("Cross-filter will be applied to all of the charts that use this dataset.")}),(0,ee.Y)("div",{children:(0,d.t)("You can also just click on the chart to apply cross-filter.")})]}),X.push((0,ee.FD)(ee.FK,{children:[(0,ee.Y)(U.W1.Item,{disabled:t,onClick:()=>{null!=_&&_.crossFilter&&v((0,z.Mv)(e,_.crossFilter.dataMask))},children:null!=_&&null!=(re=_.crossFilter)&&re.isCurrentValueSelected?(0,d.t)("Remove cross-filter"):(0,ee.FD)("div",{children:[(0,d.t)("Add cross-filter"),(0,ee.Y)(me.C,{title:n,color:t?void 0:g.colors.grayscale.base})]})},"cross-filtering-menu-item"),ae>1&&(0,ee.Y)(U.W1.Divider,{})]}))}if(J&&X.push((0,ee.Y)(he.k,{formData:t,filters:null==_?void 0:_.drillToDetail,setFilters:w,isContextMenu:!0,contextMenuY:$,onSelection:n,submenuIndex:te?2:1,setShowModal:k,...(null==o?void 0:o.drillToDetail)||{}})),Z){let e=0;te&&(e+=1),J&&(e+=2),X.push((0,ee.Y)(_e,{drillByConfig:null==_?void 0:_.drillBy,onSelection:n,formData:t,contextMenuY:$,submenuIndex:e,open:C.includes("drill-by-submenu"),onDrillBy:Q,...(null==o?void 0:o.drillBy)||{}},"drill-by-submenu"))}const ie=(0,l.useCallback)(((t,n,a)=>{var r;const i=(0,pe.x4)(n,ae);I({clientX:t,clientY:i,filters:a}),null==(r=document.getElementById(`hidden-span-${e}`))||r.click()}),[e,ae]);return(0,l.useImperativeHandle)(s,(()=>({open:ie})),[ie]),N.createPortal((0,ee.FD)(ee.FK,{children:[(0,ee.Y)(L.ms,{dropdownRender:()=>(0,ee.Y)(U.W1,{className:"chart-context-menu","data-test":"chart-context-menu",onOpenChange:S,onClick:()=>{F(!1),a()},children:X.length?X:(0,ee.Y)(U.W1.Item,{disabled:!0,children:(0,d.t)("No actions")})}),trigger:["click"],onOpenChange:e=>{F(e),e||S([])},open:T,children:(0,ee.Y)("span",{id:`hidden-span-${e}`,css:(0,O.AH)({visibility:"hidden",position:"fixed",top:$,left:Y,width:1,height:1},"","")})}),J&&(0,ee.Y)($e.A,{initialFilters:A,chartId:e,formData:t,showModal:R,onHideModal:()=>{k(!1)}}),j&&H&&V&&(null==_?void 0:_.drillBy)&&(0,ee.Y)(ue,{column:H,drillByConfig:null==_?void 0:_.drillBy,formData:t,onHideModal:K,dataset:{...V,verbose_map:G},canDownload:y})]}),document.body)},Ee=(0,l.forwardRef)(Ie),Me={annotationData:I().object,actions:I().object,chartId:I().number.isRequired,datasource:I().object,initialValues:I().object,formData:I().object.isRequired,latestQueryFormData:I().object,labelsColor:I().object,labelsColorMap:I().object,height:I().number,width:I().number,setControlValue:I().func,vizType:I().string.isRequired,triggerRender:I().bool,chartAlert:I().string,chartStatus:I().string,queriesResponse:I().arrayOf(I().object),triggerQuery:I().bool,chartIsStale:I().bool,addFilter:I().func,setDataMask:I().func,onFilterMenuOpen:I().func,onFilterMenuClose:I().func,ownState:I().object,postTransformProps:I().func,source:I().oneOf([a.Dashboard,a.Explore]),emitCrossFilters:I().bool},Re={},ke=[E.nS.InteractiveChart],Oe={addFilter:()=>Re,onFilterMenuOpen:()=>Re,onFilterMenuClose:()=>Re,initialValues:Re,setControlValue(){},triggerRender:!1};class Ne extends l.Component{constructor(e){var t,n;super(e);const r=null==(t=(0,M.A)().get(null!=(n=e.formData.viz_type)?n:e.vizType))?void 0:t.suppressContextMenu;this.state={showContextMenu:e.source===a.Dashboard&&!r&&(0,h.G7)(h.TO.DrillToDetail),inContextMenu:!1,legendState:void 0,legendIndex:0},this.hasQueryResponseChange=!1,this.contextMenuRef=(0,l.createRef)(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.handleLegendStateChanged=this.handleLegendStateChanged.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.handleLegendScroll=this.handleLegendScroll.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,onLegendStateChanged:this.handleLegendStateChanged,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)},onLegendScroll:this.handleLegendScroll},this.mutableQueriesResponse=T()(this.props.queriesResponse)}shouldComponentUpdate(e,t){var n,a;return!(!(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1)||null!=(n=e.queriesResponse)&&null!=(a=n[0])&&a.error)&&(!D()(this.state,t)||(this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange&&(this.mutableQueriesResponse=T()(e.queriesResponse)),this.hasQueryResponseChange||!D()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.ownState!==this.props.ownState||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelsColor!==this.props.labelsColor||e.labelsColorMap!==this.props.labelsColorMap||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters))}handleAddFilter(e,t,n=!0,a=!0){this.props.addFilter(e,t,n,a)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:n,vizType:a}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(n),this.hasQueryResponseChange&&e.logEvent(f.tE,{slice_id:n,viz_type:a,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:f.Vy.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:n,chartId:a}=this.props;u.A.warn(e),n.chartRenderingFailed(e.toString(),a,t?t.componentStack:null),this.hasQueryResponseChange&&n.logEvent(f.tE,{slice_id:a,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:f.Vy.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,n){this.contextMenuRef.current.open(e,t,n),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}handleLegendStateChanged(e){this.setState({legendState:e})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}handleLegendScroll(e){this.setState({legendIndex:e})}render(){var e,t;const{chartAlert:n,chartStatus:r,chartId:i,emitCrossFilters:o}=this.props;if("loading"===r||n||null===r)return null;this.renderStartTime=f.Vy.getTimestamp();const{width:s,height:l,datasource:c,annotationData:u,initialValues:h,ownState:p,filterState:m,chartIsStale:g,formData:b,latestQueryFormData:y,postTransformProps:x}=this.props,C=g&&y?y:b,S=C.viz_type||this.props.vizType,A=Y()(S),w=S===R.Y.Table?`superset-chart-${A}`:A;let T;const F=(0,d.t)("No results were returned for this query"),D=this.props.source===a.Explore?(0,d.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,_="chart.svg";T=s>300&&l>220?(0,ee.Y)(v.p,{size:"large",title:F,description:D,image:_}):(0,ee.Y)(v.p,{size:"small",title:F,image:_});const $=null!=(e=(0,M.A)().get(b.viz_type))&&e.behaviors.find((e=>e===E.nS.DrillToDetail))?{inContextMenu:this.state.inContextMenu}:{},I=!(null!=b&&b.server_pagination&&((null==p||null==(t=p.searchText)?void 0:t.length)||0)>0);return(0,ee.FD)(ee.FK,{children:[this.state.showContextMenu&&(0,ee.Y)(Ee,{ref:this.contextMenuRef,id:i,formData:C,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,ee.Y)("div",{onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0,children:(0,ee.Y)(k.A,{disableErrorBoundary:!0,id:`chart-id-${i}`,className:w,chartType:S,width:s,height:l,annotationData:u,datasource:c,initialValues:h,formData:C,ownState:p,filterState:m,hooks:this.hooks,behaviors:ke,queriesData:this.mutableQueriesResponse,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:T,postTransformProps:x,emitCrossFilters:o,legendState:this.state.legendState,enableNoResults:I,legendIndex:this.state.legendIndex,...$},`${i}`)})]})}}Ne.propTypes=Me,Ne.defaultProps=Oe;const Ue=Ne;var qe=n(71478),Le=n(79427);const ze=({chartId:e,error:t,...n})=>{const{result:a}=(0,qe.RG)(e),r=t&&{...t,extra:{...t.extra,owners:a}};return(0,ee.Y)(Le.A,{...n,error:r,title:"Data error"})};var He=n(21357);const Pe={},je=(0,d.t)("The dataset associated with this chart no longer exists"),We={addFilter:()=>Pe,onFilterMenuOpen:()=>Pe,onFilterMenuClose:()=>Pe,initialValues:Pe,setControlValue:()=>Pe,triggerRender:!1,dashboardId:void 0,chartStackTrace:void 0,force:!1,isInView:!0},Ve=c.I4.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
  }

  .slice_container {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: ${e=>e.height}px;

    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.gridUnit}px;
    }
  }
`,Be=c.I4.div`
  position: absolute;
  left: 50%;
  top: 50%;
  width: 80%;
  transform: translate(-50%, -50%);
`,Ge=c.I4.span`
  display: block;
  text-align: center;
  margin: ${({theme:e})=>4*e.gridUnit}px auto;
  width: fit-content;
  color: ${({theme:e})=>e.colors.grayscale.base};
`;class Qe extends l.PureComponent{constructor(e){super(e),this.renderStartTime=void 0,this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){this.props.triggerQuery&&this.runQuery()}componentDidUpdate(){this.props.triggerQuery&&this.runQuery()}runQuery(){this.props.actions.postChartFormData(this.props.formData,Boolean(this.props.force||(0,x.P3)(y.vX.force)),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState)}handleRenderContainerFailure(e,t){const{actions:n,chartId:a}=this.props;u.A.warn(e),n.chartRenderingFailed(e.toString(),a,t?t.componentStack:null),n.logEvent(f.tE,{slice_id:a,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:f.Vy.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:n,chartAlert:r,chartStackTrace:i,datasource:o,dashboardId:s,height:l,datasetsStatus:d}=this.props,c=null==e||null==(t=e.errors)?void 0:t[0],u=r||(null==e?void 0:e.message);return void 0!==r&&r!==je&&o===m.As&&d!==A.bk.Error?(0,ee.Y)(Ve,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:l,children:(0,ee.Y)(g.A,{})},n):(0,ee.Y)(ze,{chartId:n,error:c,subtitle:u,link:e?e.link:void 0,source:s?a.Dashboard:a.Explore,stackTrace:i},n)}renderSpinner(e){const t=(0,d.t)("Recovering Data...");return(0,ee.FD)(Be,{children:[(0,ee.Y)(g.A,{position:"inline-centered"}),(0,ee.Y)(Ge,{children:t})]})}renderChartContainer(){return(0,ee.Y)("div",{className:"slice_container","data-test":"slice-container",children:this.props.isInView||!(0,h.G7)(h.TO.DashboardVirtualization)||(0,C.a)()?(0,ee.Y)(Ue,{...this.props,source:this.props.dashboardId?"dashboard":"explore","data-test":this.props.vizType}):(0,ee.Y)(g.A,{})})}render(){var e;const{height:t,chartAlert:n,chartStatus:a,datasource:r,errorMessage:i,chartIsStale:o,queriesResponse:s=[],width:l}=this.props,c=null==r||null==(e=r.database)?void 0:e.name,u="loading"===a;return"failed"===a?s.map((e=>this.renderErrorMessage(e))):i&&0===(0,p.A)(s).length?(0,ee.Y)(v.p,{size:"large",title:(0,d.t)("Add required control values to preview chart"),description:(0,He.w)(!0),image:"chart.svg"}):u||n||i||!o||0!==(0,p.A)(s).length?(0,ee.Y)(b.A,{onError:this.handleRenderContainerFailure,showMessage:!1,children:(0,ee.Y)(Ve,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:t,width:l,children:u?this.renderSpinner(c):this.renderChartContainer()})}):(0,ee.Y)(v.p,{size:"large",title:(0,d.t)("Your chart is ready to go!"),description:(0,ee.FD)("span",{children:[(0,d.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,ee.Y)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery,children:(0,d.t)("click here")}),"."]}),image:"chart.svg"})}}Qe.defaultProps=We;const Ke=Qe,Xe=(0,r.Ng)(null,(function(e){return{actions:(0,i.zH)({...o,updateDataMask:z.Mv,logEvent:s.logEvent},e)}}))(Ke)},90422:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(95483),r=n(71191),i=n(2511);const o=[...a.Wy].map((e=>a.nS[e].operation));class s{constructor(e){var t;this.expressionType=e.expressionType||i.A.Simple,this.expressionType===i.A.Simple?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,a.Sd.indexOf(e.operatorId)>=0&&(this.comparator=void 0),this.clause=e.clause||i.v.Where,this.sqlExpression=null):this.expressionType===i.A.Sql&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:(0,r.e)(e,{useSimple:!0}),this.clause=e.clause,e.operator&&o.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new s({...this,isNew:!1,...e})}equals(e){return e.clause===this.clause&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){if(this.expressionType===i.A.Simple){if(a.Sd.map((e=>a.nS[e].operation)).indexOf(this.operator)>=0)return!!this.subject;if(this.operator&&this.subject&&this.clause)return Array.isArray(this.comparator)?this.comparator.length>0:null!==this.comparator}return this.expressionType===i.A.Sql&&!(!this.sqlExpression||!this.clause)}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return(0,r.e)(this)}}},91643:(e,t,n)=>{n.d(t,{A:()=>_});var a=n(96540),r=n(58561),i=n.n(r),o=n(96453),s=n(35742),l=n(78518),d=n(45738),c=n(10286),u=n(19966),h=n(39091),p=n(8143),m=n(69633),g=n(78360),v=n(69172),b=n(61574),f=n(75488),y=n(15595),x=n(2445);const C=(0,o.I4)(h.i8)`
  && {
    margin: 0 0 ${({theme:e})=>e.gridUnit}px;
  }
`;d.A.registerLanguage("markdown",p.A),d.A.registerLanguage("html",m.A),d.A.registerLanguage("sql",g.A),d.A.registerLanguage("json",v.A);const S=o.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,A=o.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin-top: ${({theme:e})=>4*-e.gridUnit}px;
  align-items: flex-end;
`,w=o.I4.div`
  display: flex;
  flex-direction: row;
  column-gap: ${({theme:e})=>2*e.gridUnit}px;
`,T=(0,o.I4)(d.A)`
  flex: 1;
`,F=o.I4.label`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
`,D={keys:["none"],columns:["database.backend"]},_=e=>{var t;const{sql:n,language:r="sql",datasource:o}=e,d=o.split("__")[0],[h,p]=(0,a.useState)(),[m,g]=(0,a.useState)(!0),v=(0,b.W6)(),_=null!=(t=m?h:n)?t:n,Y=(0,a.useCallback)((()=>{if(h)g((e=>!e));else{const e=i().encode(D);s.A.get({endpoint:`/api/v1/dataset/${d}?q=${e}`}).then((({json:e})=>s.A.post({endpoint:"/api/v1/sqllab/format_sql/",body:JSON.stringify({sql:n,engine:e.result.database.backend}),headers:{"Content-Type":"application/json"}}))).then((({json:e})=>{p(e.result),g(!0)})).catch((()=>{g(!0)}))}}),[n,d,h]),$=(0,a.useCallback)((e=>{const t={datasourceKey:o,sql:_};e.metaKey||e.ctrlKey?(e.preventDefault(),window.open(`/sqllab?datasourceKey=${o}&sql=${_}`,"_blank")):v.push("/sqllab",{state:{requestedQuery:t}})}),[v,o,_]);return(0,a.useEffect)((()=>{Y()}),[n]),(0,x.FD)(S,{children:[(0,x.FD)(A,{children:[(0,x.FD)(w,{children:[(0,x.Y)(u.A,{text:_,shouldShowText:!1,copyNode:(0,x.Y)(C,{buttonSize:"small",children:(0,l.t)("Copy")})}),(0,x.Y)(y.$n,{onClick:$,children:(0,l.t)("View in SQL Lab")})]}),(0,x.FD)(w,{children:[(0,x.Y)(f.d,{id:"formatSwitch",checked:!m,onChange:Y}),(0,x.Y)(F,{htmlFor:"formatSwitch",children:(0,l.t)("Show original SQL")})]})]}),!h&&(0,x.Y)(y.EA,{active:!0}),h&&(0,x.Y)(T,{language:r,style:c.A,children:_})]},n)}},92013:(e,t,n)=>{n.d(t,{r:()=>o});var a=n(78518),r=n(24976),i=n(67553);function o(e){return e.map((({column_name:e,verbose_name:t,is_certified:n,certified_by:o,description:s,type:l})=>({name:t||e,value:e,docHTML:(0,r.jS)({title:e,body:`type: ${l||"unknown"}<br />${s?`description: ${s}`:""}`,footer:n?(0,a.t)("Certified by %s",o):void 0}),score:i.v9,meta:"column"})))}},92201:(e,t,n)=>{n.d(t,{a:()=>a});const a=()=>{var e,t;return null==(e=window)||null==(t=e.navigator)?void 0:t.webdriver}}}]);