"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5721],{13686:(e,t,n)=>{n.d(t,{t:()=>f});var r=n(77189);const i=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,a=String.raw`(?:TODAY|NOW)`,s=String.raw`[+-]?[1-9][0-9]*`,l=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,o=RegExp(String.raw`^DATEADD\(DATETIME\("(${i}|${a})"\),\s(${s}),\s(${l})\)$`,"i"),c=RegExp(String.raw`^${i}$|^${a}$`,"i"),u=["now","today"],d=new Date;d.setHours(0,0,0,0);const m=new Date;m.setHours(0,0,0,0);const g={sinceDatetime:d.setDate(d.getDate()-7).toString(),sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:m.toString(),untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},f=e=>{const t=e.split(r.wv);if(2===t.length){const[e,n]=t;if(c.test(e)&&c.test(n)){const t=u.includes(e)?e:"specific",r=u.includes(n)?n:"specific";return{customRange:{...g,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:r},matchedFlag:!0}}const r=e.match(o);if(r&&c.test(n)&&e.includes(n)){const[e,t,i]=r.slice(1),a=u.includes(n)?n:"specific";return{customRange:{...g,sinceGrain:i,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:a},matchedFlag:!0}}const i=n.match(o);if(c.test(e)&&i&&n.includes(e)){const[t,n,r]=[...i.slice(1)],a=u.includes(e)?e:"specific";return{customRange:{...g,untilGrain:r,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:a},matchedFlag:!0}}if(r&&i){const[e,t,n]=[...r.slice(1)],[a,s,l]=[...i.slice(1)];if(e===a)return{customRange:{...g,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(s,10),untilDatetime:a,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:g,matchedFlag:!1}}},49277:(e,t,n)=>{n.d(t,{M9:()=>c,TX:()=>u,cy:()=>o});var r=n(62193),i=n.n(r),a=n(62952),s=n(13686);const l=864e5,o=(e,t=!1,n=!1)=>{const r=new Date;if("now"===e||"No filter"===e||""===e)return r;if("today"===e)return r.setHours(0,0,0,0),r;if(n?r.setHours(-r.getTimezoneOffset()/60,0,0,0):r.setHours(0,0,0,0),t&&null!=e&&e.includes("Last"))return r;switch(e){case"Last day":return r.setUTCDate(r.getUTCDate()-1),r;case"Last week":return r.setUTCDate(r.getUTCDate()-7),r;case"Last month":return r.setUTCMonth(r.getUTCMonth()-1),r;case"Last quarter":return r.setUTCMonth(r.getUTCMonth()-3),r;case"Last year":return r.setUTCFullYear(r.getUTCFullYear()-1),r;case"previous calendar week":return t?r.setDate(r.getDate()-r.getDay()+1):r.setDate(r.getDate()-r.getDay()-6),r;case"previous calendar month":return t?r.setDate(1):(r.setDate(1),r.setMonth(r.getMonth()-1)),r;case"previous calendar year":return t?r.setFullYear(r.getFullYear(),0,1):r.setFullYear(r.getFullYear()-1,0,1),r}if(null!=e&&e.includes("ago")){const t=e.split(" "),n=parseInt(t[0],10);switch(t[1]){case"day":case"days":r.setUTCDate(r.getUTCDate()-n);break;case"week":case"weeks":r.setUTCDate(r.getUTCDate()-7*n);break;case"month":case"months":r.setUTCMonth(r.getUTCMonth()-n);break;case"year":case"years":r.setUTCFullYear(r.getUTCFullYear()-n)}return r}const a=null==e?void 0:e.split("-");let s=null;return s=a&&!i()(a)?1===a.length?new Date(Date.UTC(parseInt(a[0],10),0)):2===a.length?new Date(Date.UTC(parseInt(a[0],10),parseInt(a[1],10)-1)):3===a.length?new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)):new Date(e):new Date(e),s&&!Number.isNaN(s.getTime())?(n?s.setHours(-s.getTimezoneOffset()/60,0,0,0):s.setHours(0,0,0,0),s):null},c=(e,t,n)=>{let r;if(r="now"===e||"today"===e?new Date:new Date(e),!Number.isNaN(r.getTime())){switch(t){case"second":r.setSeconds(r.getSeconds()+n);break;case"minute":r.setMinutes(r.getMinutes()+n);break;case"hour":r.setHours(r.getHours()+n);break;case"day":r.setDate(r.getDate()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"year":r.setFullYear(r.getFullYear()+n)}return r}return null},u=({timeRangeFilter:e,shifts:t,startDate:n,includeFutureOffsets:r=!0})=>{var i,u,d,m,g,f;const{customRange:h,matchedFlag:p}=(0,s.t)(null!=(i=null==e?void 0:e.comparator)?i:"");let v=null,y=null;if(p){var D,w;const{sinceDatetime:e,sinceMode:t,sinceGrain:n,sinceGrainValue:r,untilDatetime:i,untilMode:a,untilGrain:s,untilGrainValue:l}={...h};v="relative"!==t?"specific"===t?new Date(e):o(e,!1,!0):c(e,n,r),null==(D=v)||D.setHours(0,0,0,0),y="relative"!==a?"specific"===a?new Date(i):o(i,!1,!0):c(i,s,l),null==(w=y)||w.setHours(0,0,0,0)}const b=null==t?void 0:t.includes("custom"),$=null==t?void 0:t.includes("inherit");let T;var x;b&&(T=p?new Date(new Date(n).setUTCHours(new Date(n).getTimezoneOffset()/60,0,0,0)).getTime():null==(x=o(n))?void 0:x.getTime());const[C,M]=(null!=(u=null==e?void 0:e.comparator)?u:"").split(" : ").map((e=>e.trim())),U=(null==(d=null!=(m=v)?m:o(C,!1,!1))?void 0:d.getTime())||0,F=(null==(g=null!=(f=y)?f:o(M||C,!0,!1))?void 0:g.getTime())||0,S=T&&U&&Math.round((U-T)/l),N=$&&F&&U&&Math.round((F-U)/l),R=(0,a.A)(t).map((e=>{if("custom"===e&&void 0!==S&&!Number.isNaN(S)){if(r&&S<0)return-1*S+" days after";if(S>=0&&U)return`${S} days ago`}if("inherit"===e&&N&&!Number.isNaN(N)){if(r&&N<0)return-1*N+" days after";if(N>0)return`${N} days ago`}return e})).filter((e=>"custom"!==e&&"inherit"!==e));return(0,a.A)(R)}},55721:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(62193),i=n.n(r),a=n(96540),s=n(96453),l=n(77189),o=n(49277),c=n(62952),u=n(17437),d=n(78518),m=n(42370),g=n(97689),f=n(45186),h=n(38221),p=n.n(h);const v=e=>{const t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r,i]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{let r;const a=t.current,s=n.current;if(a&&s){const t=Array.from(a.children);r=new ResizeObserver(p()((()=>{t.reduce(((e,t)=>{var n,r;return e+(null!=(n=null==(r=t.firstElementChild)?void 0:r.scrollWidth)?n:0)}),0)+e*Math.max(t.length-1,0)>s.clientWidth?i(!0):i(!1)}),500)),r.observe(document.body),t.forEach((e=>{r.observe(e)}))}return()=>{var e;return null==(e=r)?void 0:e.disconnect()}}),[e]),{isOverflowing:r,symbolContainerRef:t,wrapperRef:n}};var y=n(2445);const D=s.I4.div`
  ${({theme:e,metricNameFontSize:t})=>`\n    font-family: ${e.typography.families.sansSerif};\n    font-weight: ${e.typography.weights.normal};\n    font-size: ${t||2*e.typography.sizes.s}px;\n    text-align: center;\n    margin-bottom: ${3*e.gridUnit}px;\n  `}
`,w=s.I4.div`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 100%;
  height: 100%;
  overflow: auto;
  padding: 12px;
`,b=s.I4.div`
  ${({theme:e,subheaderFontSize:t})=>`\n    font-weight: ${e.typography.weights.light};\n    display: flex;\n    justify-content: center;\n    font-size: ${t||20}px;\n    flex: 1 1 0px;\n  `}
`,$=s.I4.span`
  ${({theme:e,backgroundColor:t,textColor:n})=>`\n    background-color: ${t};\n    color: ${n};\n    padding: ${e.gridUnit}px ${2*e.gridUnit}px;\n    border-radius: ${2*e.gridUnit}px;\n    margin-right: ${e.gridUnit}px;\n  `}
`;function T(e){const{height:t,width:n,bigNumber:r,prevNumber:h,valueDifference:p,percentDifferenceFormattedString:T,metricName:x,metricNameFontSize:C,headerFontSize:M,subheaderFontSize:U,comparisonColorEnabled:F,comparisonColorScheme:S,percentDifferenceNumber:N,currentTimeRangeFilter:R,startDateOffset:k,shift:A,subtitle:H,subtitleFontSize:I,dashboardTimeRange:Y,showMetricName:G}=e,[z,E]=(0,a.useState)("");(0,a.useEffect)((()=>{if(R&&(A||k)){if(!i()(A)||k){const e=(0,l.x9)(null!=Y?Y:R.comparator,R.subject);Promise.resolve(e).then((e=>{var t;const n=null==e||null==(t=e.value)?void 0:t.match(m.Io),[r,i]=null!=n?n:[],a=(0,o.TX)({timeRangeFilter:{...R,comparator:`${r} : ${i}`},shifts:(0,c.A)(A),startDate:k||""});(0,l.x9)(null!=Y?Y:R.comparator,R.subject,(0,c.A)(a)).then((e=>{const t=(0,c.A)(e.value).flat()[0].split("vs\n");E(t.length>1?t[1].trim():t[0])}))}))}}else E("")}),[R,A,k,Y]);const O=(0,s.DP)(),V=5*O.gridUnit,j=u.AH`
    font-family: ${O.typography.families.sansSerif};
    display: flex;
    justify-content: center;
    align-items: center;
    height: ${t}px;
    width: ${n}px;
    overflow: auto;
  `,K=u.AH`
    font-size: ${M||60}px;
    font-weight: ${O.typography.weights.normal};
    text-align: center;
    margin-bottom: ${4*O.gridUnit}px;
  `,L=s.I4.div`
    ${({theme:e})=>`\n    font-family: ${e.typography.families.sansSerif};\n    font-weight: ${e.typography.weights.medium};\n    text-align: center;\n    margin-top: -10px;\n    margin-bottom: ${4*e.gridUnit}px;\n  `}
  `,P=u.AH`
    color: ${F&&0!==N?N>0?S===f.m.Green?O.colors.success.base:O.colors.error.base:S===f.m.Red?O.colors.success.base:O.colors.error.base:O.colors.grayscale.base};
    margin-left: ${O.gridUnit}px;
  `,q=O.colors.grayscale.light4,W=O.colors.grayscale.base,{backgroundColor:_,textColor:X}=(0,a.useMemo)((()=>{let e=q,t=W;if(F&&0!==N){const n=N>0&&S===f.m.Green||N<0&&S===f.m.Red;e=n?O.colors.success.light2:O.colors.error.light2,t=n?O.colors.success.base:O.colors.error.base}return{backgroundColor:e,textColor:t}}),[O,S,F,N]),Q=(0,a.useMemo)((()=>[{defaultSymbol:"#",value:h,tooltipText:(0,d.t)("Data for %s",z||"previous range"),columnKey:"Previous value"},{defaultSymbol:"△",value:p,tooltipText:(0,d.t)("Value difference between the time periods"),columnKey:"Delta"},{defaultSymbol:"%",value:T,tooltipText:(0,d.t)("Percentage difference between the time periods"),columnKey:"Percent change"}].map((t=>{var n;const r=null==(n=e.columnConfig)?void 0:n[t.columnKey];return{...t,symbol:!1===(null==r?void 0:r.displayTypeIcon)?"":t.defaultSymbol,label:(null==r?void 0:r.customColumnName)||t.columnKey}}))),[z,h,p,T,e.columnConfig]).filter((t=>{var n,r;return!1!==(null==(n=e.columnConfig)||null==(r=n[t.columnKey])?void 0:r.visible)})),{isOverflowing:Z,symbolContainerRef:B,wrapperRef:J}=v(V);return(0,y.Y)("div",{css:j,ref:J,children:(0,y.FD)(w,{css:Z&&u.AH`
            width: fit-content;
            margin: auto;
            align-items: flex-start;
            overflow: auto;
          `,children:[G&&x&&(0,y.Y)(D,{metricNameFontSize:C,children:x}),(0,y.FD)("div",{css:K,children:[r,0!==N&&(0,y.Y)("span",{css:P,children:N>0?"↑":"↓"})]}),H&&(0,y.Y)(L,{style:{fontSize:I*t*.4+"px"},children:H}),Q.length>0&&(0,y.Y)("div",{css:[u.AH`
                display: flex;
                justify-content: space-around;
                gap: ${V}px;
                min-width: 0;
                flex-shrink: 1;
              `,Z?u.AH`
                    flex-direction: column;
                    align-items: flex-start;
                    width: fit-content;
                  `:u.AH`
                    align-items: center;
                    width: 100%;
                  `,"",""],ref:B,children:Q.map(((t,n)=>{var r,i;return(0,y.Y)(b,{subheaderFontSize:U,children:(0,y.FD)(g.m,{id:"tooltip",placement:"top",title:t.tooltipText,children:[t.symbol&&(0,y.Y)($,{backgroundColor:n>0?_:q,textColor:n>0?X:W,children:t.symbol}),t.value," ",(null==(r=e.columnConfig)||null==(i=r[t.columnKey])?void 0:i.customColumnName)||""]})},`comparison-symbol-${t.columnKey}`)}))})]})})}},77189:(e,t,n)=>{n.d(t,{wv:()=>u,x9:()=>f});var r=n(62193),i=n.n(r),a=n(58561),s=n.n(a),l=n(62952),o=n(35742),c=n(51436);const u=" : ",d=(e,t)=>`${e}${u}${t}`,m=(e,t)=>e.replace("T00:00:00","")||(t?"-∞":"∞"),g=(e,t="col")=>{const n=e.split(u);return 1===n.length?e:`${m(n[0],!0)} ≤ ${t} < ${m(n[1])}`},f=async(e,t="col",n)=>{let r,a;if(i()(n))r=s().encode_uri(e),a=`/api/v1/time_range/?q=${r}`;else{const t=(0,l.A)(n).map((t=>({timeRange:e,shift:t})));r=s().encode_uri([{timeRange:e},...t]),a=`/api/v1/time_range/?q=${r}`}try{var f;const e=await o.A.get({endpoint:a});if(i()(n)){var h,p,v,y;const n=d((null==e||null==(h=e.json)||null==(p=h.result[0])?void 0:p.since)||"",(null==e||null==(v=e.json)||null==(y=v.result[0])?void 0:y.until)||"");return{value:g(n,t)}}const r=null==e||null==(f=e.json)?void 0:f.result.map((e=>d(e.since,e.until)));return{value:r.slice(1).map((e=>((e,t,n="col")=>{const r=e.split(u),i=t.split(u);return`${n}: ${m(r[0],!0)} to ${m(r[1])} vs\n  ${m(i[0],!0)} to ${m(i[1])}`})(r[0],e,t)))}}catch(e){const t=await(0,c.h4)(e);return{error:t.message||t.error||e.statusText}}}}}]);