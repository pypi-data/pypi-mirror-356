"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5936],{8960:(e,a,t)=>{var n=t(30327);a.createFirstEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.FIRST_ELLIPSIS,value:e,isActive:!1}},a.createSecondEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.SECOND_ELLIPSIS,value:e,isActive:!1}},a.createFirstPageLink=function(e){var a=e.currentPage;return{type:n.ITEM_TYPES.FIRST_PAGE_LINK,key:n.ITEM_KEYS.FIRST_PAGE_LINK,value:1,isActive:1===a}},a.createPreviousPageLink=function(e){var a=e.currentPage;return{type:n.ITEM_TYPES.PREVIOUS_PAGE_LINK,key:n.ITEM_KEYS.PREVIOUS_PAGE_LINK,value:Math.max(1,a-1),isActive:1===a}},a.createNextPageLink=function(e){var a=e.currentPage,t=e.totalPages;return{type:n.ITEM_TYPES.NEXT_PAGE_LINK,key:n.ITEM_KEYS.NEXT_PAGE_LINK,value:Math.min(t,a+1),isActive:a===t}},a.createLastPageLink=function(e){var a=e.currentPage,t=e.totalPages;return{type:n.ITEM_TYPES.LAST_PAGE_LINK,key:n.ITEM_KEYS.LAST_PAGE_LINK,value:t,isActive:a===t}},a.createPageFunctionFactory=function(e){var a=e.currentPage;return function(e){return{type:n.ITEM_TYPES.PAGE,key:e,value:e,isActive:e===a}}}},11447:(e,a,t)=>{var n=t(17991),s=t(8960);a.getPaginationModel=function(e){if(null==e)throw new Error("getPaginationModel(): options object should be a passed");var a=Number(e.totalPages);if(isNaN(a))throw new Error("getPaginationModel(): totalPages should be a number");if(a<0)throw new Error("getPaginationModel(): totalPages shouldn't be a negative number");var t=Number(e.currentPage);if(isNaN(t))throw new Error("getPaginationModel(): currentPage should be a number");if(t<0)throw new Error("getPaginationModel(): currentPage shouldn't be a negative number");if(t>a)throw new Error("getPaginationModel(): currentPage shouldn't be greater than totalPages");var i=null==e.boundaryPagesRange?1:Number(e.boundaryPagesRange);if(isNaN(i))throw new Error("getPaginationModel(): boundaryPagesRange should be a number");if(i<0)throw new Error("getPaginationModel(): boundaryPagesRange shouldn't be a negative number");var l=null==e.siblingPagesRange?1:Number(e.siblingPagesRange);if(isNaN(l))throw new Error("getPaginationModel(): siblingPagesRange should be a number");if(l<0)throw new Error("getPaginationModel(): siblingPagesRange shouldn't be a negative number");var o=Boolean(e.hidePreviousAndNextPageLinks),r=Boolean(e.hideFirstAndLastPageLinks),d=Boolean(e.hideEllipsis),c=d?0:1,u=[],h=s.createPageFunctionFactory(e);if(r||u.push(s.createFirstPageLink(e)),o||u.push(s.createPreviousPageLink(e)),1+2*c+2*l+2*i>=a){var g=n.createRange(1,a).map(h);u.push.apply(u,g)}else{var b=i,p=n.createRange(1,b).map(h),_=a+1-i,P=a,E=n.createRange(_,P).map(h),m=Math.min(Math.max(t-l,b+c+1),_-c-2*l-1),S=m+2*l,f=n.createRange(m,S).map(h);if(u.push.apply(u,p),!d){var v=m-1,y=(v===b+1?h:s.createFirstEllipsis)(v);u.push(y)}if(u.push.apply(u,f),!d){var I=S+1,A=(I===_-1?h:s.createSecondEllipsis)(I);u.push(A)}u.push.apply(u,E)}return o||u.push(s.createNextPageLink(e)),r||u.push(s.createLastPageLink(e)),u};var i=t(30327);a.ITEM_TYPES=i.ITEM_TYPES,a.ITEM_KEYS=i.ITEM_KEYS},12397:(e,a,t)=>{t.d(a,{U:()=>o});var n=t(19129),s=t(25106),i=t(78518),l=t(2445);const o=({user:e,date:a})=>{const t=(0,l.Y)("span",{className:"no-wrap","data-test":"audit-info-date",children:a});if(e){const a=(0,s.A)(e),o=(0,i.t)("Modified by: %s",a);return(0,l.Y)(n.m_,{title:o,placement:"bottom",children:t})}return t}},17991:(e,a)=>{a.createRange=function(e,a){for(var t=[],n=e;n<=a;n++)t.push(n);return t}},18575:(e,a,t)=>{a.w$=a.uv=void 0;var n=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s=o(t(96540)),i=o(t(5556)),l=t(11447);function o(e){return e&&e.__esModule?e:{default:e}}a.uv=function(e){var a=e.itemTypeToComponent,t=e.WrapperComponent,o=void 0===t?"div":t,r=function(e){var t=e.currentPage,i=e.totalPages,r=e.boundaryPagesRange,d=e.siblingPagesRange,c=e.hideEllipsis,u=e.hidePreviousAndNextPageLinks,h=e.hideFirstAndLastPageLinks,g=e.onChange,b=e.disabled,p=function(e,a){var t={};for(var n in e)a.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}(e,["currentPage","totalPages","boundaryPagesRange","siblingPagesRange","hideEllipsis","hidePreviousAndNextPageLinks","hideFirstAndLastPageLinks","onChange","disabled"]),_=(0,l.getPaginationModel)({currentPage:t,totalPages:i,boundaryPagesRange:r,siblingPagesRange:d,hideEllipsis:c,hidePreviousAndNextPageLinks:u,hideFirstAndLastPageLinks:h}),P=function(e,a,t){return function(i){var l,o,r,d=e[i.type],c=(o=(l=i).value,r=l.isDisabled,function(){!r&&t&&a!==o&&t(o)});return s.default.createElement(d,n({onClick:c},i))}}(a,t,g);return s.default.createElement(o,p,_.map((function(e){return P(n({},e,{isDisabled:!!b}))})))};return r.propTypes={currentPage:i.default.number.isRequired,totalPages:i.default.number.isRequired,boundaryPagesRange:i.default.number,siblingPagesRange:i.default.number,hideEllipsis:i.default.bool,hidePreviousAndNextPageLinks:i.default.bool,hideFirstAndLastPageLinks:i.default.bool,onChange:i.default.func,disabled:i.default.bool},r},a.w$=l.ITEM_TYPES},30327:(e,a)=>{a.ITEM_TYPES={PAGE:"PAGE",ELLIPSIS:"ELLIPSIS",FIRST_PAGE_LINK:"FIRST_PAGE_LINK",PREVIOUS_PAGE_LINK:"PREVIOUS_PAGE_LINK",NEXT_PAGE_LINK:"NEXT_PAGE_LINK",LAST_PAGE_LINK:"LAST_PAGE_LINK"},a.ITEM_KEYS={FIRST_ELLIPSIS:-1,SECOND_ELLIPSIS:-2,FIRST_PAGE_LINK:-3,PREVIOUS_PAGE_LINK:-4,NEXT_PAGE_LINK:-5,LAST_PAGE_LINK:-6}},84177:(e,a,t)=>{t.r(a),t.d(a,{default:()=>x});var n=t(72391),s=t(96453),i=t(78518),l=t(35742),o=t(17437),r=t(96540),d=t(58561),c=t.n(d),u=t(61225),h=t(33231),g=t(62221),b=t(17444),p=t(50500),_=t(30703),P=t(5261),E=t(51713),m=t(37020),S=t(32132),f=t(27023),v=t(19129),y=t(67073),I=t(65256),A=t(43849),L=t(4780),N=t(43293),T=t(19980),Y=t(12397),w=t(23193),k=t(2445);const M=(0,n.a)(),C=M.get("database.delete.related"),F=M.get("databaseconnection.extraOption"),D=s.I4.div`
  color: ${({theme:e})=>e.colors.grayscale.base};

  .action-button {
    display: inline-block;
    height: 100%;
  }
`;function R({value:e}){const a=(0,s.DP)();return e?(0,k.Y)(y.F.CheckOutlined,{iconSize:"s",iconColor:a.colors.grayscale.dark1}):(0,k.Y)(y.F.CloseOutlined,{iconSize:"s",iconColor:a.colors.grayscale.light1})}const x=(0,P.Ay)((function({addDangerToast:e,addInfoToast:a,addSuccessToast:t,user:n}){const d=(0,s.DP)(),{state:{loading:P,resourceCount:M,resourceCollection:x},hasPerm:K,fetchData:O,refreshData:G}=(0,p.RU)("database",(0,i.t)("database"),e),H=(0,u.d4)((e=>e.user)),U=(0,u.d4)((e=>{var a;return null==(a=e.common)?void 0:a.conf.SYNC_DB_PERMISSIONS_IN_ASYNC_MODE})),z=(0,S.P3)(f.vX.showDatabaseModal),[q,X]=(0,h.sq)({databaseAdded:h.sJ}),[V,$]=(0,r.useState)(z||!1),[j,B]=(0,r.useState)(null),[J,Q]=(0,r.useState)(null),[W,Z]=(0,r.useState)(!1),[ee,ae]=(0,r.useState)(!1),[te,ne]=(0,r.useState)(!1),[se,ie]=(0,r.useState)(!1),le=(0,I.N6)(H),oe=se||le,[re,de]=(0,r.useState)(!1),{roles:ce}=H,{CSV_EXTENSIONS:ue,COLUMNAR_EXTENSIONS:he,EXCEL_EXTENSIONS:ge,ALLOWED_EXTENSIONS:be}=(0,u.d4)((e=>e.common.conf));function pe({database:e=null,modalOpen:a=!1}={}){Q(e),$(a)}(0,r.useEffect)((()=>{null!=q&&q.databaseAdded&&(X({databaseAdded:void 0}),G())}),[q,X,G]);const _e=K("can_write"),Pe=K("can_write"),Ee=K("can_write"),me=K("can_export"),{canUploadCSV:Se,canUploadColumnar:fe,canUploadExcel:ve}=(0,_.c8)(ce,ue,he,ge,be),ye=le&&!se,Ie=[{label:(0,i.t)("Upload file to database"),childs:[{label:(0,i.t)("Upload CSV"),name:"Upload CSV file",url:"#",onClick:()=>{Z(!0)},perm:Se&&oe,disable:ye},{label:(0,i.t)("Upload Excel"),name:"Upload Excel file",url:"#",onClick:()=>{ae(!0)},perm:ve&&oe,disable:ye},{label:(0,i.t)("Upload Columnar"),name:"Upload columnar file",url:"#",onClick:()=>{ne(!0)},perm:fe&&oe,disable:ye}]}];(0,r.useEffect)((()=>{l.A.get({endpoint:`/api/v1/database/?q=${c().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((({json:e})=>{var a;const t=(null==e||null==(a=e.result)?void 0:a.filter((e=>{var a;return null==e||null==(a=e.engine_information)?void 0:a.supports_file_upload})))||[];ie((null==t?void 0:t.length)>=1)}))}),[V]);const Ae={activeChild:"Databases",dropDownLinks:Ie.reduce(((e,a)=>(a.childs=a.childs.filter((e=>e.perm)),a.childs.length?(e.push(a),e):e)),[]),name:(0,i.t)("Databases")};_e&&(Ae.buttons=[{"data-test":"btn-create-database",name:(0,k.FD)(k.FK,{children:[(0,k.Y)(y.F.PlusOutlined,{css:o.AH`
                vertical-align: text-top;
              `,iconColor:d.colors.primary.light5,iconSize:"m"}),(0,i.t)("Database")]}),buttonStyle:"primary",onClick:()=>{pe({modalOpen:!0})}}]);const Le=(0,r.useMemo)((()=>[{accessor:"database_name",Header:(0,i.t)("Name")},{accessor:"backend",Header:(0,i.t)("Backend"),size:"lg",disableSortBy:!0},{accessor:"allow_run_async",Header:(0,k.Y)(v.m_,{id:"allow-run-async-header-tooltip",title:(0,i.t)("Asynchronous query execution"),placement:"top",children:(0,k.Y)("span",{children:(0,i.t)("AQE")})}),Cell:({row:{original:{allow_run_async:e}}})=>(0,k.Y)(R,{value:e}),size:"sm"},{accessor:"allow_dml",Header:(0,k.Y)(v.m_,{id:"allow-dml-header-tooltip",title:(0,i.t)("Allow data manipulation language"),placement:"top",children:(0,k.Y)("span",{children:(0,i.t)("DML")})}),Cell:({row:{original:{allow_dml:e}}})=>(0,k.Y)(R,{value:e}),size:"sm"},{accessor:"allow_file_upload",Header:(0,i.t)("File upload"),Cell:({row:{original:{allow_file_upload:e}}})=>(0,k.Y)(R,{value:e}),size:"md"},{accessor:"expose_in_sqllab",Header:(0,i.t)("Expose in SQL Lab"),Cell:({row:{original:{expose_in_sqllab:e}}})=>(0,k.Y)(R,{value:e}),size:"md"},{Cell:({row:{original:{changed_by:e,changed_on_delta_humanized:a}}})=>(0,k.Y)(Y.U,{date:a,user:e}),Header:(0,i.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:({row:{original:n}})=>Pe||Ee||me?(0,k.FD)(D,{className:"actions",children:[Ee&&(0,k.Y)("span",{role:"button",tabIndex:0,className:"action-button","data-test":"database-delete",onClick:()=>{return e=n,l.A.get({endpoint:`/api/v1/database/${e.id}/related_objects/`}).then((({json:a={}})=>{B({...e,charts:a.charts,dashboards:a.dashboards,sqllab_tab_count:a.sqllab_tab_states.count})})).catch((0,_.JF)((e=>(0,i.t)("An error occurred while fetching database related data: %s",e))));var e},children:(0,k.Y)(v.m_,{id:"delete-action-tooltip",title:(0,i.t)("Delete database"),placement:"bottom",children:(0,k.Y)(y.F.DeleteOutlined,{iconSize:"l"})})}),me&&(0,k.Y)(v.m_,{id:"export-action-tooltip",title:(0,i.t)("Export"),placement:"bottom",children:(0,k.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var e;void 0!==(e=n).id&&((0,L.A)("database",[e.id],(()=>{de(!1)})),de(!0))},children:(0,k.Y)(y.F.UploadOutlined,{iconSize:"l"})})}),Pe&&(0,k.Y)(v.m_,{id:"edit-action-tooltip",title:(0,i.t)("Edit"),placement:"bottom",children:(0,k.Y)("span",{role:"button","data-test":"database-edit",tabIndex:0,className:"action-button",onClick:()=>pe({database:n,modalOpen:!0}),children:(0,k.Y)(y.F.EditOutlined,{"data-test":"edit-alt",iconSize:"l"})})}),Pe&&(0,k.Y)(v.m_,{id:"sync-action-tooltip",title:(0,i.t)("Sync Permissions"),placement:"bottom",children:(0,k.Y)("span",{role:"button","data-test":"database-sync-perm",tabIndex:0,className:"action-button",onClick:()=>{return s=n,a(U?(0,i.t)("Validating connectivity for %s",s.database_name):(0,i.t)("Syncing permissions for %s",s.database_name)),void l.A.post({endpoint:`/api/v1/database/${s.id}/sync_permissions/`}).then((({response:e})=>{200===e.status?t((0,i.t)("Permissions successfully synced for %s",s.database_name)):a((0,i.t)("Syncing permissions for %s in the background",s.database_name))}),(0,_.JF)((a=>e((0,i.t)("An error occurred while syncing permissions for %s: %s",s.database_name,a)))));var s},children:(0,k.Y)(y.F.SyncOutlined,{iconSize:"l"})})})]}):null,Header:(0,i.t)("Actions"),id:"actions",hidden:!Pe&&!Ee,disableSortBy:!0},{accessor:w.H.ChangedBy,hidden:!0}]),[Ee,Pe,me]),Ne=(0,r.useMemo)((()=>[{Header:(0,i.t)("Name"),key:"search",id:"database_name",input:"search",operator:A.t.Contains},{Header:(0,i.t)("Expose in SQL Lab"),key:"expose_in_sql_lab",id:"expose_in_sqllab",input:"select",operator:A.t.Equals,unfilteredLabel:(0,i.t)("All"),selects:[{label:(0,i.t)("Yes"),value:!0},{label:(0,i.t)("No"),value:!1}]},{Header:(0,k.Y)(v.m_,{id:"allow-run-async-filter-header-tooltip",title:(0,i.t)("Asynchronous query execution"),placement:"top",children:(0,k.Y)("span",{children:(0,i.t)("AQE")})}),key:"allow_run_async",id:"allow_run_async",input:"select",operator:A.t.Equals,unfilteredLabel:(0,i.t)("All"),selects:[{label:(0,i.t)("Yes"),value:!0},{label:(0,i.t)("No"),value:!1}]},{Header:(0,i.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:A.t.RelationOneMany,unfilteredLabel:(0,i.t)("All"),fetchSelects:(0,_.u1)("database","changed_by",(0,_.JF)((e=>(0,i.t)("An error occurred while fetching dataset datasource values: %s",e))),n),paginate:!0}]),[]);return(0,k.FD)(k.FK,{children:[(0,k.Y)(E.A,{...Ae}),(0,k.Y)(N.Ay,{databaseId:null==J?void 0:J.id,show:V,onHide:pe,onDatabaseAdd:()=>{G()}}),(0,k.Y)(T.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{Z(!1)},show:W,allowedExtensions:ue,type:"csv"}),(0,k.Y)(T.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{ae(!1)},show:ee,allowedExtensions:ge,type:"excel"}),(0,k.Y)(T.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{ne(!1)},show:te,allowedExtensions:he,type:"columnar"}),j&&(0,k.Y)(m.A,{description:(0,k.FD)(k.FK,{children:[(0,k.FD)("p",{children:[(0,i.t)("The database")," ",(0,k.Y)("b",{children:j.database_name})," ",(0,i.t)("is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",j.charts.count,j.dashboards.count,j.sqllab_tab_count)]}),j.dashboards.count>=1&&(0,k.FD)(k.FK,{children:[(0,k.Y)("h4",{children:(0,i.t)("Affected Dashboards")}),(0,k.FD)("ul",{children:[j.dashboards.result.slice(0,10).map(((e,a)=>(0,k.Y)("li",{children:(0,k.Y)("a",{href:`/superset/dashboard/${e.id}`,target:"_atRiskItem",children:e.title})},e.id))),j.dashboards.result.length>10&&(0,k.Y)("li",{children:(0,i.t)("... and %s others",j.dashboards.result.length-10)})]})]}),j.charts.count>=1&&(0,k.FD)(k.FK,{children:[(0,k.Y)("h4",{children:(0,i.t)("Affected Charts")}),(0,k.FD)("ul",{children:[j.charts.result.slice(0,10).map(((e,a)=>(0,k.Y)("li",{children:(0,k.Y)("a",{href:`/explore/?slice_id=${e.id}`,target:"_atRiskItem",children:e.slice_name})},e.id))),j.charts.result.length>10&&(0,k.Y)("li",{children:(0,i.t)("... and %s others",j.charts.result.length-10)})]})]}),C&&(0,k.Y)(C,{database:j})]}),onConfirm:()=>{j&&function(a){const{id:n,database_name:s}=a;l.A.delete({endpoint:`/api/v1/database/${n}`}).then((()=>{G(),t((0,i.t)("Deleted: %s",s)),null!=F&&F.onDelete&&F.onDelete(a),(0,g.SO)(g.Hh.Database,null),B(null)}),(0,_.JF)((a=>e((0,i.t)("There was an issue deleting %s: %s",s,a)))))}(j)},onHide:()=>B(null),open:!0,title:(0,i.t)("Delete Database?")}),(0,k.Y)(A.A,{className:"database-list-view",columns:Le,count:M,data:x,fetchData:O,filters:Ne,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:P,addDangerToast:e,addSuccessToast:t,refreshData:()=>{},pageSize:25}),re&&(0,k.Y)(b.A,{})]})}))}}]);